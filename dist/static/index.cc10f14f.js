import{_ as d,r as g,s as m,t as p,n as f}from"./index.25833e42.js";var b=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"v-h-100"},[e.isChange===!0?t("div",{staticClass:"dor-danger"}):e._e(),t("div",{staticClass:"flex-wrap flex-center-wrap flex-justify-between my-article-header"},[t("div",[t("el-dropdown",{staticClass:"m-r-20",on:{command:e.handleTypeCommand}},[t("div",{staticClass:"el-dropdown-link cu"},[t("span",{staticClass:"m-r-10"},[e._v(" \u9ED8\u8BA4\u586B\u5145 ")]),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.defaultList,function(a,r){return t("el-dropdown-item",{key:a.label,attrs:{command:{item:a,index:r}}},[e._v(e._s(a.label))])}),1)],1),t("el-button",{on:{click:function(a){return e.$router.push("/home")}}},[e._v("\u8FD4\u56DE\u9996\u9875")]),t("el-button",{on:{click:e.goBottom}},[e._v("\u6EDA\u52A8\u5230\u5E95\u90E8")]),t("el-button",{on:{click:e.createTable}},[e._v("\u521B\u5EFA\u8868\u683C")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.articleData._id,expression:"articleData._id"}],attrs:{type:"danger"},on:{click:e.goInfoPage}},[e._v("\u8BE6\u60C5\u9875")]),t("el-button",{on:{click:e.goLint}},[e._v("\u5728\u7EBF\u683C\u5F0F\u5316\u4EE3\u7801\u5730\u5740")])],1),t("el-button",{attrs:{disabled:e.isDisabled,type:"primary",plain:""},on:{click:e.openArticleDetails}},[e._v("\u8BE6\u60C5\u914D\u7F6E")]),t("articleDetails",{ref:"articleDetailsRef",attrs:{editObj:e.editObj,isEdit:e.isEdit},on:{save:e.saveBlog},model:{value:e.isShowDetail,callback:function(a){e.isShowDetail=a},expression:"isShowDetail"}})],1),t("div",{staticClass:"max-height"},[t("mavonEditor",{attrs:{upload_file_url:"blog"},on:{save:e.saveBlog,change:e.changeFn},model:{value:e.articleData.article_string,callback:function(a){e.$set(e.articleData,"article_string",a)},expression:"articleData.article_string"}})],1),t("div",{staticClass:"h-10"}),t("div",{staticClass:"page-demo"}),t("tableDialog",{on:{confirm:e.tableDialogConfirm},model:{value:e.dialogVisible,callback:function(a){e.dialogVisible=a},expression:"dialogVisible"}})],1)},v=[];const w={name:"article1",components:{tableDialog:()=>d(()=>import("./tableDialog.27db8308.js"),["static/tableDialog.27db8308.js","static/tableDialog.4e496b8b.css","static/index.25833e42.js","static/index.8776284e.css"]),articleDetails:()=>d(()=>import("./articleDetails.d024fc0a.js"),["static/articleDetails.d024fc0a.js","static/articleDetails.0ca896dc.css","static/index.25833e42.js","static/index.8776284e.css"]),mavonEditor:()=>d(()=>import("./index.dc53c6d6.js"),["static/index.dc53c6d6.js","static/index.3a34ce3f.css","static/index.25833e42.js","static/index.8776284e.css"])},data(){return{editObj:{},isChange:"",bc:null,isShowDetail:!1,defaultList:[{label:"\u535A\u5BA2\u8BB0\u5F55\u586B\u5145",title:"\u535A\u5BA2\u5F00\u53D1\u8BB0\u5F55 ---",content:`## \u6848\u4F8B\u5C55\u793A
## \u529F\u80FD\u63CF\u8FF0
## \u4F7F\u7528
## \u5B9E\u73B0`},{label:"\u533B\u5B66\u8BB0\u5F55\u586B\u5145",title:"\u533B\u5B66\u8BB0\u5F55 ---",content:`## \u903B\u8F91\u56FE\u5730\u5740
## \u75C7\u72B6
## \u75C5\u56E0
## \u533B\u6CBB(\u836F\u6750\uFF0C\u836F\u91CF)`}],dialogVisible:!1,dialogOption:{isShow:!1},articleData:{_id:"",article_content:"",article_string:"",class_id:"",article_keywords:"",article_bck_url:"",article_name:"",article_need_token:"1",article_watch_numbers:0},toolbars:{bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,mark:!0,superscript:!0,subscript:!0,quote:!0,ol:!0,ul:!0,link:!0,imagelink:!0,code:!0,table:!0,fullscreen:!0,readmodel:!0,htmlcode:!0,help:!0,undo:!0,redo:!0,trash:!0,save:!0,navigation:!0,alignleft:!0,aligncenter:!0,alignright:!0,subfield:!0,preview:!0}}},created(){if(!this.isAdmin){this.$router.replace("/home");return}},computed:{...Vuex.mapGetters(["isAdmin"]),isEdit(){return!!this.articleData._id},query(){return this.$route.query},isDisabled(){return!(this.articleData._id||!this.query._id)}},async mounted(){this.init()},beforeDestroy(){this.bc&&this.bc.close()},methods:{changeFn({str:e,html:i}){if(Object.assign(this.articleData,{article_string:e,article_content:i}),this.getType(this.isChange)==="string"){this.isChange=!1;return}this.isChange=!0},goLint(){window.open("https://www.qianbo.com.cn/Tool/Beautify/Js-Formatter.html")},goInfoPage(){const e={is_edit_from:1};let{from:i}=this.$route.query;i&&(e.from=i),this.$router.push({path:`/blog/page/${this.articleData._id}`,query:e})},tableDialogConfirm(){},openArticleDetails(){this.isShowDetail=!0},handleTypeCommand({item:{title:e,content:i},index:t}){this.$confirm("\u662F\u5426\u6E05\u7A7A\u5F53\u524D\u5185\u5BB9,\u5E76\u586B\u5145","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{this.articleData.article_string=i;let a=this.$refs.articleDetailsRef;if(!a)return this.$message.warning("\u5185\u90E8\u9519\u8BEF\uFF0C\u5237\u65B0\u91CD\u8BD52");a.params.article_name=e}).catch(()=>{})},createTable(){this.dialogVisible=!0},goBottom(){let e=$(".v-note-edit"),i=$(".content-input-wrapper").height()||9999;e.animate({scrollTop:i},500)},async init(){let{_id:e}=this.$route.query;if(!e){this.isShowDetail=!0;return}g({_id:e,type:3}).then(async i=>{if(i.data&&i.data.article){if(this.articleData=i.data.article,this.articleData.article_keywords){let c=this.articleData.article_keywords.split("$$");c.length==2?this.articleData.article_keywords=c[1]:this.articleData.article_keywords=""}for(let c=0;c<20;c++){await this.sleep(50);let{articleDetailsRef:_}=this.$refs;if(_)break;if(c===19)return this.$message.warning("\u5185\u90E8\u9519\u8BEF\uFF0C\u5237\u65B0\u91CD\u8BD51")}let{class_id:{_id:t},article_keywords:a,article_bck_url:r,article_name:n,article_need_token:s,article_watch_numbers:u,blog_tags:l}=this.articleData,o={class_id:t,article_keywords:a,article_bck_url:r,article_name:n,article_need_token:s,blog_tags:l};l&&this.getType(l)==="string"&&(o.blog_tags=l.split(",")),this.editObj={...o,article_watch_numbers:Number(u)}}}).catch(()=>{})},getAllHtitle(e=2,i=[]){if(+e==7)return i;if($(`.page-demo h${e}`).length)for(let t=0;t<$(`.page-demo h${e}`).length;t++)i.push($(`.page-demo h${e}`).eq(t).text());return this.getAllHtitle(e+1,i)},handleKeyWords(e){let i=this.getAllHtitle();i.unshift(e);for(let t=0;t<$(".page-demo strong").length;t++)i.push($(".page-demo strong").eq(t).text());for(let t=0;t<$(".page-demo mark").length;t++)i.push($(".page-demo mark").eq(t).text());for(let t=0;t<$(".page-demo ins").length;t++)i.push($(".page-demo ins").eq(t).text());for(let t=0;t<$(".page-demo em").length;t++)i.push($(".page-demo em").eq(t).text());for(let t=0;t<$(".page-demo s").length;t++)i.push($(".page-demo s").eq(t).text());return i.join(",")},getParams(e){let i=this.$refs.articleDetailsRef;if(!i)return"\u8BF7\u5237\u65B0\u91CD\u8BD5";let{article_string:t}=e,{class_id:a,article_bck_url:r,article_name:n,article_keywords:s,blog_tags:u}=i.params,{_id:l}=this.articleData;if(l&&(e._id=l),e.blog_tags=Array.isArray(u)?u.join(","):"",!a)return"\u8BF7\u9009\u62E9\u5206\u7C7B";if(!r||!n)return"\u8BF7\u9009\u62E9\u6587\u7AE0\u80CC\u666F\u56FE\u7247";if(t.trim().length==0)return"\u8BF7\u8F93\u5165\u5185\u5BB9";let o=this.handleKeyWords(n);return s&&(o=o+"$$"+s),Object.assign({},i.params,e,{article_keywords:o})},async saveBlog(){return new Promise(async e=>{let{_id:i}=this.query;const{article_string:t,article_content:a}=this.articleData;$(".page-demo").html(a),await this.sleep();let r=await this.getParams({article_string:t,article_content:a});if(this.getType(r)=="string")return this.$message.error(r);if(!this.articleData._id){m(r).then(n=>{this.isChange=!1;let{_id:s}=n.data;this.articleData._id=s,this.updateUrl("_id",s),this.$message({message:"\u65B0\u589E\u6210\u529F",type:"success",duration:1e3}),e()}).catch(()=>{});return}p(r).then(()=>{this.isChange=!1,this.$message({message:"\u4FEE\u6539\u6210\u529F",type:"success",duration:1e3}),this.query.from==="experience_record"&&(this.bc=new BroadcastChannel("experience_record"),this.bc.postMessage({_id:i,article_content:a})),e()}).catch(()=>{})})}}},h={};var y=f(w,b,v,!1,D,"8a01143c",null,null);function D(e){for(let i in h)this[i]=h[i]}var C=function(){return y.exports}();export{C as default};
