import{N as m}from"./index.75491ee7.js";import{u as g}from"./user-article-list.a66fd601.js";import{n as p,h as _,i as f}from"./index.25833e42.js";var v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("e-dialog",{attrs:{title:"\u6279\u91CF\u79FB\u52A8\u6587\u7AE0\uFF0C\u5207\u6362\u5206\u7C7B",center:"",width:"30%"},on:{closed:t.handleClose,confirm:t.confirm},model:{value:t.value,callback:function(i){t.value=i},expression:"value"}},[s("div",{staticClass:"main p-15"},[s("p",{staticClass:"c-danger m-b-15"},[t._v("\u786E\u5B9A\u8981\u5C06\u5DF2\u9009\u62E9\u7684\u6587\u7AE0\u79FB\u52A8\u5230\u5176\u4ED6\u5206\u7C7B\u5417\uFF1F")]),s("p",{staticClass:"m-b-15"},[t._v(" \u5DF2\u9009\u62E9 "),s("span",{staticClass:"c-primary"},[t._v(t._s(t.selectNumber))]),t._v(" \u7BC7\u6587\u7AE0 ")]),s("p",{staticClass:"m-b-15"},[t._v("\u8BF7\u9009\u62E9\u5206\u7C7B\uFF1A")]),t._l(t.navList,function(i){return s("el-radio",{key:i._id,staticClass:"m-b-15",attrs:{label:i._id},model:{value:t.class_id,callback:function(n){t.class_id=n},expression:"class_id"}},[t._v(t._s(i.class_name))])})],2)])},b=[];const L={props:{value:{type:Boolean,default:!1},selectNumber:{type:Number,default:0},navList:{type:Array,default:[]},articlesList:{type:Array,default:[]}},data(){return{class_id:""}},watch:{navList:{handler(t){this.navList=t},immediate:!0,deep:!0}},methods:{confirm(){let t={class_id:this.class_id};if(t.article_ids=this.articlesList.filter(e=>e.isHandle).map(e=>e._id),!this.class_id){this.$message.error("\u8BF7\u9009\u62E9\u5206\u7C7B");return}if(!t.article_ids.length){this.$message.error("\u8BF7\u9009\u62E9\u6587\u7AE0");return}_.put_article_class(t).then(()=>{this.class_id="",this.$emit("confirm")}).catch(()=>{})},handleClose(){this.$emit("input",!1)}}},d={};var y=p(L,v,b,!1,A,null,null,null);function A(t){for(let e in d)this[e]=d[e]}var C=function(){return y.exports}(),H=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"blog common-bg-1"},[s("header",{staticClass:"flex-wrap flex-justify-between p-10 blog-user-articles-header"},[s("h1",{staticClass:"title_import",on:{click:function(i){return t.$router.push("/home")}}},[t._v("All DO BEST")]),t.isAdmin?s("div",[s("el-button",{attrs:{type:t.isHandle?"info":"success",size:"small"},on:{click:t.changeStatus}},[t._v(t._s(t.isHandle?"\u653E\u5F03":"\u6279\u91CF\u5904\u7406"))]),s("el-button",{staticClass:"pc_btn",attrs:{type:"primary",size:"small"},on:{click:t.getUpdatas}},[t._v("\u8FD1\u671F\u8DDF\u65B0")])],1):t._e()]),s("main",[s("Nav",{attrs:{navlist:t.navlist},on:{getArticles:t.init}}),s("div",{staticClass:"articles-container-page"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isHandle,expression:"isHandle"}],staticClass:"flex-wrap flex-center-wrap flex-justify-between check-box"},[s("div",[s("el-checkbox",{model:{value:t.checkedAll,callback:function(i){t.checkedAll=i},expression:"checkedAll"}},[t._v(t._s(t.checkedAll?"\u53D6\u6D88\u5168\u9009":"\u5168\u9009"))]),s("span",{directives:[{name:"show",rawName:"v-show",value:t.selectNumber,expression:"selectNumber"}],staticClass:"f-14 c-warning m-l-20",on:{click:function(i){t.changeClassVisable=!0}}},[t._v(" \u5F00\u59CB\u5904\u7406 ")])],1),s("div",{staticClass:"c-primary f-14"},[t._v("\u5DF2\u9009\u62E9 "+t._s(t.selectNumber)+" \u7BC7\u6587\u7AE0")])]),s("userArticleList",{staticClass:"articles-scroll-page",attrs:{list:t.articlesList,pageOption:t.pageOption,scrollHeight:t.scrollHeight,isHandle:t.isHandle},on:{bottom:t.bottom,goPage:t.goPage,scroll:t.scroll,delete:t.deleteFun}})],1)],1),s("kl-back-top",{attrs:{el:".kl-scroll"}}),s("updateArticleClassDialog",{attrs:{selectNumber:t.selectNumber,navList:t.filterNavList(),articlesList:t.articlesList},on:{confirm:t.confirmUpdate},model:{value:t.changeClassVisable,callback:function(i){t.changeClassVisable=i},expression:"changeClassVisable"}})],1)},x=[];const h={page:1,limit:50,total:0},k={components:{Nav:m,userArticleList:g,updateArticleClassDialog:C},name:"home",data(){return{changeClassVisable:!1,checkedAll:!1,isHandle:!1,isLoading:!1,clientHeight:0,content:"",isShow:!0,articlesList:[],scrollHeight:0,pageOption:this.deepClone(h),isUpdata:!1}},async created(){await this.GET_NAV_LIST(),this.init()},mounted(){this.getScrollHeight(),window.addEventListener("resize",this.getScrollHeight)},async activated(){await this.$nextTick();let{scrollTop:t}=this,e=document.querySelector(".kl-scroll");t&&e&&(e.scrollTop=t)},computed:{...Vuex.mapState(["userdata","class_id","navlist"]),...Vuex.mapGetters(["isAdmin"]),selectNumber(){return this.articlesList.filter(t=>t.isHandle).length}},watch:{checkedAll(t){this.articlesList=this.articlesList.map(e=>(e.isHandle=t,e))},isHandle(t){this.getScrollHeight()}},methods:{...Vuex.mapActions(["GET_NAV_LIST"]),deleteFun({_id:t}){this.articlesList=this.articlesList.filter(e=>e._id!==t)},filterNavList(){return this.navlist.filter(t=>t._id!==this.class_id)},confirmUpdate(){this.changeClassVisable=!1,this.init()},changeStatus(){this.isHandle=!this.isHandle,this.articlesList=this.articlesList.map(t=>(t.isHandle=!1,t))},scroll(t){this.scrollTop=t},init(){this.isUpdata=!1,this.checkedAll=!1,this.isHandle=!1,this.scrollTop=0,Object.assign(this.pageOption,h),this.articlesList=[],this.getArticles()},bottom(){let{page:t,limit:e}=this.pageOption;t*e>=this.pageOption.total||(this.pageOption.page++,this.getArticles())},goLogin(){this.$store.state.userdata?this.$router.push("/blog/admin"):this.$router.push("/login")},async getUpdatas(){this.isUpdata=!0,this.pageOption=this.deepClone(h),this.articlesList=[],this.getArticles()},async getArticles(){let{class_id:t,navlist:e,isUpdata:s}=this,{page:i,limit:n}=this.pageOption,l={page:i,limit:n};if(t?l.class_id=t:e&&e[0]&&(l.class_id=e[0]._id),!l.class_id)return this.$message.error("\u4F60\u53EF\u80FD\u4E0D\u5B58\u5728\u6587\u7AE0\u5206\u7C7B\u6570\u636E\uFF0C\u8BF7\u5148\u53BB\u521B\u5EFA\u5206\u7C7B\uFF0C\u521B\u5EFA\u6587\u7AE0");if(!s){f(l).then(c=>{let{list:a,total:o}=c.data;Array.isArray(a)&&(a=a.map(r=>(r.isHandle=!1,r)),this.articlesList=[...this.articlesList,...a],this.pageOption.total=o-0)}).catch(()=>{});return}l.type="4",_.get_mobile_home_list(l).then(c=>{if(c.data){let{list:a,total:o}=c.data;Array.isArray(a)&&(a=a.map(r=>(r.isHandle=!1,r)),this.articlesList=[...this.articlesList,...a],this.pageOption.total=o-0)}}).catch(()=>{})},async getScrollHeight(){await this.$nextTick();let t=document.querySelector(".articles-scroll-page");if(!t)return;let{top:e}=t.getBoundingClientRect(),s=document.documentElement.clientHeight;this.scrollHeight=s-e},goPage({row:t}){this.$router.push(`/blog/page/${t._id}?from=blog_home`)}}},u={};var $=p(k,H,x,!1,w,"eaa2980a",null,null);function w(t){for(let e in u)this[e]=u[e]}var T=function(){return $.exports}();export{T as default};
