import{D as f,n as _}from"./index.25833e42.js";import{u as p}from"./userList.00e1924b.js";var g=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("e-dialog",{attrs:{title:"\u529F\u80FD\u680F",footer:!1,width:"600px"},model:{value:t.visable,callback:function(s){t.visable=s},expression:"visable"}},[i("div",{staticClass:"flex-center-wrap p-t-20 p-l-10"},[i("div",{staticClass:"c-primary m-l-10 f-14"},[t._v(" \u4E0A\u6B21\u4FEE\u6539\u65F6\u95F4\uFF1A"+t._s(t.klDateFormat(t.formdata.updata_time))+" ")])]),t.isAuthor?i("div",{staticClass:"flex-center-wrap m-t-20 p-l-20"},[i("el-radio",{attrs:{label:1},model:{value:t.shareType,callback:function(s){t.shareType=s},expression:"shareType"}},[t._v("\u67E5\u770B")]),i("el-radio",{attrs:{label:2},model:{value:t.shareType,callback:function(s){t.shareType=s},expression:"shareType"}},[t._v("\u7F16\u8F91")]),i("el-button",{attrs:{size:"small"},on:{click:t.getShareCode}},[t._v("\u5206\u4EAB")])],1):t._e(),i("div",{staticClass:"flex-center-wrap p-l-20 m-t-10"},[t._v(" \u67E5\u770B\u5217\u8868\uFF1A "),i("userList",{attrs:{list:t.formdata.watch_users,type:"watch_users"},on:{del:t.delUsers}})],1),i("div",{staticClass:"flex-center-wrap p-l-20 m-t-10"},[t._v(" \u7F16\u8F91\u5217\u8868\uFF1A "),i("userList",{attrs:{list:t.formdata.edit_users,type:"edit_users"},on:{del:t.delUsers}})],1),i("div",{staticClass:"flex-center-wrap p-l-20 m-t-10 m-b-20"},[t._v(" \u6DFB\u52A0\u5B50\u8282\u70B9\uFF1A "),i("el-select",{attrs:{clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9"},model:{value:t.selectMind,callback:function(s){t.selectMind=s},expression:"selectMind"}},t._l(t.minds,function(s){return i("el-option",{key:s._id,attrs:{label:s.mind_title,value:s._id}})}),1),i("el-button",{on:{click:t.putMind}},[t._v(" \u786E\u5B9A ")])],1),t.isAuthor||!t.formdata._id?i("e-form",{ref:"ruleFormRef",attrs:{formConfig:t.formConfig,formRule:t.rules,formData:t.formdata}}):t._e()],1)},v=[];function m(){return[{label:"\u540D\u5B57",type:"input",modelName:"mind_title",className:"w-220",value:""},{label:"\u5206\u7C7B",type:"select",modelName:"jsmind_type",options:[],value:"2"}]}const j={components:{userList:p},props:{value:{type:Boolean,default:!1},_id:{type:String,default:""},formdata:{type:Object,default:()=>({...f(m()),watch_users:[],edit_users:[],updata_time:""})},isAuthor:{type:Boolean,default:!1}},data(){return{selectMind:"",minds:[],shareType:1,rules:{mind_title:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:"blur"}],jsmind_type:[{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7C7B",trigger:"change"}]},formConfig:m()}},computed:{...Vuex.mapGetters(["jsmindTypes","jsmindTypes1"]),visable:{get(){return this.value},set(t){t||this.$emit("rowDataChange",this.formdata),this.$emit("input",t)}}},created(){this.formConfig[1].options=this.jsmindTypes,this.init()},methods:{get_minds(){this.$apis.get_minds({type3:"options",cache:!0}).then(t=>{var e;this.minds=((e=t==null?void 0:t.data)==null?void 0:e.list)||[],this.minds=this.minds.filter(i=>i._id!==this._id)})},init(){this.get_minds()},async putMind(){var o;if(!await this.$confirm("\u786E\u5B9A\u6DFB\u52A0\u4E3A\u5B50\u8282\u70B9\u5417\uFF1F").catch(()=>!1))return;const e=await this.$apis.get_mind({_id:this.selectMind}),{mind_title:i,mind_str:s={}}=((o=e==null?void 0:e.data)==null?void 0:o.data)||{},{children:n}=(s==null?void 0:s.data)||[],d={direction:"right",expanded:!0,id:this.createId(),topic:i,children:n};this.$emit("putMind",{childInfo:d})},delUsers({type:t,row:e}){this.formdata[t]=this.formdata[t].filter(i=>i._id!==e._id)},getShareCode(){this.$apis.post_temporary({expire_time:5*60*1e3,info:{content:"\u8111\u56FE\u6743\u9650",shareType:this.shareType,mind_id:this._id}}).then(t=>{var s;const{_id:e=""}=((s=t==null?void 0:t.data)==null?void 0:s.data)||{};if(!e){this.$message.error("\u83B7\u53D6\u5206\u4EAB\u7801\u5931\u8D25");return}const i=this.joinParams(location.href,{shareId:e});this.copyText(i).then(()=>{this.$message.success("\u590D\u5236\u6210\u529F,\u5FEB\u53BB\u5206\u4EAB\u7ED9\u670B\u53CB\u5427!")})}).catch(t=>{this.Toast(t)})}}},c={};var y=_(j,g,v,!1,b,null,null,null);function b(t){for(let e in c)this[e]=c[e]}var w=function(){return y.exports}(),C=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"jsmind_layout"},[i("div",{staticClass:"pf pf-left f-14 c-777 flex-ceneter-wrap"},[i("div",[t._v("\u8282\u70B9\u6570\uFF1A"+t._s(t.mindLength))])]),t.isCanEdit?i("i",{staticClass:"el-icon-s-fold f-24 pos-menu pf cu",attrs:{slot:"reference"},on:{click:t.openMenu},slot:"reference"}):t._e(),t.showBar?i("div",{staticClass:"jsmind_toolbar h-0 op-0"},[i("el-button",{attrs:{size:"medium"},on:{click:t.screen_shot}},[t._v("\u4E0B\u8F7D\u5BFC\u56FE")]),i("el-button",{attrs:{size:"medium"},on:{click:t.get_nodearray_data}},[t._v("\u83B7\u53D6\u6570\u636E")]),i("el-button",{attrs:{size:"medium"},on:{click:t.addNode}},[t._v("\u65B0\u589E\u8282\u70B9")]),i("el-button",{attrs:{size:"medium"},on:{click:t.addBrotherNode}},[t._v("\u65B0\u589E\u5144\u5F1F\u8282\u70B9")]),i("el-button",{attrs:{size:"medium"},on:{click:t.editNode}},[t._v("\u7F16\u8F91\u8282\u70B9")]),i("el-button",{attrs:{size:"medium"},on:{click:t.removeNode}},[t._v("\u5220\u9664\u8282\u70B9")]),i("el-button",{attrs:{size:"medium",disabled:t.isZoomIn},on:{click:t.zoomIn}},[t._v("\u653E\u5927")]),i("el-button",{staticClass:"pad",attrs:{size:"medium",disabled:t.isZoomOut},on:{click:t.zoomOut}},[t._v("\u7F29\u5C0F")])],1):t._e(),i("div",{ref:"container",staticClass:"no-bar-box",attrs:{id:"jsmind_container"}}),i("editDialog",{ref:"editDialogRef",attrs:{_id:t._id,formdata:t.formdata,isAuthor:t.isAuthor},on:{"update:formdata":function(s){t.formdata=s},rowDataChange:t.rowDataChange,putMind:t.putMind},model:{value:t.dialogVisible,callback:function(s){t.dialogVisible=s},expression:"dialogVisible"}})],1)},x=[];const l="\u5728\u7EBF\u8111\u56FE",$={components:{editDialog:w},data(){return{_id:"",mind:{},jm:null,isZoomIn:!1,isZoomOut:!1,level:0,dialogVisible:!1,nodeOption:{content:"",bgColor:"",fontColor:"",fontSize:"",fontWeight:"",fontStyle:""},formdata:{_id:"",author_id:"",mind_title:l,mind_str:"",jsmind_type:"2",watch_users:[],edit_users:[]},rules:{mind_title:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:"blur"}],jsmind_type:[{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7C7B",trigger:"change"}]},mind:{meta:{name:l,author:"",version:"0.1"},format:"node_tree",data:{id:"root",topic:l},mode:"side"}}},computed:{...Vuex.mapState(["userdata","keyboardEventKay"]),...Vuex.mapGetters(["jsmindTypes","jsmindTypes1"]),isAuthor(){return this.formdata.author_id===this.userdata._id},isEdit(){return this.formdata.edit_users.includes(this.userdata._id)},isWatch(){return this.formdata.watch_users.includes(this.userdata._id)},isCanEdit(){return!this.formdata._id||this.isAuthor||this.isEdit},mindLength(){var t;if(this.jm&&this.jm.get_data){const e=this.jm.get_data("node_array");return((t=e==null?void 0:e.data)==null?void 0:t.length)||0}return 0},query(){return this.$route.query||{}},shareId(){return this.query.shareId||""}},watch:{keyboardEventKay(t){switch(t){case"ctrl_z":break;case"ctrl_s":this.save();break;case"tab":this.addNode();break}}},async mounted(){var e;this._id=((e=this.query)==null?void 0:e._id)||"";const{shareId:t}=this;t&&(await this.$apis.put_mind_limit({_id:t}),this.updateUrl("shareId",null)),this.getIndexDBJS([{isAppendHead:!0,css:"http://139.9.210.43:5000/netdist/jsmind-1720311296404~1~.css"},{js:"http://139.9.210.43:5000/netdist/jsmind-1720311306048~1~.js"}]).then(()=>{let{username:i}=this.userdata;this.mind.meta.author=i,this.getDetails(),this.winSleep(()=>{this.getIndexDBJS([{js:"http://139.9.210.43:5000/netdist/jsminddraggable-node-1720311302235~1~.js"}]).then(()=>{this.mouseWheel()}).catch(s=>{this.Toast(s)})})}).catch(i=>{this.Toast(i)})},beforeDestroy(){document.removeEventListener("domMouseScroll",this.scrollFunc,!1)},methods:{putMind(t){this.mind.data.children.push(t.childInfo),this.initChat(),this.dialogVisible=!1},rowDataChange(t){console.log(Object.assign(this.formdata,t))},delUsers(t){console.log(t)},openMenu(){this.dialogVisible=!0},save(){const{mindLength:t,isCanEdit:e}=this;if(!e)return;if(!this.formdata.mind_title){this.$message.error("\u8BF7\u8F93\u5165mind\u540D\u79F0");return}const i=this.jm.get_data("node_tree"),s=jsMind.util.json.json2string(i),n={...this.formdata,mindLength:t};n.mind_str=s;const{watch_users:d,edit_users:o}=n;this.isArrayLength(d)&&(n.watch_users=d.map(a=>a._id)),this.isArrayLength(o)&&(n.edit_users=o.map(a=>a._id)),n._id||delete n._id,this.$apis.post_mind(n).then(a=>{var h;this.$message.success((a==null?void 0:a.msg)||"\u4FDD\u5B58\u6210\u529F");let{_id:r}=((h=a==null?void 0:a.data)==null?void 0:h.data)||{};!this._id&&r&&(this.updateUrl("_id",r),this.formdata._id=r,this._id=r)}).catch(()=>{})},addNode(){let t=this.jm.get_selected_node();if(!t){this.$message({type:"warning",message:"\u8BF7\u5148\u9009\u62E9\u8282\u70B9!"});return}let e=jsMind.util.uuid.newid(),i="new node";this.jm.add_node(t,e,i)&&(this.jm.select_node(e),this.jm.begin_edit(e))},getDetails(){let{_id:t}=this;if(!t){this.initChat();return}this.$apis.get_mind({_id:t}).then(e=>{if(e.data&&e.data.data){let{mind_str:i,jsmind_type:s}=e.data.data;Object.assign(this.mind,i),Object.assign(this.formdata,e.data.data),s||(this.formdata.jsmind_type="2")}this.initChat()}).catch(e=>{console.log(e)})},beforeUpload(t){if(t)jsMind.util.file.read(t,e=>{const i=jsMind.util.json.string2json(e);i?(this.jm.show(i),this.$message({type:"success",message:"\u6253\u5F00\u6210\u529F"})):this.prompt_info("\u4E0D\u80FD\u6253\u5F00mindmap\u6587\u4EF6")});else return this.prompt_info("\u8BF7\u5148\u9009\u62E9\u6587\u4EF6"),!1},async initChat(){if(this.jm){this.jm.show(this.mind);return}const t={container:"jsmind_container",editable:!0,theme:"clouds",view:{line_width:1,line_color:"#999"},shortcut:{enable:!0},layout:{hspace:40,vspace:20,pspace:10},mode:"side"};this.jm=new jsMind(t),this.jm.show(this.mind),window.onresize=()=>{this.jm.resize()},await this.sleep(),this.jm.add_event_listener(async(e,i)=>{e==4&&this.jm.set_node_color(i.node,"#f0f0f0","#000000")})},screen_shot(){this.jm.screenshot.shootDownload()},expand_all(){this.jm.expand_all()},collapse_all(){this.jm.collapse_all()},expand_to_level(t){switch(t){case-1:this.collapse_all();break;case 0:this.expand_all();break;default:this.jm.expand_to_depth(t);break}},zoomIn(){this.jm.view.zoomIn()?this.isZoomOut=!1:this.isZoomIn=!0},zoomOut(){this.jm.view.zoomOut()?this.isZoomIn=!1:this.isZoomOut=!0},prompt_info(t){this.$message({type:"warning",message:t})},get_nodearray_data(){const t=this.jm.get_data("node_array"),e=jsMind.util.json.json2string(t);this.$message({type:"info",message:e})},set_theme(t){this.jm.set_theme(t)},scrollFunc(t){},mouseWheel(){document.addEventListener&&document.addEventListener("domMouseScroll",this.scrollFunc,!1),this.$refs.container.onmousewheel=this.scrollFunc},addBrotherNode(){let t=this.jm.get_selected_node();if(t){if(t.isroot){this.$message({type:"warning",message:"\u4E0D\u80FD\u5728\u6839\u8282\u70B9\u6DFB\u52A0\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9\u8282\u70B9!"});return}}else{this.$message({type:"warning",message:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u8282\u70B9!"});return}let e=jsMind.util.uuid.newid(),i="new Node";this.jm.insert_node_after(t,e,i)&&(this.jm.select_node(e),this.jm.begin_edit(e))},get_selected_nodeid(){let t=this.jm.get_selected_node();return t?t.id:null},removeNode(){let t=this.get_selected_nodeid();if(!t){this.$message({type:"warning",message:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u8282\u70B9!"});return}this.jm.remove_node(t)},editNode(){let t=this.get_selected_nodeid();if(!t){this.$message({type:"warning",message:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u8282\u70B9!"});return}let e=this.jm.get_node(t);this.nodeOption.content=e.topic,this.nodeOption.bgColor="#999",this.nodeOption.fontColor=e.data["foreground-color"],this.nodeOption.fontSize=e.data["font-size"],this.nodeOption.fontWeight=e.data["font-weight"],this.nodeOption.fontStyle=e.data["font-style"],this.dialogVisible=!0},sureEditNode(){let t=this.get_selected_nodeid();this.jm.update_node(t,this.nodeOption.content),this.jm.set_node_font_style(t,this.nodeOption.fontSize,this.nodeOption.fontWeight,this.nodeOption.fontStyle),this.jm.set_node_color(t,this.nodeOption.bgColor,this.nodeOption.fontColor),this.nodeOption={content:"",bgColor:"",fontColor:"",fontSize:"",fontWeight:"",fontStyle:""},this.dialogVisible=!1}}},u={};var k=_($,C,x,!1,O,"6dc0f3bc",null,null);function O(t){for(let e in u)this[e]=u[e]}var N=function(){return k.exports}();export{N as default};
