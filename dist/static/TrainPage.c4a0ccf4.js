import{n as g,_ as f}from"./index.25833e42.js";var d=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"app-container-new"},[e("SearchComp",{ref:"searchCompRef",attrs:{"search-config":t.searchConfig,"label-width":t.labelWidth,autoSearch:t.autoSearch,isSearchFormBtn:t.isSearchFormBtn,showFormToggle:t.showFormToggle,needDor:t.needDor,storageId:t.storageId,isCacheSearch:t.isCacheSearch},on:{search:t.searchFn,resetFieldFn:t.resetFieldFn}},[t._l(t.searchConfig,function(s){return e("template",{slot:s.slot},[t._t(s.slot)],2)})],2),e("div",{staticClass:"content-block content-block-table m-t-20"},[e("YewuTable",{ref:"YewuTableRef",attrs:{customize:t.customize,storageId:t.storageId,"tab-data-list":t.tableData,"table-config":t.tableConfig,pagination:t.pagination,isLoading:t.isLoading,visOptions:t.visOptions},on:{tableChange:t.tableCallBack,sortEnd:t.sortEnd},scopedSlots:t._u([t._l(t.tableConfig.columnObj,function(s){return{key:s.slot,fn:function(a){return[t._t(s.slot,null,{record:a.rowData})]}}})],null,!0)},[e("template",{slot:"btnList"},[t._t("btnList")],2),e("template",{slot:"kl-table"},[t._t("kl-table")],2),e("template",{slot:"kl-echarts"},[e("div",{ref:"echartsRef",style:t.getVisStyle})]),t._l(t.tableConfig.columnObj,function(s){return e("template",{slot:s.headerSlot},[t._t(s.headerSlot)],2)})],2)],1)],1)},u=[];const l={page:1,limit:20,showPageInfo:!0,totalRecords:0,totalPages:0},p={name:"TrainPage",components:{echartsPage:()=>f(()=>import("./index.c33acb75.js"),["static/index.c33acb75.js","static/index.aa3d91ae.css","static/index.25833e42.js","static/index.8776284e.css"])},props:{isNeedTip:{type:Boolean,default:!0},isCacheSearch:{type:Boolean,default:!0},storageKey:{type:String,default:""},searchConfig:{type:Array,default:function(){return[]}},labelWidth:{type:String,default:""},tableConfig:{type:Object,default:function(){return{}}},sendUrl:{type:String,required:!0,validator(t){return typeof t=="string"&&t.trim()!==""}},othData:{type:Object,default:function(){return{}}},autoSearch:{type:Boolean,default:!0},customize:{type:Boolean,default:!0,validator(t){return typeof this.storageId!="string"||this.storageId.trim()===""?(this.$message.warn("storageId\u4E0D\u80FD\u4E3A\u7A7A"),!1):!0}},isSearchFormBtn:{type:Boolean,default:!0},showFormToggle:{type:Boolean,default:!0},needDor:{type:Boolean,default:!1},visOptions:{type:Object,default:()=>({})}},data(){return{pagination:this.deepCopy(l),tableData:[],searchData:{},isLoading:!0,width:0,height:0,visInfo:{}}},computed:{storageId(){return this.storageKey||this.$route.path},visPlugins(){return this.tableConfig.visType==="echarts"?[{js:"http://139.9.210.43:5000/netdist/echarts543min-1728272924292~1~.js",remove:!0}]:this.tableConfig.visType==="chart"?[{js:"http://139.9.210.43:5000/netdist/chatmin-1728231268160~1~.js",remove:!0}]:[]},getVisStyle(){return{height:this.height+"px",width:this.width+"px"}}},created(){if(this.sendUrl===""||JSON.stringify(this.tableConfig)==="{}"){console.warn("sendUrl, searchConfig, tableConfig\u4E0D\u5141\u8BB8\u4E3A\u7A7A");return}const{storageId:t}=this;if(t){const i=this.getLocalStorage(this.storageId+"_pages",{});Object.assign(this.pagination,i)}},mounted(){this.$parent.initTable=this.getList,this.tableConfig.visType&&(this.getIndexDBJS(this.visPlugins).then(()=>{this.handlerVis()}).catch(t=>{this.Toast(t)}),window.onresize=this.debounce(()=>{this.handlerVis(!0)},50))},methods:{async handlerVis(t=!1){const{visType:i}=this.tableConfig;if(await this.$nextTick(),i==="echarts"&&typeof echarts=="undefined"||i==="chart"&&typeof Chart=="undefined"||Object.keys(this.visOptions).length===0)return;const{echartsRef:e}=this.$refs;if(!e)return;let{left:s,top:a}=e.getBoundingClientRect(),n=window.innerWidth||document.documentElement.clientWidth,o=window.innerHeight||document.documentElement.clientHeight;if(this.width=n-s-30,this.height=o-a-30,i==="echarts"){if(t){this.visInfo.resize();return}await this.$nextTick(),this.visInfo=echarts.init(e),this.visInfo.setOption(this.visOptions)}i==="chart"&&(this.visInfo=new Chart(e.getContext("2d"),this.visOptions))},sortEnd(t){this.$emit("sortEnd",t),this.tableData=t.newList},resetFieldFn(){Object.assign(this.pagination,l),this.cachePageInfo(),this.$emit("resetFieldFn")},async searchFn(t){Object.assign(this.pagination,{page:1,showPageInfo:!0}),this.searchData=t,await this.$emit("input",t),this.getList()},cachePageInfo(){const{storageId:t}=this;t&&this.setLocalStorage(this.storageId+"_pages",this.pagination)},tableCallBack(t){const{fnType:i,data:e}=t;i==="handleSizeChange"?(this.pagination.limit=e,this.pagination.page=1,this.getList({},!0),this.cachePageInfo()):i==="handleCurrentChange"?(this.pagination.page=e,this.getList({},!0),this.cachePageInfo()):i==="selectionChange"&&(this.selectionList=e,this.$emit("getSelectionList",e))},getList(t={},i=!1,e=!0){if(!this.sendUrl){this.$message.error("sendUrl\u5FC5\u4F20");return}for(const a in this.searchData)(this.searchData[a]===""||this.searchData[a]===void 0||this.searchData[a]===null)&&delete this.searchData[a];const s={page:this.pagination.page,limit:this.pagination.limit,...this.searchData,...this.othData,...t};this.$apis[this.sendUrl](s).then(async a=>{if(!a||a.code!==200)return;i&&(this.tableData=[],await this.$nextTick());let{data:n,list:o,total:r=0}=(a==null?void 0:a.data)||{};this.tableData=n||o||[];const h=this.getType(this.tableConfig.filterData);h==="function"&&(this.tableData=this.tableConfig.filterData(this.tableData)),h==="asyncfunction"&&(this.tableData=await this.tableConfig.filterData(this.tableData)),Object.assign(this.pagination,{totalPages:r,totalRecords:r}),e&&this.isNeedTip&&+r==0&&this.tableData.length===0&&this.$message({type:"warning",message:"\u6682\u65E0\u6570\u636E",duration:800}),this.tableConfig.visType&&this.handlerVis(),await this.$nextTick(),this.$refs.YewuTableRef&&this.$refs.YewuTableRef.renderColumns(!0)}).catch(a=>{this.Toast(a)}).finally(()=>{this.isLoading=!1})},getData(){return this.tableData},getAddData(){const t=this.$refs.searchCompRef.getSearchData();this.searchFn(t)}}},c={};var b=g(p,d,u,!1,m,null,null,null);function m(t){for(let i in c)this[i]=c[i]}var C=function(){return b.exports}();export{C as default};
