import{b}from"./index.4ae476b7.js";import{n as h,h as u,r as y}from"./index.25833e42.js";import"./qrcode.9e9071ce.js";import C from"./kl-no-data.06ff0e77.js";var w=function(){var e=this,i=e.$createElement,t=e._self._c||i;return e.visibleShare?t("div",{staticClass:"blog-share"},[t("img",{staticClass:"share-image",attrs:{src:e.shareImg,alt:""}}),t("v-popup",{staticClass:"share-bottom",attrs:{duration:.3,height:"140px"},on:{close:e.clsoseSharePopup},model:{value:e.visiblePopup,callback:function(s){e.visiblePopup=s},expression:"visiblePopup"}},[t("div",{staticClass:"bg-f5 share-popop-container"},[t("div",[t("div",{staticClass:"share-list flex-center flex-justify-between p-10-20"},e._l(e.shareList,function(s,l){return t("div",{key:s.name,class:["share-item flex-center flex-column-wrap",e.visibleShare?"enter-animate":"leave-animate"]},[t("div",{staticClass:"p-8 b-r-6 bg-fff w-40 h-40",on:{click:function(r){return e.shareEvent(l)}}},[t("img",{staticClass:"share-item-img",attrs:{src:s.url,alt:""}})]),t("span",{staticClass:"f-12 c-333 m-t-10"},[e._v(e._s(s.name))])])}),0),t("div",{staticClass:"flex-center f-14 can cancel-btn",on:{click:function(s){return s.stopPropagation(),e.clsoseSharePopup.apply(null,arguments)}}},[e._v(" \u53D6\u6D88 ")])])])])],1):e._e()},k=[];const L={props:{visibleShare:{type:Boolean,default:!1},shareInfo:{type:Object,default:()=>{}}},data(){return{visiblePopup:!1,shareList:[{name:"QQ",url:"https://ts1.cn.mm.bing.net/th?id=OIP-C.1c_TB87h4zUutxh2Hu_k0AHaHk&w=247&h=252&c=8&rs=1&qlt=90&o=6&pid=3.1&rm=2"},{name:"\u5FAE\u4FE1",url:"https://tse4-mm.cn.bing.net/th/id/OIP-C.KX_05K6jrKo-yU66jG3mNwHaFo?w=255&h=194&c=7&r=0&o=5&pid=1.7"},{name:"\u670B\u53CB\u5708",url:"https://tse2-mm.cn.bing.net/th/id/OIP-C.-iuM6lriZuLwTc1c6XJB0QHaHa?w=182&h=182&c=7&r=0&o=5&pid=1.7"},{name:"\u590D\u5236\u94FE\u63A5",url:"https://tse3-mm.cn.bing.net/th/id/OIP-C.lmHf12ZzdW_3RKrR2GZRHAAAAA?w=169&h=180&c=7&r=0&o=5&pid=1.7"},{name:"\u6D77\u62A5",url:"https://tse1-mm.cn.bing.net/th/id/OIP-C.WyqLaJi_3MQVKcSWrWEmZAHaOs?w=176&h=349&c=7&r=0&o=5&pid=1.7"}],shareImg:""}},watch:{visibleShare(e){if(e){this.init();return}}},methods:{shareEvent(){},clsoseSharePopup(){this.visiblePopup=!1;let e=setTimeout(()=>{this.$emit("close",!1),clearTimeout(e),e=null},500)},handlerShareParams(){let{share_bg_img:e,share_main_img:i,share_authorheader_img:t,share_author_name:s,share_blog_content:l}=this.shareInfo;return{share_bg_img:{url:e,width:265,height:452,top:0,left:0},share_authorheader_img:{url:t,width:70,height:70,top:48,left:153},share_author_name:{text:s,color:"#262626",size:16,top:128},share_main_img:{url:i,width:288,height:288,top:166,left:44},share_blog_content:{text:l,color:"#262626",size:16,top:466,left:40}}},drowShareImg(e){return new Promise((i,t)=>{})},async init(){let e=this.handlerShareParams();try{await this.drowShareImg(e),this.visiblePopup=!0}catch(i){console.log(i)}}}},d={};var x=h(L,w,k,!1,S,"14b97330",null,null);function S(e){for(let i in d)this[i]=d[i]}var A=function(){return x.exports}(),T=function(){var e=this,i=e.$createElement,t=e._self._c||i;return e.isLoading?e._e():t("div",{staticClass:"flex-wrap flex-center-wrap flex-justify-between page-header"},[e.article&&e.article.author_id&&e.isUserStick?t("div",{staticClass:"flex-wrap flex-center-wrap author-info"},[t("i",{staticClass:"el-icon-arrow-left f-500 f-24 c-333 pr el-icon-arrow-left-icon",on:{click:e.goBack}}),t("img",{staticClass:"author-avtor m-r-10",attrs:{src:e.parseResourceUrl(e.article.author_id.header_img)},on:{click:function(s){return e.$emit("openUserInfoPopup")}}}),t("span",{staticClass:"f-14 c-555"},[e._v(" "+e._s(e.article.author_id.username)+" ")]),t("span",{staticClass:"m-l-10 flex-center f-12 follow-btn"},[e._v("\u5173\u6CE8")])]):e._e(),t("i",{directives:[{name:"show",rawName:"v-show",value:!e.isUserStick,expression:"!isUserStick"}],staticClass:"el-icon-arrow-left f-500 f-24 c-333 pr el-icon-arrow-left-icon",on:{click:e.goBack}}),t("div",{staticClass:"tool-list"},[t("img",{attrs:{src:"//image.zlketang.com/public/news/others/imgs/blog_imgs/eb766451af2b8a3ba26381b9879a789b.png"},on:{click:e.beginPlay}}),t("img",{attrs:{src:"//image.zlketang.com/public/news/others/imgs/blog_imgs/eb766451af2b8a3ba26381b9879a789b.png"},on:{click:e.openHistory}}),t("img",{attrs:{src:"//image.zlketang.com/public/news/others/imgs/blog_imgs/a7b8d9cc5f558b4117470449bc418307.png"},on:{click:e.openSearch}}),t("img",{attrs:{src:"//image.zlketang.com/public/news/others/imgs/blog_imgs/fb27bc55668b28ccba2b2595b3f09e9d.png"},on:{click:e.openSharePopup}})]),t("blogSharePopup",{attrs:{shareInfo:e.shareInfo,visibleShare:e.visibleShare},on:{close:e.clsoseSharePopup}}),t("v-popup",{attrs:{height:"500px"},model:{value:e.historyVisible,callback:function(s){e.historyVisible=s},expression:"historyVisible"}},[t("div",{staticClass:"v-h-80 o-y-h pr"},[t("div",{staticClass:"h-45 flex-center pr f-15 f-550"},[e._v(" \u5386\u53F2\u8BB0\u5F55 ")]),t("kl-scroll",{staticClass:"p-l-10 p-r-10",attrs:{list:e.historyList,scrollHeight:455},on:{bottom:e.bottomEvent}},[e.historyList.length>0?t("articleList",{attrs:{list:e.historyList},on:{page:e.goPage}}):e._e(),e.historyList.length==0&&!e.isHistoryLoading?t("kl-no-data",{staticClass:"m-t-150"},[e._v(" \u6682\u65E0\u6570\u636E ")]):e._e()],1)],1)])],1)},P=[];const H={components:{blogSharePopup:A,articleList:b},props:{isLoading:{type:Boolean,default:!0},isUserStick:{type:Boolean,default:!1},article:{type:Object,default:()=>({})}},data(){return{shareInfo:{},isHistoryLoading:!1,isRefreshLoading:!1,visibleShare:!1,historyVisible:!1,historyList:[],pageOption:{page:1,limit:10,total:0}}},methods:{goBack(){this.$router.go(-1)},onRefresh(){this.isRefreshLoading=!0,setTimeout(()=>{this.pageOption.page=1,this.historyList=[],this.getHistoryList()},500)},goPage(e){this.historyVisible=!1,!(this.$route.params&&this.$route.params.id==e)&&(this.$emit("setHistoryRead",this.article._id),this.$emit("getArticle",e))},bottomEvent(){this.pageOption.page++,this.getHistoryList()},beginPlay(){this.$emit("beginPlay")},openHistory(){let e=document.documentElement.clientHeight||document.body.clientHeight||700;this.historyScrollHeight=Math.floor(e*.8-45)+"px",this.historyVisible=!0,this.pageOption={page:1,limit:10,total:0},this.historyList=[],this.getHistoryList()},getHistoryList(){this.isHistoryLoading=!0;let e={type:3,page:this.pageOption.page,limit:this.pageOption.limit};u.get_mobile_home_list(e).then(i=>{if(i.data){let{list:t,total:s}=i.data;t=t.filter(l=>{if(this.getType(l.article_id)=="object"){let{_id:r,article_need_token:a,class_id:o,article_bck_url:n,article_name:c,article_keywords:m,article_watch_numbers:p}=l.article_id;return l=Object.assign(l,{_id:r,class_id:o,article_keywords:m,article_name:c,article_bck_url:n,article_watch_numbers:p,article_need_token:a}),l.article_updata_time=this.klDateFormat(l.updata_time-0),l}}),this.historyList=[...this.historyList,...t],this.pageOption.total=s-0}}).catch(()=>{}).finally(()=>{this.isHistoryLoading=!1,this.isRefreshLoading=!1})},openSearch(){this.$emit("change",{name:"mobileSearchPage"})},async clsoseSharePopup(){this.visibleShare=!1},async openSharePopup(){let{article_bck_url:e,article_name:i,article_keywords:t,author_id:{username:s,header_img:l}}=this.article;this.shareInfo={share_bg_img:"https://image.zlketang.com/public/zl_wxpub/circle_poster_pic.png",share_main_img:e,share_authorheader_img:this.parseResourceUrl(l),share_author_name:s,share_blog_content:i+"=>"+t},this.visibleShare=!0},shareEvent(e){var i,t;switch(e){case 0:let s="http://connect.qq.com/widget/shareqq/index.html?",l=document.title,r=window.location.href,a=((i=document.querySelector('meta[name="description"]'))==null?void 0:i.getAttribute("content"))||"",o=((t=document.querySelector('meta[name="thumbnail"]'))==null?void 0:t.getAttribute("content"))||"",n={url:r,title:l,desc:a,pics:o,site:"\u77E5\u5D16",style:"201",width:32,height:32};window.open(this.joinParams(s,n));break}}}},g={};var I=h(H,T,P,!1,V,"5dd7e582",null,null);function V(e){for(let i in g)this[i]=g[i]}var E=function(){return I.exports}(),R=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"flex-wrap flex-center-wrap flex-justify-between page-footer"},[e._l(e.footerOption,function(s,l){return t("div",{key:s.title,staticClass:"flex-wrap flex-column-wrap flex-center-wrap page-footer-item pr",on:{click:function(r){return e.footerEvent(l)}}},[t("img",{attrs:{src:s.url}}),t("span",{staticClass:"f-12 c-555"},[e._v(" "+e._s(s.title)+" ")])])}),t("v-popup",{attrs:{height:"550px",bottom:""},model:{value:e.catalogueVisible,callback:function(s){e.catalogueVisible=s},expression:"catalogueVisible"}},[t("div",{staticClass:"catalogue-container"},[t("div",{staticClass:"flex-center pr c-333 catalogue-header f-b f-15"},[t("i",{staticClass:"el-icon-close f-18 pos-el-icon-close",on:{click:function(s){e.catalogueVisible=!1}}}),e._v(" \u76EE\u5F55 ")]),e.menuList.length?[t("div",{staticClass:"catalogue-list-container"},e._l(e.menuList,function(s){return t("a",{key:s.id,class:["ell-1 menu-item-style f-14 c-555 f-400",e.activeTitleId===s.id?"title-active":"",s.h==="h2"||s.h==="comments"?"f-550":"",s.h==="h3"?"p-l-15 f-500":"",s.h==="h4"?"p-l-30":"",s.h==="h5"?"p-l-30":"",s.h==="h6"?"p-l-30":""],on:{click:function(l){return e.goAnchor(s.id)}}},[e._v(" "+e._s(s.val)+" ")])}),0)]:t("kl-no-data",{staticClass:"p-t-30"},[e._v(" \u6CA1\u6709\u914D\u7F6E\u76EE\u5F55 ")])],2)]),t("v-popup",{attrs:{height:"220px",duration:.3},model:{value:e.recommendVisible,callback:function(s){e.recommendVisible=s},expression:"recommendVisible"}},[t("div",{staticClass:"recommend-popup-container"},[t("img",{staticClass:"close-recommend-popup",attrs:{src:"//image.zlketang.com/public/news/others/imgs/blog_imgs/231312635_03.png"},on:{click:function(s){e.recommendVisible=!1}}}),e.recommendArticle.pre||e.recommendArticle.next?[e.recommendArticle.pre&&e.recommendArticle.pre.article_name?t("p",{staticClass:"ell-2 c-555 f-15 m-t-30 l-h-30",on:{click:function(s){return e.goToArticle(e.recommendArticle.pre._id)}}},[t("span",{staticClass:"c-primary f-16"},[e._v("\u4E0A\u4E00\u7BC7\uFF1A")]),t("span",{staticClass:"recommend-tip-btn f-12"},[e._v(" \u6700\u65B0\u53D1\u5E03 ")]),e._v(" "+e._s(e.recommendArticle.pre.article_name)+" ")]):e._e(),e.recommendArticle.next&&e.recommendArticle.next.article_name?t("p",{staticClass:"ell-2 c-555 f-15 m-t-20 l-h-30",on:{click:function(s){return e.goToArticle(e.recommendArticle.next._id)}}},[t("span",{staticClass:"c-primary f-16"},[e._v("\u4E0B\u4E00\u7BC7\uFF1A")]),t("span",{staticClass:"recommend-tip-btn f-12"},[e._v(" \u6700\u65B0\u53D1\u5E03 ")]),e._v(e._s(e.recommendArticle.next.article_name)+" ")]):e._e()]:e._e(),!e.recommendArticle.pre&&!e.recommendArticle.next?t("kl-no-data",[e._v(" \u6682\u65E0\u63A8\u8350 ")]):e._e()],2)]),t("v-popup",{attrs:{height:"400px"},model:{value:e.collectionVisible,callback:function(s){e.collectionVisible=s},expression:"collectionVisible"}},[t("div",{staticClass:"collection-container"},[t("img",{staticClass:"close-recommend-popup",attrs:{src:"//image.zlketang.com/public/news/others/imgs/blog_imgs/231312635_03.png"},on:{click:function(s){e.collectionVisible=!1}}}),e.collectionList.length?[t("el-input",{staticClass:"m-t-22",model:{value:e.inputCollectionVal,callback:function(s){e.inputCollectionVal=s},expression:"inputCollectionVal"}}),t("ul",{staticClass:"m-t-20 better-scroll collection-content-scroll"},e._l(e.filterCollectionList(),function(s){return t("li",{key:s._id,class:["ell-1 f-14 collection-item",s.article_info._id==e.article._id?"c-primary":""],on:{click:function(l){return e.goToArticle(s.article_info._id)}}},[e._v(" "+e._s(s.article_info.article_name)+" ")])}),0)]:e._e(),t("kl-no-data",{staticClass:"m-t-50"},[e._v(" \u6682\u65E0\u6536\u85CF ")])],2)]),t("v-popup",{attrs:{height:"500px"},model:{value:e.commentVisible,callback:function(s){e.commentVisible=s},expression:"commentVisible"}},[e.commentVisible?t("div",{staticClass:"comment-container"},[t("comment-list",{staticClass:"mobile-comment-list",attrs:{article_id:e.article._id}})],1):e._e()])],2)},O=[];const U={components:{KlNoData:C},props:{readHistory:{type:Object,default:()=>{}},recommendArticle:{type:Object,default:()=>({})},article:{type:Object,default:()=>({})},activeTitleId:{type:String,default:""},menuList:{type:Array,default:()=>[]}},data(){return{menuActiveTitle:"",commentVisible:!1,catalogueVisible:!1,inputCollectionVal:"",collectionVisible:!1,isAnchor:!1,isColl:!1,recommendVisible:!1,footerOption:[{url:"https://image.zlketang.com/public/news/others/imgs/blog_imgs/f926a69839c3a8be4974830598cf3967.png",title:"\u76EE\u5F55"},{url:"https://image.zlketang.com/public/news/others/imgs/blog_imgs/4459ee7ab1971e73e2bf9bb2f27e6ff7.png",title:"\u8BA8\u8BBA"},{url:"https://image.zlketang.com/public/news/others/imgs/blog_imgs/68f8a2d8c7c2e589781a6b0d4bf8549e.png",title:"\u6536\u85CF"},{url:"https://image.zlketang.com/public/news/others/imgs/blog_imgs/9d23bda0ca1ab7065731a078a4f46290.png",title:"\u951A\u70B9"},{url:"https://image.zlketang.com/public/news/others/imgs/blog_imgs/eb766451af2b8a3ba26381b9879a789b.png",title:"\u63A8\u8350"},{url:"//image.zlketang.com/public/news/others/imgs/blog_imgs/eccbc87e4b5ce2fe28308fd9f2a7baf3.png",title:"\u6536\u85CF\u5217\u8868"}]}},computed:{...Vuex.mapState(["userdata","collectionList"])},watch:{activeTitleId(e){let i=this.menuList.find(t=>t.id==e);this.menuActiveTitle=i?i.val:""},article:{handler(e){this.article=e},deep:!0},isColl(e){this.footerOption[2].url=e?"https://image.zlketang.com/public/news/others/imgs/blog_imgs/88d424f4a4a7f9cc55a323a863eeb7c5.png":"https://image.zlketang.com/public/news/others/imgs/blog_imgs/68f8a2d8c7c2e589781a6b0d4bf8549e.png"},isAnchor(e){this.footerOption[3].url=e?"https://image.zlketang.com/public/news/others/imgs/blog_imgs/80f97e47b9006f493bdb85953eb662a2.png":"https://image.zlketang.com/public/news/others/imgs/blog_imgs/9d23bda0ca1ab7065731a078a4f46290.png"},readHistory:{handler(e){this.readHistory=e},deep:!0}},methods:{...Vuex.mapActions(["GET_COLLECTIONS_LIST"]),...Vuex.mapMutations(["setUserData"]),filterCollectionList(){return this.inputCollectionVal?this.collectionList.filter(e=>e.article_info.article_name.indexOf(this.inputCollectionVal)>-1):this.collectionList},goAnchor(e){this.$emit("goAnchor",{id:e}),setTimeout(()=>{this.catalogueVisible=!1},300)},collectionStatus(){let e=this.article._id;this.collectionList.findIndex(r=>r.article_info._id==e)===-1?this.isColl=!1:this.isColl=!0;let{article_anchor_point:t,article_anchor_point_title:s,user_blog_history:l}=this.userdata;if(l==1&&(this.isAnchor=t==e,(t==e||this.readHistory.read_position)&&(this.isAnchor?s=this.readHistory.read_position||s:s=this.readHistory.read_position,s))){let r=this.menuList.find(a=>a.val==s);if(!r)return;this.$message({message:"\u8BF7\u7EE7\u7EED\u9605\u8BFB",type:"info",duration:1e3}),this.$emit("goAnchor",{id:r.id,isSmooth:!1})}},goToArticle(e){this.collectionVisible=!1,this.recommendVisible=!1,this.$emit("setHistoryRead",this.article._id),this.$emit("getArticle",e)},scrollToTop(){let e=$(".title-active"),i=$(".catalogue-list-container"),{activeTitleId:t}=this;if(!e||!i||!t){this.catalogueVisible=!0;return}let s=this.menuList.findIndex(r=>r.id==t);if(s==-1){this.catalogueVisible=!0;return}let l=s*35+15;i.animate({scrollTop:l},50),this.catalogueVisible=!0},footerEvent(e){let{isColl:i,isAnchor:t}=this,l={0:()=>{this.scrollToTop()},1:()=>{this.commentVisible=!0},2:()=>{this.isColl=!i;let r=i?"delete_collection_article":"post_collection_articles",a={article_id:this.article._id};u[r](a).then(o=>{this.$klMessage(o.msg),this.GET_COLLECTIONS_LIST()}).catch(o=>{})},3:()=>{this.$confirm("\u786E\u8BA4\u4FEE\u6539\u5417?").then(r=>{this.isAnchor=!0;let{email:a,password:o}=this.userdata,n={_id:this.article._id,title:""},c={email:a,password:o,article_anchor_point:this.article._id,article_anchor_point_title:this.menuActiveTitle};u.put_userinfo(c).then(m=>{this.$klMessage("\u64CD\u4F5C\u6210\u529F");let p=this.deepClone(this.userdata);p.article_anchor_point=n._id,this.setUserData({user:p})}).catch(m=>{})}).catch(r=>{})},4:()=>{this.recommendVisible=!0},5:async()=>{let{article:r}=this;await this.GET_COLLECTIONS_LIST(),this.inputCollectionVal="",this.collectionVisible=!0;let a=this.collectionList.findIndex(o=>o.article_info._id==r._id);if(a>-1){let o=document.querySelector(".collection-content-scroll");$(o).animate({scrollTop:a*30+"px"},50)}}}[e];["asyncfunction","function"].includes(this.getType(l))?l():this.$klMessage({message:"\u656C\u8BF7\u671F\u5F85"})}}},_={};var j=h(U,R,O,!1,q,"b962e690",null,null);function q(e){for(let i in _)this[i]=_[i]}var z=function(){return j.exports}(),M=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{class:["page-content"]},[e.article.article_string?[t("div",{staticClass:"f-20 f-500"},[e._v(" "+e._s(e.article.article_name)+" ")]),e.article.author_id?t("div",{staticClass:"m-t-15 flex-wrap flex-justify-between flex-center-wrap user-info"},[t("div",{staticClass:"left flex-wrap flex-center-wrap"},[t("img",{staticClass:"m-r-10 user-avtor",attrs:{src:e.parseResourceUrl(e.article.author_id.header_img)},on:{click:e.openUserInfoPopup}}),t("div",{staticClass:"flex-wrap flex-column-wrap flex-justify-center"},[t("span",{staticClass:"f-14 c-555"},[e._v(" "+e._s(e.article.author_id.username)+" ")]),t("span",{staticClass:"m-t-5 f-12 flex-center article-label"},[e._v(" \u539F\u521B ")])])]),t("div",{staticClass:"flex-center right-btn f-10 c-555"},[e._v("\u5173\u6CE8")])]):e._e(),t("div",{directives:[{name:"highlight",rawName:"v-highlight"}],class:["mobile-page-html blog-html-page-mobile",e.pageClass]},[t("div",{domProps:{innerHTML:e._s(e.article.article_string)}})])]:e._e(),e.isLoading?t("zl-loading"):e._e(),t("kl-preview-img",{ref:"imgPreviewRef"}),t("kl-preview-code",{ref:"codePreviewRef"}),t("kl-back-top",{attrs:{el:".page-content"}})],2)},N=[];const F={props:{isLoading:{type:Boolean,default:!0},article:{type:Object,default:()=>({})}},data(){return{pageClass:""}},created(){this.pageClass=this.createId()},watch:{article:{handler(e){e&&(this.setImgPreview(),this.setIsUserStick(),this.setATagget()),this.article=e},deep:!0}},methods:{async setATagget(){await this.$nextTick(),document.querySelectorAll(`.${this.pageClass} a`).forEach(i=>{i.setAttribute("target","_blank")})},openUserInfoPopup(){this.$emit("openUserInfoPopup")},async setIsUserStick(){await this.$nextTick();let e=document.querySelector(".page-content");!e||e.addEventListener("scroll",()=>{var s;let i=document.querySelector(".mobile-page-html");((s=i==null?void 0:i.getBoundingClientRect().top)!=null?s:0)<50?this.$parent.isUserStick=!0:this.$parent.isUserStick=!1})},async setImgPreview(){await this.$nextTick();let e=this;document.querySelectorAll(".blog-html-page-mobile img").forEach(t=>{t.onclick=function(){e.$refs.imgPreviewRef.open(this.src)}})},async openPreviewCode(e){await this.$nextTick(),this.$refs.codePreviewRef.open(e)}}},f={};var B=h(F,M,N,!1,D,"25505624",null,null);function D(e){for(let i in f)this[i]=f[i]}var K=function(){return B.exports}(),G=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"page-container"},[t("pageHeader",{attrs:{isLoading:e.isLoading,isUserStick:e.isUserStick,article:e.article},on:{beginPlay:e.beginPlay,setHistoryRead:e.setHistoryRead,getArticle:e.getArticleNextPre,openUserInfoPopup:e.openUserInfoPopup,change:function(s){e.$emit("change",s)}}}),t("pageContent",{ref:"pageContentRef",attrs:{readHistory:e.readHistory,isLoading:e.isLoading,article:e.article,total:e.total},on:{openUserInfoPopup:e.openUserInfoPopup}}),t("pageFooter",{ref:"pageFooter",attrs:{recommendArticle:e.recommendArticle,readHistory:e.readHistory,article:e.article,menuList:e.menuList,activeTitleId:e.activeTitleId},on:{setHistoryRead:e.setHistoryRead,goAnchor:e.goAnchor,getArticle:e.getArticleNextPre,footerEvent:e.footerEvent}})],1)},Q=[];const W={components:{pageHeader:E,pageFooter:z,pageContent:K},data(){return{menuActiveTitle:"",timer:null,article_id:"",readHistory:{},userInfoVisible:!1,menuList:[],activeTitleId:"",total:0,article:{},recommendArticle:{},isUserStick:!1,isLoading:!0,user_id:""}},created(){this.init()},beforeDestroy(){this.setHistoryRead(this.article_id)},watch:{$route(e,i){e.params.id&&e.params.id!==i.params.id&&(this.article_id=e.params.id,this.init())}},computed:{...Vuex.mapState(["userdata"])},methods:{openUserInfoPopup(){if(this.article.author_id&&this.article.author_id._id){this.user_id=this.article.author_id._id,this.$router.push({path:"/blog/user_center",query:{user_id:this.user_id}});return}this.$klMessage("\u7528\u6237id\u4E0D\u80FD\u4E3A\u7A7A")},async getArticleNextPre(e){if(!e)return this.$klMessage("id\u4E0D\u5B58\u5728");this.isUserStick=!1,this.article={},this.$router.push({path:"/blog/page/"+e})},footerEvent(){},beginPlay(){let e=this.article.article_string.replace(/<\/h2>/g,"</h2>\u3002").replace(/<\/h3>/g,"</h3>\u3002").replace(/<\/h4>/g,"</h4>\u3002").replace(/<\/h5>/g,"</h5>\u3002").replace(/<\/h6>/g,"</h6>\u3002").replace(/<\/h7>/g,"</h7>\u3002").replace(/<[^>]+>/g,""),i=new SpeechSynthesisUtterance(e);i.lang="zh-CN",i.rate=.8,i.pitch=1,i.volume=1,window.speechSynthesis.speak(i)},setHistoryRead(e){let{user_blog_history:i}=this.userdata||{};if(i!=1)return;let t=e,{pageFooter:s}=this.$refs;if(t&&s){let{menuActiveTitle:l}=s;if(this.menuActiveTitle===l)return;this.menuActiveTitle=l,u.post_author_read_history({article_id:t,read_position:l}).then(()=>{}).catch(()=>{})}},init(e){if(e&&this.$router.push({path:"/blog/page/"+e}),!this.isLogin())return this.$router.replace("/login");let{params:i}=this.$route;if(!e&&!i.id)return this.$klMessage("\u53C2\u6570\u9519\u8BEF\uFF01");clearInterval(this.timer),this.timer=null,this.timer=setInterval(()=>{this.setHistoryRead(this.article_id)},1e3*5);let t=e||i.id;this.getArticle(t)},getArticle(e){this.article_id=e,this.isLoading=!0;let i=Date.now();y({_id:e,type:2}).then(t=>{let{total:s,article:l,recommendArticle:r,readHistory:a}=t.data;l.article_string=l==null?void 0:l.article_content,this.total=s?s-0:0,this.article=this.getType(l)=="object"?l:{},this.recommendArticle=this.getType(r)=="object"?r:{},this.readHistory=a||{},document.title=l.article_name||"\u6587\u7AE0\u8BE6\u60C5"}).catch(()=>{}).finally(()=>{let t=800,s=Date.now()-i;s>t?this.pageEvent():setTimeout(()=>{this.pageEvent()},t-s)})},async pageEvent(){var i;this.isLoading=!1,await this.$nextTick();let e=this.getAllHtitle()||[];this.menuList=this.creatTitleList(e),this.menuListScroll(),await this.$nextTick(),(i=this.$refs.pageFooter)==null||i.collectionStatus(),this.addCodePreviewEvent(),this.setLineNumber()},setLineNumber(){document.querySelectorAll(".blog-html-page-mobile pre").forEach(i=>{let t=document.createElement("ul"),r=i.querySelector("code").innerHTML.split(`
`),a="",o=r.length;if(o>0){for(let c=0;c<o-1;c++)a+=`<li class="line-number-li">${c+1}</li>`;t.innerHTML=a,i.appendChild(t)}let n=document.createElement("div");n.className="line-number-div",n.innerHTML='<div class="line-number-div-item"></div><div class="line-number-div-item"></div><div class="line-number-div-item"></div>',i.appendChild(n)})},addCodePreviewEvent(){let e=$("pre"),i='<i class="p-a f-20 f-550 c-fff el-icon-full-screen pos-icon-full-screen"></i>';e.each((s,l)=>{$(l).append(i),$(l).find(".pos-icon-full-screen").on("click",()=>{var r;(r=this.$refs.pageContentRef)==null||r.openPreviewCode(l)})});let t=document.querySelectorAll("pre");!t||t.length===0||(t=Array.from(t),t.forEach(s=>{let l=s.querySelector("code"),r=l.className,a=document.createElement("div");if(r&&r.includes("lang-da")){a.className=`da-btn ${this.createId()}`,a.innerHTML="\u67E5\u770B\u7B54\u6848",s.appendChild(a),a.addEventListener("click",()=>{a.innerHTML==="\u67E5\u770B\u7B54\u6848"?(a.innerHTML="\u9690\u85CF\u7B54\u6848",l.classList.add("show-da")):(a.innerHTML="\u67E5\u770B\u7B54\u6848",l.classList.remove("show-da"))});return}}))},getAllHtitle(e=2,i=[]){let t=document.querySelector(".page-content");if(!t)return;let s=t.getBoundingClientRect().top||50;if(+e==7)return i;if($(`h${e}`).length)for(let l=0;l<$(`h${e}`).length;l++){let r=$(`h${e}`).eq(l).text();if(!$(`h${e}`).eq(l))return;let a=$(`h${e}`).eq(l).offset().top-s,o={id:this.createId(),val:r,top:a,h:`h${e}`},n=`<a id='${o.id}'></a>${r}`;$(`h${e}`).eq(l).html(n),i.push(o)}return this.getAllHtitle(e+1,i)},goAnchor({id:e,isSmooth:i=!0}){let t=this;document.querySelector(".page-content").removeEventListener("scroll",this.blogPgeCodeScrollEvent),this.activeTitleId=e,document.querySelector(`#${e}`).scrollIntoView({behavior:i?"smooth":"auto"}),setTimeout(()=>{t.menuListScroll()},1e3)},creatTitleList(e){let i=[];if(e.length===0)return[];e=e.sort((t,s)=>t.top-s.top);for(let t=0;t<e.length;t++)i.push(e[t]);return i},menuListScroll(){let e=document.querySelector(".page-content");!e||(e.removeEventListener("scroll",this.blogPgeCodeScrollEvent),e.addEventListener("scroll",this.blogPgeCodeScrollEvent))},blogPgeCodeScrollEvent(e){let{menuList:i}=this,t=$(".page-content"),s=t.scrollTop()?t.scrollTop()-0:0,l=i.length;for(let r=0;r<l-1;r++){if(s>=i[l-1].top){this.activeTitleId=i[l-1].id;break}if(s>=i[r].top&&s<i[r+1].top){this.activeTitleId=i[r].id;break}}}}},v={};var Z=h(W,G,Q,!1,J,null,null,null);function J(e){for(let i in v)this[i]=v[i]}var ie=function(){return Z.exports}();export{ie as default};
