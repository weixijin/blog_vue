import{n as f,h,b as d}from"./index.25833e42.js";import{Q as g}from"./qrcode.9e9071ce.js";var k=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("klDialog",{staticClass:"qr-code-dialog",attrs:{center:"",width:"300px",title:"\u4E8C\u7EF4\u7801",dialogVisible:e.dialogVisible,nobg:""},on:{close:function(a){e.dialogVisible=!1},determine:e.submit},scopedSlots:e._u([{key:"header",fn:function(){return[t("i")]},proxy:!0},{key:"footer",fn:function(){return[t("i")]},proxy:!0}])},[t("div",{staticClass:"qr-code-container"},[t("div",{ref:"codeRef",staticClass:"pos-img",attrs:{id:"qrcode"}}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.canvasImg,expression:"canvasImg"}],staticClass:"pr flex-img"},[t("img",{staticClass:"img-bg",attrs:{src:e.canvasImg},on:{click:function(a){e.dialogVisibleImg=!0}}}),t("el-button",{staticClass:"m-t-15",attrs:{type:"primary"},on:{click:e.downloadImg}},[e._v(" \u4E0B\u8F7D ")])],1),e.canvasImg?e._e():t("div",{staticClass:"loading-code"},[t("i",{staticClass:"el-icon-loading c-fff"}),t("p",{staticClass:"c-fff"},[e._v("\u4E8C\u7EF4\u7801\u751F\u6210\u4E2D")])])]),t("klDialog",{attrs:{center:"",width:"440px",dialogVisible:e.dialogVisibleImg,nobg:""},on:{close:function(a){e.dialogVisibleImg=!1}},scopedSlots:e._u([{key:"header",fn:function(){return[t("i")]},proxy:!0},{key:"footer",fn:function(){return[t("i")]},proxy:!0}])},[t("img",{staticClass:"big-img",attrs:{src:e.canvasImg,alt:""}})])],1)},y=[];const C={props:{ac_id:{type:String,default:""}},data(){return{dialogVisibleImg:!1,dialogVisible:!1,qrCode:"",qrcode:"",bgImgUrl:"//image.zlketang.com/public/news/others/imgs/school_code/bg-2.png",canvasImg:"",acData:{}}},methods:{submit(){},sleep(e){return new Promise(i=>{setTimeout(()=>{i()},e)})},async init(){this.canvasImg="";let e=this;await this.$nextTick();let i=await h.get_ac_page({ac_id:this.ac_id});this.acData=i.data.data;let{ac_url:t,ac_name:a}=this.acData;$("#qrcode").html(""),this.qrcode=new g(this.$refs.codeRef,{text:d+"ac/"+t,width:880,height:880,colorDark:"#333333",colorLight:"#ffffff",correctLevel:g.CorrectLevel.H}),html2canvas(this.$refs.codeRef,{backgroundColor:null,width:880,height:880}).then(n=>{var l=n.toDataURL("image/jpeg");this.qrCode=l;let{bgImgUrl:p,qrCode:v}=this,o=document.createElement("canvas");o.width=880,o.height=880;let s=o.getContext("2d");if(!s)return e.$message.error("\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301canvas,\u8BF7\u4F7F\u7528\u8C37\u6B4C\u6216edge");s.rect(0,0,o.width,o.height),s.fillStyle="#ffffff",e.roundRect(s,0,0,880,880,20),s.fill();let r=new Image;r.src=p,r.crossOrigin="Anonymous",r.onload=()=>{s.drawImage(r,0,-4,880,884),e.roundRect(s,200,200,480,480,20);let c=new Image;c.src=v,c.crossOrigin="Anonymous",c.onload=()=>{s.drawImage(c,232,232,416,416),s.fillStyle="#fff",s.font="normal normal 600 64px Adobe Ming Std",s.textAlign="center",s.fillText("\u626B\u7801\u67E5\u770B",440,140),s.fillStyle="#fff",s.font="normal normal 400 48px Adobe Ming Std",s.fillText(a,440,780),setTimeout(()=>{let b=o.toDataURL("image/png");e.canvasImg=b},0)}}})},roundRect(e,i,t,a,n,l){a<2*l&&(l=a/2),n<2*l&&(l=n/2),e.beginPath(),e.fillStyle="#fff",e.strokeStyle="#fff",e.moveTo(i+l,t),e.arcTo(i+a,t,i+a,t+n,l),e.arcTo(i+a,t+n,i,t+n,l),e.arcTo(i,t+n,i,t,l),e.arcTo(i,t,i+a,t,l),e.stroke(),e.fill(),e.closePath(),e.beginPath()},downloadImg(){let e=document.createElement("a");e.download=this.acData.ac_name||"\u77E5\u5D16",e.href=this.canvasImg,document.body.appendChild(e),e.click(),e.remove()}}},u={};var w=f(C,k,y,!1,D,"22f52a25",null,null);function D(e){for(let i in u)this[i]=u[i]}var I=function(){return w.exports}(),S=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("e-dialog",{attrs:{top:"100px",width:"600px",title:"\u65B0\u589E\u9875\u9762",footer:!1},on:{closed:e.closed},model:{value:e.dialogVisible,callback:function(a){e.dialogVisible=a},expression:"dialogVisible"}},[t("div",{staticClass:"dialog-main"},[t("kl-upload",{ref:"klUploadref",attrs:{isShowPreFile:""},on:{success:e.uploadSuccess}})],1)])},F=[];const R={data(){return{dialogVisible:!1,isHaveUpload:!1}},methods:{closed(){this.$refs.klUploadref.init(),this.isHaveUpload&&this.$emit("init")},uploadSuccess(){this.isHaveUpload=!0}}},_={};var T=f(R,S,F,!1,x,"12c59c88",null,null);function x(e){for(let i in _)this[i]=_[i]}var A=function(){return T.exports}(),E=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"p-20 bg-F7F8FA h-100vh"},[t("TrainPage",{ref:"TrainPageRef",attrs:{searchConfig:e.searchConfig,tableConfig:e.tableConfig,sendUrl:"get_net_dists",customize:""}}),t("ShareQrCode",{ref:"ShareQrCodeRef",attrs:{ac_id:e.ac_id}}),t("EditAcDialog",{ref:"EditAcDialogRef",on:{init:e.init}})],1)},V=[];const U={name:"netdistList",components:{ShareQrCode:I,EditAcDialog:A},data(){return{ac_id:"",searchConfig:[{label:"\u6587\u4EF6\u72B6\u6001",type:"select",modelName:"netdisk_status",options:[{value:"0",label:"\u4F7F\u7528"},{value:"1",label:"\u7981\u7528"},{value:"2",label:"\u5220\u9664"}]},{label:"\u540D\u79F0",type:"input",modelName:"content"}],tableConfig:{isSelection:!1,maxHeightFlag:!1,stripe:!0,filterData:e=>e.map(i=>{let{netdisk_create_time:t,netdisk_size:a}=i;return{...i,_netdisk_create_time:this.klDateFormat(t),_netdisk_size:this.getSize(a)}}),btns:{children:[{label:"\u65B0\u589E",type:"success",clickFn:()=>{this.DialogEvent({type:"add",ac_id:""})}},{label:"\u4E0A\u4F20",type:"primary",clickFn:()=>{this.DialogEvent({type:"add",ac_id:""})}},{label:"\u5728\u7EBF\u6587\u4EF6\u538B\u7F29",type:"info",clickFn:()=>{this.goTo("https://www.wetools.com/js-compress",{target:"_blank"})}}]},columnObj:[{label:"\u6587\u4EF6\u540D\u79F0",props:"netdisk_name",clickFn:e=>{this.goTo(d+e.netdisk_url,{target:"_blank"})}},{label:"\u6587\u4EF6\u5927\u5C0F",props:"_netdisk_size"},{label:"\u521B\u5EFA\u65F6\u95F4",props:"_netdisk_create_time"},{label:"\u64CD\u4F5C",slot:"projectDetail",props:"action",lock:!0,fixed:"right",children:[{label:"\u590D\u5236\u94FE\u63A5",type:"primary",clickFn:e=>{this.copyLink(e)}},{label:"\u4E0B\u8F7D",type:"primary",clickFn:e=>{this.download1(e)}},{label:"\u7981\u7528",type:"warning",clickFn:e=>{this.putNetdist(e,1)}},{label:"\u5220\u9664",type:"danger",clickFn:e=>{this.putNetdist(e,2)}}]}]}}},methods:{init(){this.initTable()},getSize(e){return+e?e<1024?e+"B":e<1024*1024?(e/1024).toFixed(2)+"KB":(e/1024/1024).toFixed(2)+"MB":"\u672A\u77E5"},async DialogEvent({type:e,ac_id:i}){!this.$refs.EditAcDialogRef||e==="add"&&(this.ac_id="",this.$refs.EditAcDialogRef.title="\u8D44\u6E90\u4E0A\u4F20",this.$refs.EditAcDialogRef.dialogVisible=!0)},download1({netdisk_url:e}={}){this.download(d+e)},copyLink(e){let{netdisk_url:i}=e;this.copy({data:d+i,success:()=>{this.$message.success("\u590D\u5236\u6210\u529F")},fail:()=>{this.$message.error("\u590D\u5236\u5931\u8D25")}})},async putNetdist({_id:e},i="1"){!e||!await this.$confirm(+i==1?"\u786E\u5B9A\u7981\u7528\u5417\uFF1F":"\u786E\u5B9A\u5220\u9664\u5417?").catch(()=>!1)||h.putNetdist({_id:e,netdisk_status:i}).then(()=>{this.$message.success("\u64CD\u4F5C\u6210\u529F"),this.init()}).catch(a=>{this.Toast(a)})}}},m={};var q=f(U,E,V,!1,L,null,null,null);function L(e){for(let i in m)this[i]=m[i]}var P=function(){return q.exports}();export{P as default};
