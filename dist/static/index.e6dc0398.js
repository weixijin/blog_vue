import{u as l,L as c,r as h,n as m}from"./index.25833e42.js";import{b as u}from"./index.4ae476b7.js";var p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mobile-home-header"},[i("div",{staticClass:"mobile-home-header-container p-l-10 p-r-10"},[i("i",{staticClass:"el-icon-arrow-left f-24 f-500 m-r-10",on:{click:t.backHome}}),i("div",{staticClass:"mobile-home-header-search-left pr"},[i("i",{staticClass:"el-icon-search m-r-8"}),i("input",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"mobile-home-header-search-input",class:["mobile-home-header-search-left-input f-14",t.isSearch?"bg-f2":""],attrs:{type:"text"},domProps:{value:t.content},on:{focus:t.inputFocus,keydown:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"enter",13,s.key,"Enter")?null:t.getArticles.apply(null,arguments)},input:function(s){s.target.composing||(t.content=s.target.value)}}})]),i("div",{staticClass:"m-l-10 f-15 c-555",on:{click:t.getArticles}},[t._v("\u641C\u7D22")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isSearch,expression:"isSearch"}],staticClass:"mobile-pos-history-recommend",on:{click:function(s){t.isSearch=!1}}},[t._m(0),i("div",{staticClass:"mobile-history-content"},t._l(t.historyList,function(s){return i("div",{key:s.id,staticClass:"mobile-history-content-item",on:{click:function(a){return t.getArticles(s)}}},[i("span",[t._v(" "+t._s(s.content)+" ")]),i("i",{staticClass:"el-icon-close",on:{click:function(a){return a.stopPropagation(),t.delHistoryContent(s.id)}}})])}),0),i("div",{staticClass:"mobile-recommend-title"},[t._v("\u731C\u4F60\u60F3\u641C")]),i("div",{staticClass:"mobile-recommend-content"},t._l(t.recommendList,function(s){return i("div",{key:s._id,staticClass:"mobile-recommend-content-item",on:{click:function(a){return t.getArticles(s)}}},[t._v(" "+t._s(s.article_name)+" ")])}),0)]),i("div",{staticClass:"search-list"},[i("klScroll",{staticClass:"p-t-15 p-b-20",attrs:{list:t.list,scrollHeight:t.scrollHeight,pageOption:t.pageOption},on:{scroll:t.scrollTopNumber,bottom:t.bottom}},[i("articleList",{attrs:{list:t.list},on:{page:t.goPage}})],1)],1)])},d=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mobile-history-title"},[t._v(" \u5386\u53F2\u641C\u7D22 "),i("i",{staticClass:"el-icon-delete"})])}];const g={components:{articleList:u},props:{from:{type:String,default:"page"}},data(){return{isLoading:!0,pageOption:{page:1,limit:10,total:0},list:[],scrollHeight:0,content:"",isSearch:!0,historyList:[],recommendList:[],articleInfo:{},scrollTop:0}},activated(){this.init()},mounted(){this.scrollHeight=document.documentElement.clientHeight-40||0},computed:{...Vuex.mapState(["userdata"]),userCreateDate(){if(this.userdata){let{register_time:t}=this.userdata;return Math.ceil((Date.now()-new Date(t).getTime())/1e3/60/60/24)}}},methods:{bottom(){this.pageOption.page++;let{page:t,limit:e,total:i}=this.pageOption;t*e>=i||this.getList()},backHome(){this.scrollTop=0,this.list=[],this.isSearch=!0,this.content="",this.$emit("change",{name:this.from})},scrollTopNumber(t){this.scrollTop=t},goPage(t){let{path:e}=this.$route;if(e.includes("/blog/page")){this.$emit("reloadArticle",{name:"page",_id:t});return}this.$router.push("/blog/page/"+t)},delHistoryContent(t){this.setStore("historyList",this.historyList.filter(e=>e.id!==t))},getArticles(t){let{content:e,article_name:i}=t;if((i||e)&&(this.content=i||e),this.content.trim().length===0){this.$klMessage("\u8BF7\u8F93\u5165\u641C\u7D22\u5185\u5BB9");return}this.list=[],this.pageOption.page=1,this.getList()},getList(){let{content:t}=this,{page:e,limit:i}=this.pageOption,s={page:e,limit:i,content:t};this.saveHistory(t),this.isLoading=!0,l(s).then(a=>{let{data:r,total:n}=a.data;Array.isArray(r)&&(this.list=[...this.list,...r],this.pageOption.total=n-0)}).catch(()=>{}).finally(()=>{this.isLoading=!1,this.isSearch=!1,this.getHistoryList()})},async getHistoryList(){let t=await this.getStore("historyList",[]),e=Math.floor(Math.random()*10)+10;this.historyList=t.sort((i,s)=>s.time-i.time).slice(0,e)},async saveHistory(t){let e=await this.getStore("historyList",[]),i={id:this.createId(),content:t,number:1,time:Date.now()};e.every(s=>s.content!==t)?e.push(i):e=e.map(s=>(s.content===t&&(s.number++,s.time=Date.now()),s)),this.setStore("historyList",e)},getRecommendList(){let t=Math.floor(Math.random()*5)+10;c({limit:t,cache:!0}).then(e=>{this.recommendList=(e==null?void 0:e.data)||[]})},getArticleInfo(){if(this.getType(this.userdata)!=="object")return;let{article_anchor_point:t}=this.userdata;h({_id:t,type:1}).then(e=>{if(this.getType(e.data.article)=="object"){this.articleInfo=e.data.article;return}this.saveError("\u8FD4\u56DE\u7684\u6587\u7AE0\u4FE1\u606F\u4E0D\u662F\u5BF9\u8C61")}).catch(e=>{})},init(){let{list:t,scrollTop:e}=this;if(t.length&&scroll){let s=$(".zl-scroll");if(!s)return;s.scrollTop(e)}let i=document.querySelector(".mobile-home-header-search-input");i&&i.focus(),this.getRecommendList(),this.getHistoryList(),this.pushState()},pushState(){window.addEventListener("popstate",this.deviceBackAction,!1),!(history.state&&history.state.page&&history.state.page==="dynamic")&&history.pushState({page:"dynamic"},null)},deviceBackAction(){this.$emit("back")},inputFocus(){this.getHistoryList(),this.isSearch=!0}}},o={};var f=m(g,p,d,!1,y,"479f9bc4",null,null);function y(t){for(let e in o)this[e]=o[e]}var b=function(){return f.exports}();export{b as default};
