import{h as l,n as g}from"./index.25833e42.js";var d=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"code notes-list-page o-h b-r-4"},[t("TrainPage",{ref:"TrainPageRef",attrs:{searchConfig:e.searchConfig,tableConfig:e.tableConfig,sendUrl:"get_note_bug_apis",customize:""}},[t("template",{slot:"btnList"},[t("el-button",{attrs:{type:"success"},on:{click:function(a){return e.openDialog("add")}}},[e._v("\u65B0\u589E")])],1)],2),t("e-dialog",{attrs:{title:e.dialogOption.title,width:"600px"},on:{closed:e.closeDialogBefore,confirm:e.post_note_bug_api},model:{value:e.dialogOption.dialogVisible,callback:function(a){e.$set(e.dialogOption,"dialogVisible",a)},expression:"dialogOption.dialogVisible"}},[t("div",{staticClass:"p-20 p-b-0"},[t("el-form",{ref:"addoreditRef",staticClass:"demo-ruleForm",attrs:{model:e.dialogOption.ruleForm,rules:e.dialogOption.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"bug\u5185\u5BB9",prop:"bug_content"}},[t("el-input",{attrs:{type:"textarea",rows:7},model:{value:e.dialogOption.ruleForm.bug_content,callback:function(a){e.$set(e.dialogOption.ruleForm,"bug_content",a)},expression:"dialogOption.ruleForm.bug_content"}})],1),t("el-form-item",{attrs:{label:"bug\u5206\u7C7B"}},[t("el-select",{attrs:{clearable:"",placeholder:"\u8BF7\u9009\u62E9"},model:{value:e.dialogOption.ruleForm.bug_type,callback:function(a){e.$set(e.dialogOption.ruleForm,"bug_type",a)},expression:"dialogOption.ruleForm.bug_type"}},e._l(e.bugTypeOptions,function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.value}})}),1)],1),t("el-form-item",{attrs:{label:"bug\u6B21\u6570"}},[t("el-input-number",{attrs:{min:1,label:"bug\u6B21\u6570"},model:{value:e.dialogOption.ruleForm.bug_number,callback:function(a){e.$set(e.dialogOption.ruleForm,"bug_number",a)},expression:"dialogOption.ruleForm.bug_number"}})],1),t("el-form-item",{attrs:{label:"\u8870\u51CF\u5468\u671F"}},[t("el-input-number",{attrs:{min:1},model:{value:e.dialogOption.ruleForm.decay_date,callback:function(a){e.$set(e.dialogOption.ruleForm,"decay_date",a)},expression:"dialogOption.ruleForm.decay_date"}})],1)],1)],1)])],1)},b=[];const _={components:{},data(){return{scrollHeight:0,optionsType:[],that:this,filterRow:[],dialogOption:{dialogVisible:!1,title:"\u65B0\u589E",_id:"",ruleForm:{_id:"",bug_content:"",bug_type:"3",bug_number:1,decay_date:10},rules:{bug_content:[{required:!0,message:"\u8BF7\u8F93\u5165bug\u5185\u5BB9",trigger:"blur"},{min:1,message:"\u957F\u5EA6\u5927\u4E8E0",trigger:"blur"}]}},searchOption:{keywords:"",bug_type:""},tableData:[],pageOption:{pageSizes:[30,50,100],limit:30,total:0,page:1},searchConfig:[{label:"\u5173\u952E\u5B57",type:"input",modelName:"keywords"},{label:"\u5206\u7C7B",type:"select",modelName:"bug_type",options:[]}],tableConfig:{isSelection:!1,maxHeightFlag:!1,stripe:!0,filterData:e=>this.handlerTableData(e),columnObj:[{label:"\u7C7B\u578B",props:"bug_type_label"},{label:"\u5185\u5BB9",props:"_bug_content",html:!0,minWidth:200},{label:"\u6B21\u6570",props:"bug_number",clickFn:e=>{this.updataBugNumber(e)}},{label:"\u8870\u51CF\u5468\u671F",props:"decay_date"},{label:"\u575A\u6301\u65F6\u957F",props:"_persistence_time"},{label:"\u624B\u52A8\u66F4\u65B0\u65F6\u95F4",props:"_bug_updata_time",minWidth:120},{label:"\u81EA\u52A8\u66F4\u65B0\u65F6\u95F4",props:"_auto_update_time",minWidth:120},{label:"\u521B\u5EFA\u65F6\u95F4",props:"_bug_create_time",minWidth:120},{label:"\u64CD\u4F5C",slot:"projectDetail",props:"action",lock:!0,fixed:"right",children:[{label:"\u7F16\u8F91",type:"warning",clickFn:e=>{this.openDialog("edit",e)}},{label:"\u5220\u9664",type:"danger",clickFn:e=>{this.deleteBug(e)}}]}]}}},filters:{filterAuthorsTime(e,i){return e?i.moment(e-0,3):"\u6CA1\u6709\u8BBE\u7F6E"}},computed:{...Vuex.mapGetters(["bugTypeOptions"])},created(){this.searchConfig[1].options=this.bugTypeOptions},methods:{deleteBug({_id:e}){this.$confirm("\u786E\u5B9A\u5220\u9664\u5417").then(i=>{l.delete_note_bug_api(this.filterQuery({_id:e})).then(t=>{this.$message.success(t.msg)}).catch().finally(()=>{this.$refs.TrainPageRef.getAddData()})}).catch(()=>{this.$message.success("\u53D6\u6D88\u6210\u529F")})},post_note_bug_api(){this.$refs.addoreditRef.validate(e=>{if(e){let{title:i}=this.dialogOption;i==="\u65B0\u589E"&&l.post_note_bug_api(this.filterQuery(this.dialogOption.ruleForm)).then(t=>{this.$message.success(t.msg),this.dialogOption.dialogVisible=!1}).catch().finally(()=>{this.$refs.TrainPageRef.getAddData()}),i==="\u7F16\u8F91"&&l.put_note_bug_api(this.dialogOption.ruleForm).then(t=>{this.$message.success(t.msg),this.dialogOption.dialogVisible=!1,this.$refs.TrainPageRef.tableData=this.handlerTableData(this.$refs.TrainPageRef.tableData.map(a=>(a._id===t.data.data._id&&(a=Object.assign(a,t.data.data)),a)))}).catch()}})},handlerTableData(e){return e.map(i=>{var r;let{bug_type:t,bug_create_time:a,bug_updata_time:o,bug_content:u,auto_update_time:s}=i;return{...i,_bug_content:u.replace(/\n/g,"<br>"),_bug_create_time:this.klDateFormat(a),_bug_updata_time:this.klDateFormat(o),_auto_update_time:s?this.klDateFormat(s):"",_persistence_time:a&&o?Math.floor((Date.now()-o)/(3600*24*1e3))+"\u5929":"0\u5929",bug_type_label:((r=this.bugTypeOptions.find(p=>+p.value==+t))==null?void 0:r.label)||"\u672A\u8BBE\u7F6E"}})},updataBugNumber(e){let i=this.deepClone(e);i.bug_number=i.bug_number-0+1,l.put_note_bug_api(this.filterQuery(i)).then(t=>{this.$message.success(t.msg),this.$refs.TrainPageRef.tableData=this.handlerTableData(this.$refs.TrainPageRef.tableData.map(a=>(a._id===t.data.data._id&&(a=Object.assign(a,t.data.data)),a)))}).catch(()=>{})},closeDialogBefore(){this.dialogOption.ruleForm={_id:"",bug_content:"",bug_type:"3",bug_number:1,decay_date:10},this.dialogOption.dialogVisible=!1},openDialog(e="add",i){let t={add:"\u65B0\u589E",edit:"\u7F16\u8F91"};this.dialogOption.title=t[e],e==="edit"&&(this.dialogOption.ruleForm=this.deepClone(i)),this.dialogOption.dialogVisible=!0}}},n={};var c=g(_,d,b,!1,m,"c04f865c",null,null);function m(e){for(let i in n)this[i]=n[i]}var f=function(){return c.exports}();export{f as default};
