import b from"./index.3770402b.js";import{n as u}from"./index.25833e42.js";import{j as v}from"./data.d27333a2.js";import"./chatItem.cc13e145.js";var x=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"demo"},[e._v(e._s(e.surplusTime)+"s")])},y=[];const $={props:{time:{type:Number,default:0},all_time:{type:Number,default:0},status:{type:String,default:""},gobang_id:{type:String,default:""}},data(){return{timer:null,useTime:0}},watch:{status:{handler(e){if(e==2){this.init();return}this.clearTimer()},immediate:!0}},computed:{surplusTime(){return this.time-this.useTime}},beforeDestroy(){this.clearTimer()},methods:{clearTimer(){clearInterval(this.timer),this.timer=null},async init(){this.clearTimer(),this.timer=setInterval(()=>{this.useTime+=1,this.useTime>this.time&&(this.$emit("timeOver"),this.clearTimer())},1e3)}}},m={};var B=u($,x,y,!1,C,null,null,null);function C(e){for(let s in m)this[s]=m[s]}var w=function(){return B.exports}(),S=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("e-dialog",{attrs:{customClass:"gobandSYs",title:"\u5BF9\u5C40\u786E\u8BA4",width:"500px",clickModal:!1},on:{confirm:e.confirm},model:{value:e.visable,callback:function(i){e.visable=i},expression:"visable"}},[t("div",{staticClass:"p-20"},[e.step_content?t("div",{staticClass:"c-primary"},[e._v(" \u60A8\u5DF2\u9009\u4E2D"+e._s(e.getQi)+",\u5BF9\u5C40\u5F00\u59CB\u524D\u4F9D\u7136\u53EF\u4EE5\u66F4\u6539 ")]):e._e(),t("div",{staticClass:"flex-center-wrap m-t-10"},[t("div",{staticClass:"w-80"},[e._v("\u601D\u8003\u95F4\u9694\uFF1A")]),t("el-input",{staticClass:"w-120",attrs:{type:"number",min:"10",max:"3600"},model:{value:e.max_move_time1,callback:function(i){e.max_move_time1=i},expression:"max_move_time1"}}),e._v(" \xA0 \u79D2 ")],1),t("div",{staticClass:"flex-center-wrap m-t-20"},[t("div",{staticClass:"w-80"},[e._v("\u6211\u65B9\uFF1A")]),t("el-radio",{attrs:{disabled:e.heiDisabled,label:"2"},model:{value:e.step_content1,callback:function(i){e.step_content1=i},expression:"step_content1"}},[e._v("\u9ED1\u68CB")]),t("el-radio",{attrs:{disabled:e.baiDisabled,label:"1"},model:{value:e.step_content1,callback:function(i){e.step_content1=i},expression:"step_content1"}},[e._v("\u767D\u68CB")])],1)])])},k=[];const j={props:{value:{type:Boolean,default:!1},step_content:{type:Number,default:0},max_move_time:{type:Number,default:0},gameBase:{type:Object,default:()=>({})},getQi:{type:String,default:""}},data(){return{max_move_time1:0,step_content1:this.step_content}},computed:{...Vuex.mapState(["userdata"]),visable:{get(){return this.value},set(){return this.$emit("input",!1)}},heiDisabled(){return!!this.gameBase.hei_user_id},baiDisabled(){return!!this.gameBase.bai_user_id}},watch:{step_content(e){this.step_content1=e},max_move_time(e){this.max_move_time1=e},gameBase:{handler(e){},deep:!0}},methods:{confirm(){let{max_move_time1:e,step_content1:s}=this;if(e<10||e>3600){this.$message.error("\u601D\u8003\u95F4\u9694\u5FC5\u987B\u572810-3600\u79D2\u4E4B\u95F4");return}if(!s){this.$message.error("\u8BF7\u9009\u62E9\u68CB\u5B50\u989C\u8272\uFF0C\u9ED1\u68CB\u5148\u884C~");return}let t={max_move_time:e},{_id:i}=this.userdata;s==1&&(t.bai_user_id=i),s==2&&(t.hei_user_id=i),this.$emit("confirm",t)}}},d={};var T=u(j,S,k,!1,L,"2c173699",null,null);function L(e){for(let s in d)this[s]=d[s]}var I=function(){return T.exports}(),R=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("e-dialog",{attrs:{width:e.type==1?"300px":"500px",title:"\u6094\u68CB\u786E\u8BA4\u6846",footer:!1,showClose:!1},model:{value:e.visable,callback:function(i){e.visable=i},expression:"visable"}},[t("div",{staticClass:"p-20 f-550 c-primary"},[e.type==1?t("div",[e._v("\u5DF2\u53D1\u8D77\u6094\u68CB\uFF0C\u7B49\u5F85\u5BF9\u65B9\u786E\u8BA4...")]):e._e(),e.type==2?t("div",[e._v(" \u4F60\u7684\u5BF9\u624B\u53D1\u8D77\u4E86\u6094\u68CB\uFF0C\u8BF7\u786E\u8BA4\uFF1A "),t("el-radio",{attrs:{label:"1"},on:{change:e.regret_resultChange},model:{value:e.regret_result,callback:function(i){e.regret_result=i},expression:"regret_result"}},[e._v("\u540C\u610F")]),t("el-radio",{attrs:{label:"2"},on:{change:e.regret_resultChange},model:{value:e.regret_result,callback:function(i){e.regret_result=i},expression:"regret_result"}},[e._v("\u62D2\u7EDD")])],1):e._e()])])},M=[];const O={props:{value:{type:Boolean,default:!1},gameBase:{type:Object,default:()=>()=>({})},type:{type:Number,default:0}},data(){return{regret_result:0}},computed:{...Vuex.mapState(["userdata"]),visable:{get(){return this.regret_result=0,this.value},set(){this.$emit("input",!1)}}},methods:{regret_resultChange(){this.$emit("regret_resultChange",{regret_result:this.regret_result})}}},h={};var D=u(O,R,M,!1,E,null,null,null);function E(e){for(let s in h)this[s]=h[s]}var Q=function(){return D.exports}(),H=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"goband-bg",style:e.getBoxStyle()},[t("div",{staticClass:"goband",style:e.getBandStyle()},e._l(e.list,function(i,a){return t("div",{key:a,staticClass:"goband-line flex-wrap"},e._l(i,function(_,o){return t("div",{key:o,staticClass:"goband-line-item",style:e.getItemStyle(_),on:{click:function(l){return e.clickHandle(a,o)}}})}),0)}),0)])},z=[];const N={props:{list:{type:Object,default:()=>[]},config:{type:Object,default:()=>({})}},data(){return{baiBg:"",heiBg:"",boxBg:""}},computed:{...Vuex.mapState(["userdata"])},watch:{list:{handler(e){this.list=e},deep:!0}},created(){this.init()},methods:{init(){this.initIndexDb()},async initIndexDb(){Promise.all([this.getIndexDBIMJ("https://image.zlketang.com/public/news/others/blog/imgs/w_bg.png"),this.getIndexDBIMJ("https://image.zlketang.com/public/news/others/blog/imgs/w_bai.png"),this.getIndexDBIMJ("https://image.zlketang.com/public/news/others/blog/imgs/w_hei.png")]).then(e=>{this.boxBg=e[0],this.baiBg=e[1],this.heiBg=e[2]}).catch(()=>{})},getBandStyle(){let{line:e,width:s}=this.config;return{width:e*s+"px",height:e*s+"px"}},getItemStyle(e){let{baiBg:s,heiBg:t,config:{width:i}}=this,a={width:i+"px",height:i+"px"},_={0:"",1:s,2:t};return a.background=`url(${_[e.step_content]}) no-repeat center center`,a},getBoxStyle(){return{background:`url(${this.boxBg}) no-repeat 14px 14px rgb(250, 250, 250)`}},clickHandle(e,s){this.list[e][s].step_content||this.$emit("clickHandle",{x:e+1,y:s+1})}}},p={};var F=u(N,H,z,!1,V,"17523736",null,null);function V(e){for(let s in p)this[s]=p[s]}var q=function(){return F.exports}(),A=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"flex-wrap flex-justify-between"},[t("div",{staticClass:"gobang-main"},[t("div",{staticClass:"flex-center-wrap"},[e._v(" \u6B65\u6570\uFF1A "+e._s(e.currentStep)+" \u6211\u65B9\uFF1A"+e._s(e.getQi)+" "),e.isShowTimer?t("div",{staticClass:"flex-center m-l-10"},[e._v(" \u5012\u8BA1\u65F6\uFF1A"),t("timerCom",{ref:"timerComRef",attrs:{time:e.max_move_time,all_time:e.gameBase.all_time,status:e.status,gobang_id:e.gobang_id}})],1):e._e(),e.isShould?t("div",{staticClass:"m-l-10"},[e._v(" \u8BF7\u843D\u5B50 ")]):e._e(),e.status==3?t("div",{staticClass:"f-550 f-14 c-primary m-l-10"},[e._v(" "+e._s(e.overLabel)+" ")]):e._e(),e.isShowRegBtn?t("el-button",{staticClass:"m-l-20",attrs:{size:"small"},on:{click:e.fun1}},[e._v(" \u6094\u68CB ")]):e._e()],1),e.gobangMembers.length?t("ul",e._l(e.gobangMembers,function(i){return t("li",{key:i._id,staticClass:"flex-center-wrap m-b-10"},[t("div",{staticClass:"w-60 pr"},[t("e-image",{class:["o-h b-r-50",(i==null?void 0:i.status)==1?"":"grayscale-img"],attrs:{height:60,width:60,lazy:!1,src:e.parseResourceUrl(i.author_id.header_img)}}),(i==null?void 0:i.status)==1?t("div",{staticClass:"b-r-50 pa p-a-style"}):e._e()],1),t("div",[t("span",{staticClass:"c-primary f-14"},[e.getQiType(i.author_id._id)?t("span",[e._v(" \u3010"+e._s(e.getQiType(i.author_id._id))+"\u3011")]):e._e()]),e._v(" "+e._s(i.author_id.username)+" ")])])}),0):e._e(),t("game",{attrs:{list:e.gobangList,config:e.config},on:{clickHandle:e.clickHandle}})],1),e.game_im_id?t("Im",{ref:"imRef",style:{width:"440px"},attrs:{isShowLeft:!1,gobang_id:e.gobang_id,game_im_id:e.game_im_id,imName:"\u4E94\u5B50\u68CB\u804A\u5929\u5BA4"},on:{room_baseinfo:e.room_baseinfo,get_game_content:e.get_game_content,get_gb_info:e.get_gb_info,clear_game:e.clear_game,get_regret_result:e.get_regret_result}}):e._e(),t("gobandSYs",{attrs:{max_move_time:e.max_move_time,step_content:e.step_content,gameBase:e.gameBase,getQi:e.getQi},on:{confirm:e.confirm},model:{value:e.visable,callback:function(i){e.visable=i},expression:"visable"}}),t("regretChessDialog",{attrs:{gameBase:e.gameBase,type:e.computedRegretType},on:{regret_resultChange:e.regret_resultChange},model:{value:e.visable1,callback:function(i){e.visable1=i},expression:"visable1"}})],1)},Y=[];const J={components:{Im:b,game:q,timerCom:w,gobandSYs:I,regretChessDialog:Q},data(){return{isInit:!0,visable:!1,gameBase:{_id:"",status:"1",max:10,max_move_time:0,all_time:0,hei_user_id:"",bai_user_id:"",im_romm_id:"",regret_chess_from:"",regret_chess_to:"",win_id:"",regret_result:""},gobangMembers:[],room_id:"",gobangList:[],config:{type:1,line:15,width:36}}},computed:{...Vuex.mapState(["userdata"]),...Vuex.mapGetters(["isAdmin"]),isShowRegBtn(){return this.step_content&&this.currentStep>0&&this.status==2},query(){return this.$route.query||{}},gobang_id(){return this.query.game_id||""},game_im_id(){return this.query.im_romm_id||""},currentStep(){let e=0;return this.gobangList.forEach(s=>{s.forEach(t=>{t.step_number>0&&(e+=1)})}),e},getQi(){let{_id:e}=this.userdata;return e==this.gameBase.bai_user_id?"\u767D\u68CB":e==this.gameBase.hei_user_id?"\u9ED1\u68CB":"\u89C2\u4F17"},step_content(){return{\u767D\u68CB:"1",\u9ED1\u68CB:"2"}[this.getQi]||0},status(){return this.gameBase.status||"1"},gbuserinfo(){let{_id:e}=this.userdata;return this.gobangMembers.find(s=>s.author_id._id==e)||{}},max_move_time(){return this.gameBase.max_move_time},isHei(){return this.userdata._id==this.gameBase.hei_user_id&&this.status&&this.status!=1},overLabel(){let{win_id:e,hei_user_id:s,bai_user_id:t,status:i}=this.gameBase;if(i==3){if(e==s)return"\u9ED1\u68CB\u80DC\u5229";if(e==t)return"\u767D\u68CB\u80DC\u5229";if(e==1)return"\u5E73\u5C40"}return""},isShould(){let{currentStep:e,gobangList:s,step_content:t}=this;s.forEach(a=>{a.forEach(_=>{_.step_content==1,_.step_content==2})});let i=e%2;if(+t==1)return i===1;if(+t==2)return i===0},isShowTimer(){return[2,4].includes(+this.status)},regret_chess_from(){let{step_content:e}=this,s={1:"bai_user_id",2:"hei_user_id"};return this.gameBase[s[e]]||""},regret_chess_to(){let{bai_user_id:e,hei_user_id:s}=this.gameBase;return this.regret_chess_from?this.regret_chess_from==e?s:e:""},author_id(){return this.userdata._id},visable1:{get(){let{status:e,regret_chess_from:s,regret_chess_to:t}=this.gameBase,{author_id:i}=this;return!!(e==4&&i&&(i==s||i==t))},set(){return!1}},computedRegretType(){let{regret_chess_from:e,regret_chess_to:s}=this.gameBase,{author_id:t}=this,i=0;return t==e&&(i=1),t==s&&(i=2),i}},created(){this.init()},methods:{getQiType(e){let{hei_user_id:s,bai_user_id:t}=this.gameBase;return e==s?"\u9ED1\u68CB":e==t?"\u767D\u68CB":""},get_regret_result(e){if(e){let s=null,t=0;if(this.gobangList.forEach(i=>{i.forEach(a=>{a.step_number>t&&(s=a)})}),!s){this.$message.warning("\u83B7\u53D6\u6700\u65B0\u7684\u68CB\u5B50\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0");return}this.$set(this.gobangList,s.x,this.gobangList[s.x].map((i,a)=>a==s.y?Object.assign(i,{step_content:0,step_number:0,gobang_member_id:""}):i))}},regret_resultChange(e){let{gobang_id:s,author_id:t,room_id:i}=this;this.send_msg({gobang_id:s,author_id:t,specialType:6,room_id:i,...e})},fun1(){let{regret_chess_from:e,regret_chess_to:s,gobang_id:t,author_id:i,room_id:a}=this;this.send_msg({regret_chess_from:e,regret_chess_to:s,gobang_id:t,author_id:i,specialType:5,room_id:a})},clear_game(){this.gobangList=[]},reloadPlaying(){},send_msg(e){let{imRef:s}=this.$refs;if(!s){this.$message.warning("\u5237\u65B0\u91CD\u8BD5");return}s.send_msg(e)},confirm(e){this.send_msg({room_id:this.room_id,gobang_id:this.gobang_id,author_id:this.userdata._id,specialType:4,...e}),this.visable=!1},async reloadGame(){await this.$confirm("\u786E\u5B9A\u8981\u91CD\u65B0\u5F00\u59CB\u6E38\u620F\u5417\uFF1F")&&this.send_msg({room_id:this.room_id,specialType:3,gobang_id:this.gobang_id})},clickHandle({x:e,y:s}){let{step_content:t,room_id:i,gobang_id:a,userdata:{_id:_},currentStep:o,status:l}=this;if(![1,2].includes(+t))return;const c={1:"\u6E38\u620F\u672A\u5F00\u59CB",3:"\u6E38\u620F\u5DF2\u7ED3\u675F",4:"\u7B49\u5F85\u5BF9\u65B9\u4E0A\u7EBF\uFF0C\u6E38\u620F\u5DF2\u6682\u505C"}[l];if(c||!this.isShould)return this.$message.warning(c||"\u8BF7\u7B49\u5F85\u5BF9\u65B9\u843D\u5B50");let r={room_id:i,specialType:2,gobang_id:a,gobang_member_id:_,step_number:o+1,step_content:t,x:e,y:s,author_id:_},n=this.checkWin(r);n&&(r.win_id=n),this.$refs.imRef.send_msg(r,()=>{})},room_baseinfo({gobangMembers:e,room_id:s}){Array.isArray(e)&&(this.gobangMembers=e),this.room_id=s||""},initConfigList(){let{line:e}=this.config;for(let s=0;s<e;s++){this.gobangList.push([]);for(let t=0;t<e;t++)this.gobangList[s].push({x:s,y:t,step_content:0})}},async init(){this.initConfigList(),v({gobang_id:this.gobang_id}).then(e=>{if(e.data&&this.isArrayLength(e.data.data)){let s=e.data.data;this.gobangList=this.gobangList.map(t=>(t=t.map(i=>{let{x:a,y:_}=i;return s.find(o=>{let{step_content:l,step_number:g,gobang_member_id:c}=o;if(o.x==a+1&&o.y==_+1&&l)return Object.assign(i,{step_content:l,step_number:g,gobang_member_id:c}),!0}),i}),t))}}).catch(()=>{})},get_game_content(e){this.gobangList=this.gobangList.map(s=>(s=s.map(t=>{let{x:i,y:a}=t,{step_content:_,step_number:o,gobang_member_id:l}=e;return e.x==i+1&&e.y==a+1&&_&&Object.assign(t,{step_content:_,step_number:o,gobang_member_id:l}),t}),s))},get_gb_info(e){switch(this.gameBase=Object.assign(this.gameBase,e),this.visable=!1,this.status){case"1":this.visable=!0;break}},checkWin(e){let{line:s}=this.config,t=this.deepCopy(this.gobangList),{x:i,y:a}=e;t[i-1][a-1]=Object.assign(t[i-1][a-1],e);let _=0;for(let r=0;r<s;r++)for(let n=0;n<s-4;n++)if(t[r][n].step_content!==0&&t[r][n].step_content===t[r][n+1].step_content&&t[r][n].step_content===t[r][n+2].step_content&&t[r][n].step_content===t[r][n+3].step_content&&t[r][n].step_content===t[r][n+4].step_content){_=t[r][n].step_content;break}for(let r=0;r<s;r++)for(let n=0;n<s-4;n++)if(t[n][r].step_content!==0&&t[n][r].step_content===t[n+1][r].step_content&&t[n][r].step_content===t[n+2][r].step_content&&t[n][r].step_content===t[n+3][r].step_content&&t[n][r].step_content===t[n+4][r].step_content){_=t[n][r].step_content;break}for(let r=0;r<s-4;r++)for(let n=0;n<s-4;n++)if(t[r][n].step_content!==0&&t[r][n].step_content===t[r+1][n+1].step_content&&t[r][n].step_content===t[r+2][n+2].step_content&&t[r][n].step_content===t[r+3][n+3].step_content&&t[r][n].step_content===t[r+4][n+4].step_content){_=t[r][n].step_content;break}for(let r=0;r<s-4;r++)for(let n=4;n<s;n++)if(t[r][n].step_content!==0&&t[r][n].step_content===t[r+1][n-1].step_content&&t[r][n].step_content===t[r+2][n-2].step_content&&t[r][n].step_content===t[r+3][n-3].step_content&&t[r][n].step_content===t[r+4][n-4].step_content){_=t[r][n].step_content;break}let o=!0;for(let r=0;r<s;r++)for(let n=0;n<s;n++)if(t[r][n].step_content==0){o=!1;break}o&&(_=3);const{bai_user_id:l,hei_user_id:g}=this.gameBase;return{1:l,2:g,3:1}[_]||""}}},f={};var G=u(J,A,Y,!1,P,"3b974e07",null,null);function P(e){for(let s in f)this[s]=f[s]}var Z=function(){return G.exports}();export{Z as default};
