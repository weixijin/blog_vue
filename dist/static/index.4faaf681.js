import{B as p,h as o,n as h}from"./index.25833e42.js";var d=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("TrainPage",{ref:"TrainPageRef",attrs:{searchConfig:t.searchConfig,tableConfig:t.tableConfig,sendUrl:"get_push_tasks",customize:""}}),e("e-dialog",{staticClass:"dialog-center",attrs:{width:"600px"},on:{closed:t.handleClose,confirm:t.confirm},model:{value:t.visable,callback:function(a){t.visable=a},expression:"visable"}},[e("div",{staticClass:"p-l-20 p-r-20"},[e("h3",{staticClass:"h-60 flex-center"},[t._v(" "+t._s(t.dialogTitle)+" ")]),e("div",{staticClass:"flex-wrap"},[e("div",{staticClass:"w-60 flex-center-wrap h-40"},[t._v("\u7C7B\u578B\uFF1A")]),e("el-select",{staticClass:"w-505",attrs:{placeholder:"\u8BF7\u9009\u62E9"},on:{change:t.typeChange},model:{value:t.rowData.type,callback:function(a){t.$set(t.rowData,"type",a)},expression:"rowData.type"}},t._l(t.pushDaskTypes,function(a){return e("el-option",{key:a.value,attrs:{label:a.label,value:a.value}})}),1)],1),+t.rowData.type!=1?e("div",{staticClass:"flex-wrap m-t-20"},[e("div",{staticClass:"w-60 flex-center-wrap h-40"},[t._v("\u65E5\u671F\uFF1A")]),[1,2,3].includes(+t.rowData.type)?e("el-select",{staticClass:"w-505",attrs:{multiple:"",clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9"},model:{value:t.rowData.time,callback:function(a){t.$set(t.rowData,"time",a)},expression:"rowData.time"}},t._l(t.dayOptions,function(a){return e("el-option",{key:a.value,attrs:{label:a.label,value:a.value}})}),1):e("el-date-picker",{staticClass:"w-505",attrs:{type:"date",placeholder:"\u9009\u62E9\u65E5\u671F",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:t.rowData.time1,callback:function(a){t.$set(t.rowData,"time1",a)},expression:"rowData.time1"}})],1):t._e(),e("div",{staticClass:"flex-wrap m-t-20"},[e("div",{staticClass:"w-60 flex-center-wrap h-40"},[t._v("\u5185\u5BB9\uFF1A")]),e("el-input",{attrs:{type:"textarea",rows:4,placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.rowData.content,callback:function(a){t.$set(t.rowData,"content",a)},expression:"rowData.content"}})],1),t._v(" \u3001 "),e("div",{staticClass:"flex-wrap m-t-20"},[e("div",{staticClass:"w-60 flex-center-wrap h-40"},[t._v("\u94FE\u63A5\uFF1A")]),e("el-input",{attrs:{type:"textarea",rows:4,placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t.rowData.note_link,callback:function(a){t.$set(t.rowData,"note_link",a)},expression:"rowData.note_link"}})],1)])])],1)},u=[];const m={name:"pushTaskList",data(){return{weekList:[],monthList:[],visable:!1,rowData:{type:"",time:[],time1:"",content:"",note_link:""},params:{type:"1"},searchConfig:[{label:"\u5206\u7C7B",type:"select",modelName:"type",options:()=>this.pushDaskTypes},{label:"\u5185\u5BB9",type:"input",modelName:"content"}],tableConfig:{isSelection:!1,maxHeightFlag:!1,stripe:!0,filterData:t=>t.map(s=>{let{content:e,type:a}=s;return{...s,_content:e.replace(/\n/g,"<br>"),_time:this.getTime(s),_type:this.getLabel(this.pushDaskTypes,a)}}),btns:{children:[{label:"\u65B0\u589E",type:"primary",clickFn:t=>{this.openDialogAdd()}},{label:"\u6BCF\u65E5\u63A8\u9001",type:"success",clickFn:t=>{this.goTo("/normal/push_task")}}]},columnObj:[{label:"\u5206\u7C7B",props:"_type",width:150},{label:"\u65E5\u671F",props:"_time",width:200,html:"_time"},{label:"\u5185\u5BB9",props:"_content",html:"_content"},{label:"\u64CD\u4F5C",slot:"projectDetail",props:"action",lock:!0,fixed:"right",children:[{label:"\u7F16\u8F91",type:"primary",clickFn:t=>{this.openDialogEdit(t)}},{label:"\u5220\u9664",type:"danger",clickFn:t=>{this.delteOne(t)}}]}]}}},computed:{...Vuex.mapState(["options","keyboardEventKay"]),pushDaskTypes(){let{options:t}=this;return this.isObject(t)?t.pushDaskTypes||[]:[]},taskList(){let{type:t}=this.params;return this.lists[t]||[]},dialogTitle(){return this.rowData._id?"\u7F16\u8F91":"\u65B0\u589E"},dayOptions(){return this[{2:"weekList",3:"monthList"}[this.rowData.type]]||[]}},watch:{keyboardEventKay(t){t==="ctrl_s"&&this.visable&&this.confirm()}},mounted(){this.weekList=[],this.monthList=[];for(let t=0;t<7;t++){const s=t+1+"";let e={label:`\u661F\u671F${s}`,value:s};this.weekList.push(e)}for(let t=0;t<31;t++){const s=t+1+"";let e={label:`${s}`,value:s};this.monthList.push(e)}},methods:{getTime(t){return[1,2,3].includes(+t.type)?+t.type==1?"---":t.time:`<div>\u9634\u5386\uFF1A ${this.klDateFormat(t.time-0,"yyyy-MM-dd")}</div>
                        <div>\u9633\u5386\uFF1A ${this.getYangli(t.time-0)}</div>`},getYangli(t){let[s,e,a]=this.klDateFormat(t,"[yyyy,MM,dd]"),l=p.lunar2solar(s,e,a),{cYear:n,cMonth:i,cDay:r}=l;return`${n}-${this.addZero(i)}-${this.addZero(r)}`},delteOne({_id:t}){this.$confirm("\u786E\u5B9A\u5220\u9664\u5417?").then(()=>{o.delete_push_task({_id:t}).then(()=>{this.$message.success("\u5220\u9664\u6210\u529F")}).catch(s=>{this.Toast(s)}).finally(()=>{this.initTable()})}).catch(()=>{this.$message.success("\u53D6\u6D88\u6210\u529F")})},typeChange(){Object.assign(this.rowData,{time:[],content:""})},openDialogEdit(t){this.visable=!0,this.rowData=this.deepClone(t),typeof this.rowData.time=="string"&&([1,2,3].includes(+this.params.type)?this.rowData.time=this.rowData.time.split(","):this.rowData.time1=this.klDateFormat(this.rowData.time-0,"yyyy-MM-dd"))},confirm(){let{time:t,content:s,_id:e,type:a,time1:l,note_link:n}=this.rowData;const i={type:a};if(!a){this.$message.error("\u8BF7\u9009\u62E9\u7C7B\u578B");return}if(!s){this.$message.error("\u8BF7\u8F93\u5165\u5185\u5BB9");return}if(i.content=s,n&&(i.note_link=n),[2,3].includes(+a)){if(!this.isArrayLength(t,"\u8BF7\u9009\u62E9\u65E5\u671F"))return;i.time=t.join(",")}if(e&&(i._id=e),+a==4){if(!l){this.$message.error("\u8BF7\u9009\u62E9\u65E5\u671F");return}i.time=new Date(l).getTime()}o.post_push_task(i).then(()=>{this.$message.success("\u64CD\u4F5C\u6210\u529F"),this.handleClose()}).catch(r=>{this.Toast(r)}).finally(()=>{this.initTable()})},handleClose(){Object.assign(this.rowData,{_id:"",time:[],content:"",note_link:""}),this.visable=!1},openDialogAdd(){this.rowData.type=this.params.type,this.visable=!0}}},c={};var y=h(m,d,u,!1,f,null,null,null);function f(t){for(let s in c)this[s]=c[s]}var w=function(){return y.exports}();export{w as default};
