import{n as p,_ as d,h as o}from"./index.25833e42.js";var g=function(){var e=this,l=e.$createElement,t=e._self._c||l;return t("div",{staticClass:"c-bug-page"},[t("TrainPage",{ref:"TrainPageRef",attrs:{searchConfig:e.searchConfig,tableConfig:e.tableConfig,sendUrl:"get_c_bugs",customize:""},scopedSlots:e._u([{key:"author_name",fn:function(a){var r,i=a.record;return[e._v(" "+e._s((i==null||(r=i.author_id)===null||r===void 0?void 0:r.username)||"---")+" ")]}}])},[t("template",{slot:"btnList"},[t("el-button",{attrs:{type:"success"},on:{click:e.openDialog}},[e._v("\u65B0\u589E")])],1)],2),t("e-dialog",{attrs:{clickModal:!1,footer:!1,width:"80vw"},on:{closed:e.dialogClosed},model:{value:e.visable,callback:function(a){e.visable=a},expression:"visable"}},[t("div",[t("div",{staticClass:"flex-center f-550 h-40 f-18 pr"},[e._v(" "+e._s(e.rowCopy._id?"\u7F16\u8F91":"\u65B0\u589E")+" "),t("i",{staticClass:"el-icon-close pos-close",on:{click:e.dialogClosed}})]),t("div",{staticClass:"flex-wrap flex-center-wrap p-l-20"},[e._v(" bug\u7C7B\u578B\uFF1A "),t("el-select",{attrs:{clearable:"",placeholder:"\u8BF7\u9009\u62E9"},model:{value:e.rowCopy.c_bug_type,callback:function(a){e.$set(e.rowCopy,"c_bug_type",a)},expression:"rowCopy.c_bug_type"}},e._l(e.optionsType1,function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.value}})}),1)],1),t("div",{staticClass:"d-main flex-wrap p-b-20 p-t-10 m-t-10"},[t("mavonEditor",{attrs:{upload_file_url:"bug_c"},on:{save:e.editorChange},model:{value:e.rowCopy.content,callback:function(a){e.$set(e.rowCopy,"content",a)},expression:"rowCopy.content"}})],1)])])],1)},_=[];const h={components:{mavonEditor:()=>d(()=>import("./index.dc53c6d6.js"),["static/index.dc53c6d6.js","static/index.3a34ce3f.css","static/index.25833e42.js","static/index.8776284e.css"])},data(){return{searchConfig:[{label:"\u5185\u5BB9",type:"input",modelName:"keywords"},{label:"bug\u72B6\u6001",type:"select",modelName:"type",options:[{label:"\u672A\u89E3\u51B3",value:"1"},{label:"\u5DF2\u89E3\u51B3",value:"2"}]},{label:"bug\u7C7B\u578B",type:"select",modelName:"c_bug_type",options:[{label:"\u5176\u4ED6",value:"1"},{label:"\u5DE5\u4F5C",value:"2"}]}],tableConfig:{isSelection:!1,maxHeightFlag:!1,stripe:!0,filterData:e=>(this.setImgp(),e),columnObj:[{label:"\u8BE6\u60C5",props:"html_edit",html:!0},{label:"\u64CD\u4F5C",slot:"projectDetail",props:"action",lock:!0,fixed:"right",children:[{label:"\u7F16\u8F91",type:"primary",clickFn:e=>{this.edit(e)}},{label:"\u5DF2\u4FEE\u6539",type:"info",type:"warning",show:e=>e.type==1,clickFn:e=>{this.changeType(e)}},{label:"\u672A\u4FEE\u6539",type:"info",type:"info",show:e=>e.type==2,clickFn:e=>{this.changeType(e)}}]}]},toolbars:{bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,mark:!0,superscript:!0,subscript:!0,quote:!0,ol:!0,ul:!0,link:!0,imagelink:!0,code:!0,table:!0,fullscreen:!0,readmodel:!0,htmlcode:!0,help:!0,undo:!0,redo:!0,trash:!0,save:!0,navigation:!0,alignleft:!0,aligncenter:!0,alignright:!0,subfield:!0,preview:!0},timer:null,rowCopy:{_id:"",content:"",html_edit:"",c_bug_type:"1"},visable:!1,params:{type:"1",c_bug_type:""},tableData:[],isLoading:!0,scrollHeight:0,pageOption:{pageSizes:[10,15,20,50],limit:20,total:0,page:1},optionsType1:[{label:"\u5176\u4ED6",value:"1"},{label:"\u5DE5\u4F5C",value:"2"}]}},watch:{visable(e){e&&this.setImgp()}},methods:{async setImgp(e=".el-table img"){await this.sleep();let l=document.querySelectorAll(e),t=Array.from(l);for(let a=0;a<t.length;a++){let r=t[a];r.removeEventListener("click",()=>{}),r.addEventListener("click",()=>{this.prevewImg(r)})}},changeType(e){let{type:l,_id:t}=e;e.type=+l==1?"2":"1",o.post_c_bug(e).then(a=>{this.$message.success("\u64CD\u4F5C\u6210\u529F"),this.$refs.TrainPageRef.tableData=this.$refs.TrainPageRef.tableData.filter(r=>r._id!==t),this.setImgp()}).catch(()=>{})},edit(e){this.visable=!0,this.rowCopy=this.deepClone(e)},editorChange({str:e,html:l}){let{_id:t,type:a,c_bug_type:r}=this.rowCopy;if(!e||!l){this.$message.error("\u8BF7\u8F93\u5165\u5185\u5BB9");return}let i={_id:t,content:e,html_edit:l,type:a||"1",c_bug_type:r};const c=this.$loading({lock:!0,text:"\u4FDD\u5B58\u4E2D...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});o.post_c_bug(i).then(async u=>{if(this.$message.success("\u64CD\u4F5C\u6210\u529F"),this.visable=!1,!t){this.$refs.TrainPageRef.getAddData();return}this.$refs.TrainPageRef.tableData=this.$refs.TrainPageRef.tableData.map(s=>s._id===t?u.data.data:s),this.setImgp()}).catch(()=>{}).finally(()=>{c.close()})},dialogClosed(){this.visable=!1,Object.assign(this.rowCopy,{_id:"",content:"",html_edit:""})},openDialog(){this.visable=!0}}},n={};var b=p(h,g,_,!1,f,"c333b3ca",null,null);function f(e){for(let l in n)this[l]=n[l]}var m=function(){return b.exports}();export{m as default};
