import{m as u,K as p,j as m,u as f,h as g,L as v,M as k,n as y}from"./index.25833e42.js";var b=function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"home-page common-bg-1",style:{backgroundImage:`url('${t.pageBgImg}')`}},[s("div",{staticClass:"common-bg-1 p-t-90"},[t.isPc()?s("klWordsFlake"):t._e(),s("comHeader"),s("div",{staticClass:"home-page-main pr"},[s("div",{staticClass:"canvas-bg",style:t.getBgStyle()}),s("div",{staticClass:"w-1100-center"},[s("div",{staticClass:"home-page-main-left",attrs:{id:"home-page-main-scroll-main"}},[t.searchOption.isSearch?s("div",{staticClass:"search-main common_bck_1"},[s("span",{staticClass:"c-primary cu",on:{click:t.getRankingClasssInit}},[t._v("\u9996\u9875")]),s("span",{staticClass:"m-r-2"},[t._v(">")]),t._v(" \u627E\u5230 "),s("span",{staticClass:"c-danger m-r-2"},[t._v(t._s(t.searchOption.total))]),t._v(" \u7BC7\u4E0E "),s("span",{staticClass:"c-danger m-r-2"},[t._v(t._s(t.searchOption.content_old))]),t._v(" \u76F8\u5173\u7684\u6587\u7AE0 ")]):t._e(),s("klScroll",{ref:"klScrollRef",attrs:{scrollHeight:t.scrollHeight,list:t.rankingClasss,pageOption:t.pageOption,minHeight:200},on:{bottom:t.bottomE}},[t._l(t.rankingClasss,function(e,r){return s("div",{key:e._id,class:["article-item common_bck_1",r===t.rankingClasss.length-1?"m-b-0":"m-b-15"],on:{click:function(a){return a.stopPropagation(),t.goPage(e)}}},[s("div",{staticClass:"article-bg-cover"},[s("e-image",{staticClass:"article-bg",attrs:{alt:"blog",title:"blog",src:e.article_bck_url}})],1),s("div",{staticClass:"article-item-right"},[s("div",{staticClass:"article-title ell-1"},[t._v(" "+t._s(e.article_name)+" ")]),s("div",{staticClass:"article-content ell-4"},[t._v(" "+t._s(e.article_keywords)+" ")]),s("div",{staticClass:"article-item-footer"},[s("div",{staticClass:"left"},[s("kl-svg",{staticClass:"m-r-5",attrs:{name:"mulu"}}),s("p",{staticClass:"f-14 m-w-130 ell-1"},[t._v(" \u535A\u6587\xA0|\xA0"+t._s(e.class_id.class_name)+" ")]),s("kl-svg",{staticClass:"m-r-5 m-l-15",attrs:{name:"rili"}}),s("span",{staticClass:"f-14"},[t._v(t._s(t._f("filterArticleTime")(e.article_updata_time))+" ")]),s("kl-svg",{staticClass:"svg-fire m-r-5 m-l-15",style:{color:"red"},attrs:{name:"fire"}}),s("span",{staticClass:"f-14"},[t._v(" "+t._s(e.article_watch_numbers?e.article_watch_numbers:0)+" ")])],1),t.isAcArticle(e)?s("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){return a.stopPropagation(),t.deleteAc(e)}}},[t._v(" \u76F4\u63A5\u5220\u9664 ")]):s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return a.stopPropagation(),t.goPage(e)}}},[t._v(" \u9605\u8BFB\u5168\u6587 ")])],1)])])}),t.searchOption.isSearch&&!t.searchOption.total?s("div",{staticClass:"no-ranking-classs flex-center cu common_bck_1 h-200"},[t._v(" \u6CA1\u6709\u627E\u5230\u76F8\u5173\u5185\u5BB9\u60A8\u53EF\u4EE5 "),s("span",{staticClass:"c-primary cu",on:{click:t.getRankingClasssInit}},[t._v("\u70B9\u51FB")]),t._v(" \u8FD9\u91CC\u8FD4\u56DE\u9996\u9875\uFF01 ")]):t._e()],2)],1),s("div",{staticClass:"home-page-main-right"},[s("div",{staticClass:"home-page-right-search common_bck_1"},[s("div",{staticClass:"my-input"},[s("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.searchOption.content,expression:"searchOption.content",modifiers:{trim:!0}}],staticClass:"search f-14",attrs:{placeholder:"\u8BF7\u8F93\u5165\u641C\u7D22\u5185\u5BB9",type:"text"},domProps:{value:t.searchOption.content},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchArticleAll.apply(null,arguments)},focus:function(e){return t.handleHistory("open")},blur:[function(e){return t.handleHistory("blur")},function(e){return t.$forceUpdate()}],input:function(e){e.target.composing||t.$set(t.searchOption,"content",e.target.value.trim())}}}),s("div",{staticClass:"search-icon",on:{click:t.searchArticleAll}},[s("kl-svg",{staticClass:"svg-search m-r-5 m-l-15",attrs:{name:"search"}})],1)]),t.historyObj&&t.historyObj.isHistory&&t.historyObj.historyList.length?s("div",{class:["historical-records",(t.historyObj.isHistory,"")]},[s("div",{staticClass:"history-title"},[s("span",[t._v(" \u5386\u53F2\u8BB0\u5F55 ")]),s("kl-svg",{attrs:{name:"close"},on:{mousedown:function(e){return t.handleHistory("close")}}})],1),s("div",{staticClass:"history-list better-scroll"},[t.isArrayLength(t.historyListComputed)?t._l(t.historyListComputed,function(e){return s("div",{key:e.id,staticClass:"item"},[s("span",{staticClass:"ell cu",on:{mousedown:function(r){return t.handleHistory("select",e)}}},[t._v(" "+t._s(e.content)+" ")]),s("div",{staticClass:"svg-delete-cover cu",on:{mousedown:function(r){return r.stopPropagation(),t.handleHistory("delete",e)}}},[s("kl-svg",{staticClass:"svg-delete",attrs:{name:"delete"}})],1)])}):s("div",{staticClass:"flex-center h-40 f-14 c-primary p-b-20"},[t._v(" \u6682\u65E0\u5386\u53F2\u8BB0\u5F55 ")])],2)]):t._e()]),t.isAdmin?s("div",{staticClass:"click-ranking common_bck_1 m-b-15"},[t._m(0),t.tagList.length>0?s("div",{staticClass:"p-15"},[s("el-checkbox-group",{on:{change:t.blog_tags_change},model:{value:t.blog_tags,callback:function(e){t.blog_tags=e},expression:"blog_tags"}},t._l(t.tagList,function(e){return s("el-checkbox",{key:e.id,attrs:{label:e.tag_name}})}),1)],1):s("div",{staticClass:"flex-center jilu"},[t._v("\u6682\u65E0\u8BB0\u5F55")])]):t._e(),t.islogin?s("div",{staticClass:"click-ranking common_bck_1"},[t._m(1),t.readHistory.length>0?s("div",t._l(t.readHistory,function(e){return s("div",{key:e._id,staticClass:"updata-item",on:{click:function(r){return t.goPage(e,1)}}},[s("div",{staticClass:"click-ranking-item-img-cover"},[s("e-image",{staticClass:"article-bg",attrs:{src:e.article_id.article_bck_url,alt:"blog",title:"blog"}})],1),s("div",{staticClass:"updata-item-item"},[s("div",{staticClass:"time f-14 ell-1"},[t._v(" "+t._s(t._f("filterArticleTime")(e.updata_time-0))+" ")]),s("div",{staticClass:"content f-14 ell-1"},[t._v(" "+t._s(e.article_id.article_name)+" ")])])])}),0):s("div",{staticClass:"flex-center jilu"},[t._v("\u6682\u65E0\u8BB0\u5F55")])]):t._e(),s("div",{staticClass:"click-ranking common_bck_1 m-t-15"},[t._m(2),t._l(t.recentUpdates,function(e){return s("div",{key:e._id,staticClass:"updata-item",on:{click:function(r){return t.goPage(e)}}},[s("div",{staticClass:"click-ranking-item-img-cover"},[s("e-image",{staticClass:"article-bg",attrs:{src:e.article_bck_url,alt:"blog",title:"blog"}})],1),s("div",{staticClass:"updata-item-item"},[s("div",{staticClass:"time f-14 ell-1"},[t._v(" "+t._s(t._f("filterArticleTime")(e.article_updata_time))+" ")]),s("div",{staticClass:"content f-14 ell-1"},[t._v(" "+t._s(e.article_name)+" ")])])])})],2),s("div",{class:["click-ranking","common_bck_1",t.islogin?"m-t-15":""]},[t._m(3),t._l(t.clickRank,function(e,r){return s("div",{key:e._id,staticClass:"click-ranking-item",on:{click:function(a){return t.goPage(e)}}},[s("div",{staticClass:"click-ranking-item-index"},[t._v(t._s(r+1))]),s("div",{staticClass:"click-ranking-item-p ell-1"},[t._v(" "+t._s(e.article_name)+" ")])])})],2)])])])],1),s("kl-back-top",{ref:"myScrolLeftRef",attrs:{el:".zl-scroll"}})],1)},C=[function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"click-ranking-title"},[t._v(" \u6587\u7AE0\u6807\u7B7E "),s("div",{staticClass:"line"})])},function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"click-ranking-title"},[t._v(" \u9605\u8BFB\u8BB0\u5F55 "),s("div",{staticClass:"line"})])},function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"click-ranking-title"},[t._v(" \u6700\u65B0\u6587\u7AE0 "),s("div",{staticClass:"line"})])},function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"click-ranking-title"},[t._v(" \u70B9\u51FB\u6392\u884C "),s("div",{staticClass:"line"})])}];const O={components:{},data(){return{styleSize:100,bg:"",blog_tags:[],tagList:[],indexDBIMG:null,pageBgImg:"",maxIndex:0,isLoading:!0,scrollHeight:500,scrollTop:0,historyObj:{isHistory:!1,historyList:[],isFn:!1},searchOption:{total:0,isSearch:!1,content:"",content_old:""},clickRank:[],recentUpdates:[],rankingClasss:[],readHistory:[],pageOption:{page:1,limit:10,total:0}}},computed:{...Vuex.mapState(["userdata","userTags"]),...Vuex.mapGetters(["isAdmin"]),islogin(){return this.isLogin()},historyListComputed(){return this.isArrayLength(this.historyObj.historyList)?this.historyObj.historyList.filter(t=>t.content.includes(this.searchOption.content)):[]}},filters:{filterArticleTime(t){return u(t)}},watch:{"searchOption.isSearch"(){this.setScrollHeight()},"userdata.iolationsNumber":{handler(){this.setIolationsNumber()},immediate:!0,deep:!0}},activated(){this.islogin&&this.get_author_read_history(),this.klScrollGo(this.scrollTop)},deactivated(){let t=this.$refs.klScrollRef;t&&(this.scrollTop=t.scrollTop)},async created(){this.getInitData()},mounted(){let t={pageBgImg:"https://image.zlketang.com/public/news/others/imgs/20210924104716485.jpg"};this.setScrollHeight(),window&&window.addEventListener("resize",this.setScrollHeight),this.winSleep(()=>{try{this.getIndexDBIMJ(t)}catch(i){this.Toast(i)}})},methods:{setIolationsNumber(){let{user_first_show_type:t,iolationsNumber:i=0,user_violation_target:s}=this.userdata||{};if(t==1){const[e]=this.klDateFormat(Date.now(),"[d]");let r=i/e,{base64:a,styleSize:l}=this.useWatermarkBg({text:`${Math.ceil(r*100)}/${s}`,fontSize:160,deg:0,fillStyle:p(r)});this.bg=a,this.styleSize=l}},getBgStyle(){let{bg:t,styleSize:i}=this;return{backgroundSize:`${i}px ${i}px`,backgroundImage:`url('${t}')`}},async deleteAc({_id:t}){if(!t)return this.$message.warning("_id\u4E0D\u5B58\u5728");try{if(await this.$confirm("\u786E\u5B9A\u5220\u9664\uFF1F").catch(()=>!1)===!1)return;await m({_id:t}),this.$message.success("\u5220\u9664\u6210\u529F"),this.rankingClasss=this.rankingClasss.filter(s=>s._id!==t),this.searchOption.total--}catch(i){this.Toast(i)}},isAcArticle(t){var i;return!![2,3].includes(+((i=t==null?void 0:t.class_id)==null?void 0:i.class_type))},getRankingClasssInit(){this.searchOption.isSearch=!1,this.pageOption={page:1,limit:10,total:0},this.rankingClasss=[],this.blog_tags=[],this.getRankingClasss()},blog_tags_change(){this.klScrollGo(),this.pageOption={page:1,limit:10,total:0},this.rankingClasss=[],this.searchArticle()},searchArticleAll(){if(!this.searchOption.content&&this.tagList.length===0)return this.$message.warning("\u8BF7\u8F93\u5165\u641C\u7D22\u6761\u4EF6");this.klScrollGo(),this.pageOption={page:1,limit:10,total:0},this.rankingClasss=[],this.searchArticle()},async setScrollHeight(){await this.$nextTick();let t=this.$refs.klScrollRef,i=100;if(this.maxIndex>=i)return this.$message.warning("\u8BBE\u7F6E\u6EDA\u52A8\u533A\u57DF\u9AD8\u5EA6\u5931\u8D25");if((!t||!t.scroll_el)&&this.maxIndex<i){await this.sleep(50),this.maxIndex++,this.setScrollHeight();return}this.maxIndex=0;let s=t.scroll_el.getBoundingClientRect().top||90;this.scrollHeight=Math.floor(document.documentElement.clientHeight-s)},bottomE(){let{page:t,limit:i,total:s}=this.pageOption;t*i>=s||(this.pageOption.page++,this.searchArticle())},async klScrollGo(t=0){await this.$nextTick();let i=this.$refs.klScrollRef;!i||i.go(t)},scrollEvent(t){var i;this.scrollTop=(i=t.target)==null?void 0:i.scrollTop},handleHistory(t,i){let s=this;this.historyObj.isFn=!1,t==="delete"&&(this.historyObj.isFn=!0);let e={blur:()=>{this.historyObj.isFn||setTimeout(()=>{s.historyObj.isHistory=!1,this.historyObj.isFn=!1},0)},open:async()=>{let r=await this.getStore("historyList",[]);this.historyObj.historyList=r.filter(a=>{if(Date.now()-a.time<30*24*3600*1e3)return a}).sort((a,l)=>l.time-a.time),this.historyObj.isHistory=!0},close:()=>{this.historyObj.isHistory=!1},add:async()=>{let{id:r,content:a,time:l}=i,n=await this.getStore("historyList",[]);if(Object.keys(n).length===0){let c=[],_={id:r,content:a,time:l,number:1};c.push(_),this.setStore("historyList",c);return}if(n.find(c=>c.content===a)){n=n.map(c=>(c.content===a&&(c.content=a,c.time=l,c.number=c.number+1),c)),this.setStore("historyList",n);return}let o={id:r,content:a,time:l,number:1};n.push(o),await this.setStore("historyList",n),this.handleHistory("open")},select:async()=>{let{content:r}=i;this.searchOption.content=r,this.searchArticleAll();let a=await this.getStore("historyList",[]);a=a.map(l=>(l.content===r&&(l.content=r,l.time=Date.now(),l.number=l.number+1),l)),this.setStore("historyList",a)},delete:async()=>{let{content:r}=i,a=await this.getStore("historyList",[]);a=a.filter(l=>l.content!==r),this.historyObj.historyList=a,this.setStore("historyList",a)}};Object.prototype.hasOwnProperty.call(e,t)&&e[t]()},searchArticle(){let{content:t}=this.searchOption;t&&this.handleHistory("add",{id:this.createId(),content:t,time:Date.now()}),this.isLoading=!0;let{page:i,limit:s}=this.pageOption,{blog_tags:e}=this,r={content:t,page:i,limit:s};if(e){let a=[];e.forEach(l=>{this.tagList.forEach(n=>{n.tag_name===l&&a.push(n._id)})}),r.blog_tags=a}f(r).then(a=>{let{data:l,total:n}=a.data;if(Array.isArray(l)){let{content:h}=this.searchOption,o=[...this.blog_tags];h&&o.push(h),this.searchOption.content_old=o.join(","),this.rankingClasss=[...this.rankingClasss,...l],this.searchOption.total=n-0,this.pageOption.total=n-0,this.searchOption.isSearch=o.length>0,this.$nextTick(()=>{this.handleCtrlF(h,".classs-item",[".article-title",".article-content"])})}}).catch(()=>{}).finally(()=>{this.isLoading=!1})},handleData(t){this.rankingClasss=[],t.forEach(i=>{let{article_watch_numbers:s}=i,e=this.rankingClasss.findIndex(r=>{let{reads:a}=r;if(i.class_id._id===r.class_id)return s>a&&(r.reads=s),i});if(e===-1){let r={reads:i.article_watch_numbers,class_id:i.class_id._id,children:[]};r.children.push(i),this.rankingClasss.push(r)}else this.rankingClasss[e].children.push(i)}),this.rankingClasss.sort((i,s)=>s.reads-i.reads),this.rankingClasss.map(i=>{i.children.sort((s,e)=>e.article_watch_numbers-s.article_watch_numbers)})},getRankingClasss(){this.searchOption.isSearch=!1,this.searchOption.content="";let{page:t,limit:i}=this.pageOption,s={page:t,limit:i,type:"2",cache:!0};g.get_mobile_home_list(s).then(e=>{if(e.data){let{list:r,total:a}=e.data;Array.isArray(r)&&(this.rankingClasss=[...this.rankingClasss,...r],this.pageOption.total=a)}}).catch(()=>{})},handlerImgsFromIndexDB(t){return t.map(async i=>{i.article_bck_url=await this.getIndexDBIMJ(i.article_bck_url,this.indexDBIMG)})},getInitData(){if(!this.isPc())return;this.islogin&&this.get_author_read_history();let t=[v({limit:5,cache:!0}),k({limit:5,cache:!0})];this.isAdmin&&t.push(g.get_blog_tag_list({page:1,limit:100,cache:!0})),Promise.all(t).then(i=>{var s,e,r,a;if(this.clickRank=((s=i[0])==null?void 0:s.data)||[],this.recentUpdates=((r=(e=i[1])==null?void 0:e.data)==null?void 0:r.data)||[],this.getType((a=i[2])==null?void 0:a.data)==="object"){let{data:l}=i[2].data;this.tagList=l||[]}}).catch(i=>{this.Toast(i)}),this.getRankingClasss()},get_author_read_history(){let t=3e4;g.get_author_read_history({limit:5,cache:!0,expire_time:t}).then(i=>{this.readHistory=i.data.data.filter(s=>{if(s.article_id)return s})}).catch(i=>{})},goPage(t,i=0){if(t&&this.getType(t.class_id)==="object"&&[2,3].includes(+t.class_id.class_type)){let{class_type:s}=t.class_id;s==2&&window.open(this.$baseURL+`${t.article_ac_url.replace(/^\//,"")}`);return}if(i){this.$router.push(`/blog/page/${t.article_id._id}`);return}this.$router.push(`/blog/page/${t._id}`)}}},d={};var x=y(O,b,C,!1,S,"33023ebc",null,null);function S(t){for(let i in d)this[i]=d[i]}var L=function(){return x.exports}();export{L as default};
