import{z as b,A as F,y as k,x as v,n as T}from"./index.25833e42.js";import D from"./v-calendar.899c0c58.js";var w=function(){var e=this,o=e.$createElement,i=e._self._c||o;return i("e-teleport",[i("kl-popup",{attrs:{visible:e.dialogVisible,top:"10%",height:e.zlPopupHeight,bottom:!e.IS_PC},on:{close:e.closeDilog,determine:e.determineDialog}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isEditLoading,expression:"isEditLoading"}]},[i("div",{staticClass:"dialog-title"},[i("span",{staticClass:"dialog-title-text ell-1"},[e._v(e._s(e.title))])]),i("div",{class:["dialog-main",e.IS_PC?"pc-dialog-main":"mobile-dialog-main"]},[i("el-form",{ref:"addoreditRef",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"\u7EAA\u8981\u5185\u5BB9",prop:"note_content"}},[i("el-input",{ref:"input1Ref",model:{value:e.ruleForm.note_content,callback:function(t){e.$set(e.ruleForm,"note_content",t)},expression:"ruleForm.note_content"}})],1),i("el-form-item",{attrs:{label:"\u7EAA\u8981\u8BE6\u60C5",prop:"note_details"}},[i("el-input",{attrs:{type:"textarea",rows:6},model:{value:e.ruleForm.note_details,callback:function(t){e.$set(e.ruleForm,"note_details",t)},expression:"ruleForm.note_details"}})],1),i("el-form-item",{attrs:{label:"\u7EAA\u8981\u5206\u7C7B"}},[e.IS_PC?i("el-radio-group",{on:{change:e.noteTypeChange},model:{value:e.ruleForm.note_type,callback:function(t){e.$set(e.ruleForm,"note_type",t)},expression:"ruleForm.note_type"}},e._l(e.summaryTypeOptions,function(t){return i("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.label))])}),1):i("el-select",{attrs:{clearable:"",placeholder:"\u8BF7\u9009\u62E9"},on:{change:e.noteTypeChange},model:{value:e.ruleForm.note_type,callback:function(t){e.$set(e.ruleForm,"note_type",t)},expression:"ruleForm.note_type"}},e._l(e.summaryTypeOptions,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),i("el-form-item",{attrs:{label:"\u4E3B\u4EFB\u52A1\u6743\u91CD"}},[i("el-select",{attrs:{clearable:"",placeholder:"\u8BF7\u9009\u62E9"},model:{value:e.ruleForm.note_weight_import,callback:function(t){e.$set(e.ruleForm,"note_weight_import",t)},expression:"ruleForm.note_weight_import"}},e._l(5,function(t){return i("el-option",{key:"kl_"+t,attrs:{label:t,value:t}})}),1)],1),i("el-form-item",{attrs:{label:"\u662F\u5426\u9700\u8981\u63D0\u9192"}},[i("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.ruleForm.note_need_remind,callback:function(t){e.$set(e.ruleForm,"note_need_remind",t)},expression:"ruleForm.note_need_remind"}})],1),i("el-form-item",{attrs:{label:"\u662F\u5426\u5B8C\u6210"}},[i("el-select",{attrs:{clearable:"",placeholder:"\u8BF7\u9009\u62E9"},model:{value:e.ruleForm.note_done,callback:function(t){e.$set(e.ruleForm,"note_done",t)},expression:"ruleForm.note_done"}},e._l(e.noteDoneType,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),i("div",[e.IS_PC?[i("el-form-item",{attrs:{label:"\u4EFB\u52A1\u5468\u671F\u65F6\u95F4"}},[i("el-date-picker",{attrs:{type:"datetimerange","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":["00:00:00","23:59:59"]},on:{change:e.noteTestingTimeChange},model:{value:e.ruleForm.task_time,callback:function(t){e.$set(e.ruleForm,"task_time",t)},expression:"ruleForm.task_time"}})],1),e.isWorkType?i("el-form-item",{attrs:{label:"\u63D0\u6D4B\u65F6\u95F4",prop:"note_testing_time"}},[i("el-date-picker",{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},on:{change:e.noteTestingTimeChange},model:{value:e.ruleForm.note_testing_time,callback:function(t){e.$set(e.ruleForm,"note_testing_time",t)},expression:"ruleForm.note_testing_time"}})],1):e._e()]:[i("el-form-item",{attrs:{label:"\u4EFB\u52A1\u5468\u671F\u65F6\u95F4"}},[i("div",{on:{click:e.openMobileDialog}},[e._v(" "+e._s(e._f("filterTaskTime")(e.ruleForm.task_time,e.that))+" ")])]),e.isWorkType?i("el-form-item",{attrs:{label:"\u63D0\u6D4B\u65F6\u95F4"}},[i("div",{on:{click:function(t){e.mobileTestVisable=!0}}},[e._v(" "+e._s(e.ruleForm.note_testing_time?e.ruleForm.note_testing_time:"---")+" ")])]):e._e()]],2),i("el-form-item",{attrs:{label:"\u4EFB\u52A1\u8FDB\u5EA6",prop:""}},[i("el-input",{staticClass:"w-220",attrs:{placeholder:"\u8BF7\u8F93\u51650~100\u7684\u6574\u6570",disabled:e.ruleForm.children.length>0},model:{value:e.ruleForm.note_progress,callback:function(t){e.$set(e.ruleForm,"note_progress",typeof t=="string"?t.trim():t)},expression:"ruleForm.note_progress"}})],1),i("el-form-item",{attrs:{label:"\u4EFB\u52A1\u94FE\u63A5",prop:""}},[i("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165"},model:{value:e.ruleForm.note_link,callback:function(t){e.$set(e.ruleForm,"note_link",typeof t=="string"?t.trim():t)},expression:"ruleForm.note_link"}})],1),e.isWorkType?[i("el-form-item",{attrs:{label:"ui\u94FE\u63A5",prop:""}},[i("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165"},model:{value:e.ruleForm.note_ui_link,callback:function(t){e.$set(e.ruleForm,"note_ui_link",typeof t=="string"?t.trim():t)},expression:"ruleForm.note_ui_link"}})],1),i("el-form-item",{attrs:{label:"\u8111\u56FE\u94FE\u63A5",prop:""}},[i("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165"},model:{value:e.ruleForm.note_brain_link,callback:function(t){e.$set(e.ruleForm,"note_brain_link",typeof t=="string"?t.trim():t)},expression:"ruleForm.note_brain_link"}})],1),i("el-form-item",{attrs:{label:"\u4EFB\u52A1\u7248\u672C",prop:""}},[i("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165"},model:{value:e.ruleForm.note_version,callback:function(t){e.$set(e.ruleForm,"note_version",typeof t=="string"?t.trim():t)},expression:"ruleForm.note_version"}})],1),i("el-form-item",{attrs:{label:"\u4EFB\u52A1\u9879\u76EE",prop:"note_backend_name"}},[i("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9",multiple:""},model:{value:e.ruleForm.note_types,callback:function(t){e.$set(e.ruleForm,"note_types",t)},expression:"ruleForm.note_types"}},e._l(e.noteWprkTypesOptions,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),i("el-form-item",{attrs:{label:"\u540E\u7AEF\u59D3\u540D",prop:"note_backend_name"}},[i("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9",multiple:""},model:{value:e.ruleForm.note_backend_name,callback:function(t){e.$set(e.ruleForm,"note_backend_name",t)},expression:"ruleForm.note_backend_name"}},e._l(e.houUserList,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),i("el-form-item",{attrs:{label:"\u63D0\u4F9B\u63A5\u53E3\u65F6\u95F4"}},[i("el-date-picker",{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:e.ruleForm.note_backend_time,callback:function(t){e.$set(e.ruleForm,"note_backend_time",t)},expression:"ruleForm.note_backend_time"}})],1),i("el-form-item",{attrs:{label:"\u6D4B\u8BD5\u59D3\u540D",prop:"note_test_name"}},[i("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9",multiple:""},model:{value:e.ruleForm.note_test_name,callback:function(t){e.$set(e.ruleForm,"note_test_name",t)},expression:"ruleForm.note_test_name"}},e._l(e.ceUserList,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),i("el-form-item",{attrs:{label:"ui\u59D3\u540D",prop:"note_ui_name"}},[i("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9",multiple:""},model:{value:e.ruleForm.note_ui_name,callback:function(t){e.$set(e.ruleForm,"note_ui_name",t)},expression:"ruleForm.note_ui_name"}},e._l(e.uiUserList,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),i("el-form-item",{attrs:{label:"\u51FA\u56FE\u65F6\u95F4"}},[i("el-date-picker",{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:e.ruleForm.note_ui_time,callback:function(t){e.$set(e.ruleForm,"note_ui_time",t)},expression:"ruleForm.note_ui_time"}})],1)]:e._e()],2)],1),i("div",{staticClass:"dialog-footer"},[e.editNoteId?i("el-button",{attrs:{size:"small",type:"danger"},on:{click:e.deleteNote}},[e._v(" \u5220\u9664\u7EAA\u8981 ")]):e._e(),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.determineDialog}},[e._v("\u786E\u5B9A")]),i("el-button",{attrs:{size:"small"},on:{click:e.closeDilog}},[e._v("\u53D6\u6D88")])],1)]),!e.IS_PC&&e.timeVisible?i("v-calendar",{attrs:{defaultDate:e.defaultDateFun()},on:{confirm:e.confirmTime},model:{value:e.timeVisible,callback:function(t){e.timeVisible=t},expression:"timeVisible"}}):e._e(),!e.IS_PC&&e.mobileTestVisable?i("van-calendar",{attrs:{"default-date":e.testDefaultFun(),"min-date":new Date(2022,1,1)},on:{confirm:e.onConfirm},model:{value:e.mobileTestVisable,callback:function(t){e.mobileTestVisable=t},expression:"mobileTestVisable"}}):e._e()],1)],1)},x=[];function y(){return{_id:"",note_content:"",note_details:"",note_need_remind:!0,note_begin_time:"",note_end_time:"",note_testing_time:"",note_done:"1",note_progress:0,task_time:[],note_type:"5",note_weight_import:1,note_weight:100,note_ancestors_id:"",note_father_id:"",children:[],note_link:"",note_version:"",note_types:[],note_backend_name:[],note_backend_time:"",note_test_name:[],note_ui_name:[],note_ui_time:"",note_ui_link:"",note_brain_link:""}}const M={components:{VCalendar:D},props:{title:{type:String,default:"\u65B0\u589E\u7EAA\u8981"},editNoteId:{type:String,default:""},activeDate:{type:Array,default:()=>[]}},data(){return{isEditLoading:!1,mobileTestVisable:!1,that:this,timeVisible:!1,zlPopupHeight:"auto",width:"600px",summaryTypeOptions:[],noteDoneType:[],dialogVisible:!1,ruleForm:y(),rules:{note_content:[{required:!0,message:"\u8BF7\u8F93\u5165\u7EAA\u8981",trigger:"blur"},{min:1,message:"\u957F\u5EA6\u5927\u4E8E0",trigger:"blur"}],note_progress:[{min:0,max:100,message:"0~100",trigger:"blur"}],note_testing_time:[{required:!0,message:"\u8BF7\u9009\u62E9\u63D0\u6D4B\u65F6\u95F4",trigger:"blur"}]}}},computed:{...Vuex.mapState(["options","keyboardEventKay"]),...Vuex.mapGetters(["noteWprkTypesOptions","houUserList","ceUserList","uiUserList"]),IS_PC(){return this.isPc()},isWorkType(){return+this.ruleForm.note_type==7}},watch:{keyboardEventKay(e){e==="ctrl_s"&&this.determineDialog()}},filters:{filterTaskTime(e,o){if(Array.isArray(e)&&e.length==2){let i=function(t){return Date.parse(new Date(t.replace(/-/g,"/")).toString())};return o.klDateFormat(i(e[0]),"yyyy-MM-dd")+" \u81F3 "+o.klDateFormat(i(e[1]),"yyyy-MM-dd")}else return"\u8BF7\u9009\u62E9"}},mounted(){if(this.IS_PC)this.width="600px";else{this.width="100vw";let e=document.documentElement.clientHeight;this.zlPopupHeight=e-70+"px"}},methods:{noteTestingTimeChange(){const{task_time:e=[]}=this.ruleForm||{};this.isArray(e)?(this.ruleForm.note_begin_time=e[0]||"",this.ruleForm.note_end_time=e[1]||""):Object.assign(this.ruleForm,{note_begin_time:"",note_end_time:""});let{note_begin_time:o,note_end_time:i,note_testing_time:t}=this.ruleForm;if(!o||!i)return this.ruleForm.note_testing_time="",this.$message.warning("\u8BF7\u5148\u9009\u62E9\u5F00\u59CB\u4E0E\u7ED3\u675F\u65F6\u95F4");if(t=new Date(t).getTime(),o=new Date(o).getTime(),i=new Date(i).getTime(),t<o||t>i)return this.$message.warning({message:`\u8BF7\u5728${this.klDateFormat(o,"yyyy-MM-dd")}\u4E0E${this.klDateFormat(i,"yyyy-MM-dd")}\u4E4B\u95F4\u9009\u62E9\u63D0\u6D4B\u65F6\u95F4`,duration:5e3})},noteTypeChange(e){e==7&&!this.ruleForm._id&&(this.ruleForm.note_weight_import=4)},testDefaultFun(){let{note_testing_time:e}=this.ruleForm;return e?new Date(e):new Date},defaultDateFun(){if(this.ruleForm.task_time.length===2)return this.ruleForm.task_time.map(e=>new Date(e.replace(/-/g,"/")))},openMobileDialog(){this.timeVisible=!0},onConfirm(e){let{note_begin_time:o,note_end_time:i}=this.ruleForm;if(!o||!i)return this.ruleForm.note_testing_time="",this.$message.warning("\u8BF7\u5148\u9009\u62E9\u5F00\u59CB\u4E0E\u7ED3\u675F\u65F6\u95F4");let t=new Date(e).getTime();if(o=new Date(o).getTime(),i=new Date(i).getTime(),t<o||t>i)return this.ruleForm.note_testing_time="",this.$message.warning({message:`\u8BF7\u5728${this.klDateFormat(o,"yyyy-MM-dd")}\u4E0E${this.klDateFormat(i,"yyyy-MM-dd")}\u4E4B\u95F4\u9009\u62E9\u63D0\u6D4B\u65F6\u95F4`,duration:5e3});this.ruleForm.note_testing_time=this.klDateFormat(t,"yyyy-MM-dd hh:mm:ss"),this.mobileTestVisable=!1},confirmTime(e){this.ruleForm.task_time=e.map(o=>this.klDateFormat(o)),this.ruleForm.note_begin_time=this.ruleForm.task_time[0],this.ruleForm.note_end_time=this.ruleForm.task_time[1],this.timeVisible=!1,this.noteTestingTimeChange()},deleteNote(){let{editNoteId:e}=this;if(!e)return this.$message.warning("id\u4E0D\u5B58\u5728");this.$confirm("\u786E\u5B9A\u5220\u9664\u5417?").then(()=>{b({_id:this.editNoteId}).then(o=>{o.msg&&this.$message.success(o.msg),this.closeDilog(),this.$emit("determine")}).catch(o=>{})}).catch(()=>{this.$message({type:"info",message:"\u53D6\u6D88\u6210\u529F",duration:1e3})})},isTimestamp(e){return/^\d{13}$/.test(e)},async init(){var i,t;this.dialogVisible=!0,await this.$nextTick();let{editNoteId:e}=this;if(this.noteDoneType=(i=this.options.noteDoneType)!=null?i:[],this.summaryTypeOptions=(t=this.options.summaryTypeOptions)!=null?t:[],e){this.isEditLoading=!0,F({_id:e}).then(l=>{if(l&&l.data&&l.data.data){this.ruleForm=Object.assign(this.ruleForm,l.data.data);let{note_begin_time:n,note_end_time:p,note_testing_time:r,note_types:a,note_backend_time:m,note_ui_time:_,note_backend_name:u,note_test_name:d,note_ui_name:c}=this.ruleForm;this.ruleForm.note_begin_time=n?this.klDateFormat(n):"",this.ruleForm.note_end_time=p?this.klDateFormat(p):"",this.ruleForm.task_time=[this.ruleForm.note_begin_time,this.ruleForm.note_end_time],this.ruleForm.note_testing_time=this.isTimestamp(r)?this.klDateFormat(r,"yyyy-MM-dd hh:mm:ss"):"",this.ruleForm.note_backend_time=this.isTimestamp(m)?this.klDateFormat(m,"yyyy-MM-dd hh:mm:ss"):"",this.ruleForm.note_ui_time=this.isTimestamp(_)?this.klDateFormat(_,"yyyy-MM-dd hh:mm:ss"):"",this.ruleForm.note_types=a?a.split(","):[],Object.assign(this.ruleForm,{note_backend_name:u?u.split(","):[],note_test_name:d?d.split(","):[],note_ui_name:c?c.split(","):[]})}}).catch(l=>{this.Toast(l)}).finally(()=>{this.isEditLoading=!1});return}this.setInitTime();let{input1Ref:o}=this.$refs;o&&o.focus()},setInitTime(){let{activeDate:e}=this,o=e[0],i=this.addZero(e[1]),t=this.addZero(e[2]),l=`${o}/${i}/${t}`,n=`${o}/${i}/${t} 23:59:59`;this.ruleForm.note_begin_time=l,this.ruleForm.note_end_time=n,this.ruleForm.task_time=[l,n]},closeDilog(){this.dialogVisible=!1,this.ruleForm=y();let e=$(".dialog-main");e&&e.scrollTop(0)},determineDialog(){let{ruleForm:e,title:o,isWorkType:i,dialogVisible:t}=this;const{addoreditRef:l}=this.$refs;if(!l||!t)return;const n=this.deepClone(e);l.validate(p=>{if(p){let{task_time:r,note_testing_time:a,note_types:m,note_backend_time:_,note_ui_time:u,note_backend_name:d,note_test_name:c,note_ui_name:h}=n;if(!this.isArray(r)||r.length!==2)return this.$message.warning("\u8BF7\u9009\u62E9\u4EFB\u52A1\u5468\u671F\u65F6\u95F4");if(n.note_begin_time=new Date(r[0]).getTime(),n.note_end_time=new Date(r[1]).getTime(),this.isArray(m)&&(n.note_types=m.join(",")),i){if(!a)return this.$message.warning("\u8BF7\u9009\u62E9\u63D0\u6D4B\u65F6\u95F4");a=this.klDateFormat(new Date(a).getTime(),"[yyyy,M,dd]").join("/"),n.note_testing_time=new Date(a).getTime()+1e3*3600*18}_&&(n.note_backend_time=new Date(_).getTime()),u&&(n.note_ui_time=new Date(u).getTime()),Array.isArray(d)&&(n.note_backend_name=d.join(",")),Array.isArray(c)&&(n.note_test_name=c.join(",")),Array.isArray(h)&&(n.note_ui_name=h.join(","));const g=this.$loading({lock:!0,text:"\u4FDD\u5B58\u4E2D...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});o.includes("\u65B0\u589E")&&k(this.filterQuery(n)).then(s=>{this.$message.success(s.msg),this.closeDilog(),this.$emit("determine")}).catch(s=>{}).finally(()=>{g.close()}),o.includes("\u7F16\u8F91")&&v(n).then(s=>{this.$message.success(s.msg),this.closeDilog(),this.$emit("determine",s.data)}).catch(s=>{}).finally(()=>{g.close()})}})}}},f={};var C=T(M,w,x,!1,V,"4c868cbe",null,null);function V(e){for(let o in f)this[o]=f[o]}var N=function(){return C.exports}();export{N as default};
