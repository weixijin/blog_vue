import{_ as d,n as u}from"./index.25833e42.js";var _=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{class:["flex-wrap",e.is_sys_right?"flex-justify-end":"",e.chatItemClassName]},[e.is_sys_right?e._e():t("div",{staticClass:"user-avtor flex-0 m-r-10"},[t("e-image",{class:["user-avtor",e.isOnLine?"":"grayscale-img"],attrs:{src:e.avatar,title:e.title,lazy:!e.isAdminPage}})],1),t("div",[e.is_show_username?t("div",{class:["user-name f-14 c-666",e.is_sys_right?"t-a-r":""]},[e._v(" "+e._s(e.title)+" ")]):e._e(),e.msg_type==1?t("div",{class:["content-container f-14 m-t-4 l-h-16 dp-i-b im-msg_type-1",e.isMe?"bg-primary":"bg-default"]},[t("div",{domProps:{innerHTML:e._s(e.parseHtmlUrl(e.row.content))}})]):e._e(),e.msg_type==2?t("div",{class:["content-container f-14 m-t-4",e.isMe?"bg-primary":"bg-default"]},[t("div",{staticClass:"msg-type-2 o-h"},[t("e-image",{staticClass:"msg-type-2",attrs:{width:e.imgWidth,height:e.imgHeight,src:e.parseResourceUrl(e.row.content),lazy:!e.isAdminPage,previewA:""}})],1)]):e._e(),e.msg_type==4?t("div",{class:["content-container f-14 m-t-4 pr",e.isMe?"bg-primary":"bg-default"]},[t("div",{staticClass:"msg-type-20",on:{click:e.openvideoDialog}},[t("e-image",{staticClass:"msg-type-2",attrs:{lazy:!e.isAdminPage,src:e.parseResourceUrl(e.row.poster),width:e.imgWidth,height:e.imgHeight}}),t("img",{staticClass:"p-a w-60 playing-icon cu",attrs:{src:"https://image.zlketang.com/public/news/images/new_official/play/play_play_icon.png",alt:""}})],1)]):e._e(),e.msg_type==5?t("div",{class:["content-container f-14 m-t-4 pr dp-i-b",e.isMe?"bg-primary":"bg-default"]},[t("div",{staticClass:"dp-i-b cu",on:{click:e.playIngAudio}},[t("e-image",{class:["b-r-50 o-h",e.isShowAudio?"an-1":""],attrs:{width:60,height:60,src:"http://139.9.210.43:5000/netdist/kl1718850348458vjab00h8x4d-1718850348280~1~.png"}}),t("div",{staticClass:"m-t-5 f-14 c-555"},[e._v("\u65F6\u957F\uFF1A"+e._s(e.getTime()))])],1)]):e._e(),e.msg_type==3?t("div",{class:["content-container f-14 m-t-4 pr dp-i-b",e.isMe?"bg-primary":"bg-default"]},[t("div",{staticClass:"dp-i-b cu",on:{click:e.uploadFile}},[t("e-image",{attrs:{width:60,height:60,title:"\u70B9\u51FB\u4E0B\u8F7D",src:"https://bpic.588ku.com/element_origin_min_pic/19/04/09/f6ee1317a9bb3ef11258a0297a4cabe7.jpg"}})],1)]):e._e()]),e.is_sys_right?t("div",{staticClass:"user-avtor flex-0 m-l-10"},[t("e-image",{class:["user-avtor",e.isOnLine?"":"grayscale-img"],attrs:{src:e.avatar,title:e.title}})],1):e._e(),t("playerDialog",{attrs:{video_url:e.parseResourceUrl(e.video_url),visable:e.isPlaying},on:{"update:visable":function(s){e.isPlaying=s}}}),t("audioPlay",{attrs:{url:e.parseResourceUrl(e.row.content)},on:{ended:e.audioEnd},model:{value:e.isShowAudio,callback:function(s){e.isShowAudio=s},expression:"isShowAudio"}})],1)},g=[];const p={components:{playerDialog:()=>d(()=>import("./index.019b8684.js"),["static/index.019b8684.js","static/index.25833e42.js","static/index.8776284e.css"]),wifiIcon:()=>d(()=>import("./index.36ccbc63.js"),["static/index.36ccbc63.js","static/index.c6c71677.css","static/index.25833e42.js","static/index.8776284e.css"]),audioPlay:()=>d(()=>import("./index.ec291ae7.js"),["static/index.ec291ae7.js","static/index.12e1667e.css","static/index.25833e42.js","static/index.8776284e.css"])},props:{row:{type:Object,default:()=>({})},roomMembers:{type:Array,default:()=>[]},roomMemberInfo:{type:Object,default:()=>({})},maxWidth:{type:Number,default:290},isAdminPage:{type:Boolean,default:!1}},data(){return{chatItemClassName:this.createId(),isPlaying:!1,video_url:"",isShowAudio:!1}},computed:{...Vuex.mapState(["userdata","userTags"]),isMe(){var e,i;return this.userdata.header_img===((i=(e=this.row)==null?void 0:e.author_id)==null?void 0:i.header_img)},avatar(){var e,i;return this.parseResourceUrl(this.isMe?this.userdata.header_img:(i=(e=this.row)==null?void 0:e.author_id)==null?void 0:i.header_img)},title(){var e,i;return this.isMe?this.userdata.username:(i=(e=this.row)==null?void 0:e.author_id)==null?void 0:i.username},isOnLine(){return this.roomMembers.some(e=>{var i,t;if(e.author_id._id===((t=(i=this.row)==null?void 0:i.author_id)==null?void 0:t._id))return e.status==1})},roomMember(){return this.roomMembers.find(e=>{var i,t,s;return((i=e.author_id)==null?void 0:i._id)===((s=(t=this.row)==null?void 0:t.author_id)==null?void 0:s._id)})||{}},msg_type(){return this.row.msg_type||"1"},is_sys_right(){return this.isMe&&this.roomMemberInfo.is_sys_right==1},is_show_username(){return this.roomMemberInfo.is_show_username==1},newMaxWidth(){return this.row.width>this.row.height?this.maxWidth:this.maxWidth/2},imgWidth(){var o;let{maxWidth:e,msg_type:i,newMaxWidth:t}=this;const{video_width:s,video_height:n}=this.row;if(![2,4].includes(+i))return 0;if(i==2){let r=(o=this.row.content)==null?void 0:o.split("~");if(r=r.filter(l=>!isNaN(+l)),Array.isArray(r)&&r.length===3){let a=+r[1],h=+r[2];return isNaN(a)||isNaN(h)?0:a>e?e:a}}return i==4?!s||!n?0:s>t?t:s:0},imgHeight(){var n;let{maxWidth:e,msg_type:i}=this;const{video_width:t,video_height:s}=this.row;if(![2,4].includes(+i))return 0;if(i==2){let o=(n=this.row.content)==null?void 0:n.split("~");if(o=o.filter(r=>!isNaN(+r)),Array.isArray(o)&&o.length===3){let l=+o[1],a=+o[2];if(isNaN(l)||isNaN(a))return 0;if(l>e){let h=e/l;l=e,a=a*h}return a}}if(i==4){if(!t||!s)return 0;let o=t/s;return this.imgWidth/o}return 0}},mounted(){let{chatItemClassName:e,maxWidth:i}=this,t=document.querySelectorAll(`.${e} .contenteditable-unpload-img`);if(t&&t.length>0)for(let s=0;s<t.length;s++){const n=t[s];n.onclick=()=>{this.prevewImg(n)};let r=$(n).attr("src").split("~");if(r=r.filter(l=>!isNaN(+l)),Array.isArray(r)&&r.length===3){let a=+r[1],h=+r[2];if(isNaN(a)||isNaN(h))return;if(a>i){let m=i/a;a=i,h=h*m}$(n).css({width:a+"px",height:h+"px"})}}},methods:{getTime(){let{time:e}=this.row;return e?(e/1e3).toFixed(1)+"s":"\u672A\u77E5"},uploadFile(){this.$confirm("\u786E\u8BA4\u4E0B\u8F7D\u5417?").then(()=>{let e=document.createElement("a");e.href=this.parseResourceUrl(this.row.content),e.click(),e.remove()}).catch(()=>{})},audioEnd(){this.isShowAudio=!1},playIngAudio(){this.$emit("closeAllPlay"),this.isShowAudio=!0},openvideoDialog(){this.$emit("closeAllPlay"),this.isPlaying=!0,this.video_url=this.row.content||""}}},c={};var f=u(p,_,g,!1,y,"14ed741c",null,null);function y(e){for(let i in c)this[i]=c[i]}var w=function(){return f.exports}();export{w as c};
