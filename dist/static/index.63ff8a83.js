import{n as m,h as _,b as u}from"./index.25833e42.js";import{Q as f}from"./qrcode.9e9071ce.js";var C=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("klDialog",{staticClass:"qr-code-dialog",attrs:{center:"",width:"300px",title:"\u4E8C\u7EF4\u7801",dialogVisible:t.dialogVisible,nobg:""},on:{close:function(i){t.dialogVisible=!1},determine:t.submit},scopedSlots:t._u([{key:"header",fn:function(){return[e("i")]},proxy:!0},{key:"footer",fn:function(){return[e("i")]},proxy:!0}])},[e("div",{staticClass:"qr-code-container"},[e("div",{ref:"codeRef",staticClass:"pos-img",attrs:{id:"qrcode"}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.canvasImg,expression:"canvasImg"}],staticClass:"pr flex-img"},[e("img",{staticClass:"img-bg",attrs:{src:t.canvasImg},on:{click:function(i){t.dialogVisibleImg=!0}}}),e("el-button",{staticClass:"m-t-15",attrs:{type:"primary"},on:{click:t.downloadImg}},[t._v(" \u4E0B\u8F7D ")])],1),t.canvasImg?t._e():e("div",{staticClass:"loading-code"},[e("i",{staticClass:"el-icon-loading c-fff"}),e("p",{staticClass:"c-fff"},[t._v("\u4E8C\u7EF4\u7801\u751F\u6210\u4E2D")])])]),e("klDialog",{attrs:{center:"",width:"440px",dialogVisible:t.dialogVisibleImg,nobg:""},on:{close:function(i){t.dialogVisibleImg=!1}},scopedSlots:t._u([{key:"header",fn:function(){return[e("i")]},proxy:!0},{key:"footer",fn:function(){return[e("i")]},proxy:!0}])},[e("img",{staticClass:"big-img",attrs:{src:t.canvasImg,alt:""}})])],1)},x=[];const k={props:{ac_id:{type:String,default:""}},data(){return{dialogVisibleImg:!1,dialogVisible:!1,qrCode:"",qrcode:"",bgImgUrl:"//image.zlketang.com/public/news/others/imgs/school_code/bg-2.png",canvasImg:"",acData:{}}},mounted(){const t=[{js:"https://cdn.bootcdn.net/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"}];this.getIndexDBJS(t)},methods:{submit(){},sleep(t){return new Promise(a=>{setTimeout(()=>{a()},t)})},async init(){var n;this.canvasImg="";let t=this;await this.$nextTick();let a=await _.get_ac_page({ac_id:this.ac_id});this.acData=((n=a==null?void 0:a.data)==null?void 0:n.data)||{};let{ac_url:e,ac_name:i}=this.acData;$("#qrcode").html(""),this.qrcode=new f(this.$refs.codeRef,{text:u+"ac/"+e,width:880,height:880,colorDark:"#333333",colorLight:"#ffffff",correctLevel:f.CorrectLevel.H}),html2canvas(this.$refs.codeRef,{backgroundColor:null,width:880,height:880}).then(c=>{var r=c.toDataURL("image/jpeg");this.qrCode=r;let{bgImgUrl:v,qrCode:b}=this,l=document.createElement("canvas");l.width=880,l.height=880;let s=l.getContext("2d");if(!s)return t.$message.error("\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301canvas,\u8BF7\u4F7F\u7528\u8C37\u6B4C\u6216edge");s.rect(0,0,l.width,l.height),s.fillStyle="#ffffff",t.roundRect(s,0,0,880,880,20),s.fill();let o=new Image;o.src=v,o.crossOrigin="Anonymous",o.onload=()=>{s.drawImage(o,0,-4,880,884),t.roundRect(s,200,200,480,480,20);let d=new Image;d.src=b,d.crossOrigin="Anonymous",d.onload=()=>{s.drawImage(d,232,232,416,416),s.fillStyle="#fff",s.font="normal normal 600 64px Adobe Ming Std",s.textAlign="center",s.fillText("\u626B\u7801\u67E5\u770B",440,140),s.fillStyle="#fff",s.font="normal normal 400 48px Adobe Ming Std",s.fillText(i,440,780),setTimeout(()=>{let y=l.toDataURL("image/png");t.canvasImg=y},0)}}})},downloadImg(){let t=document.createElement("a");t.download=this.acData.ac_name||"\u77E5\u5D16",t.href=this.canvasImg,document.body.appendChild(t),t.click(),t.remove()}}},g={};var w=m(k,C,x,!1,D,"ba87f498",null,null);function D(t){for(let a in g)this[a]=g[a]}var R=function(){return w.exports}(),I=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("el-dialog",{staticClass:"el-dialog-center",attrs:{top:"100px",width:"800px",title:t.title,visible:t.dialogVisible},on:{close:t.close,determine:t.submit}},[e("div",{staticClass:"dialog-main"},[e("div",{staticClass:"item m-b-15"},[e("span",[t._v(" \u540D\u5B57\uFF1A ")]),e("el-input",{staticClass:"w-300",attrs:{clearable:""},model:{value:t.ac_name,callback:function(i){t.ac_name=typeof i=="string"?i.trim():i},expression:"ac_name"}})],1),e("div",{staticClass:"item m-b-15"},[e("span",[t._v(" \u5730\u5740\uFF1A ")]),e("el-input",{staticClass:"w-300",attrs:{clearable:""},model:{value:t.ac_url,callback:function(i){t.ac_url=typeof i=="string"?i.trim():i},expression:"ac_url"}})],1),e("div",{staticClass:"item"},[e("span",[t._v(" \u5185\u5BB9\uFF1A ")]),e("el-input",{attrs:{type:"textarea",rows:20},model:{value:t.ac_content,callback:function(i){t.ac_content=typeof i=="string"?i.trim():i},expression:"ac_content"}})],1),e("div",{staticClass:"flex-center m-t-15"},[e("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v(" \u63D0\u4EA4 ")])],1)])])},S=[];const A={props:{ac_id:{type:String,default:""}},data(){return{ac_url:"",ac_name:"",ac_content:"",dialogVisible:!1,title:"\u65B0\u589E\u9875\u9762"}},methods:{close(){this.ac_url="",this.ac_name="",this.ac_content="",this.dialogVisible=!1},init(){let{ac_id:t}=this;if(!t)return;let a={ac_id:t};_.get_ac_page(a).then(e=>{var r;let{ac_url:i,ac_name:n,ac_content:c}=((r=e==null?void 0:e.data)==null?void 0:r.data)||{};this.ac_url=i,this.ac_name=n,this.ac_content=c}).catch(e=>{this.Toast(e)})},submit(){let{ac_name:t,ac_content:a,ac_url:e,ac_id:i}=this;if(!t||!a||!e)return this.$message.warning("\u4E0D\u80FD\u4E3A\u7A7A");let n={ac_name:t,ac_content:a,ac_url:e};i&&(n.ac_id=i),_.post_ac_page(n).then(c=>{this.close(),this.$message.success(c.msg||"\u64CD\u4F5C\u6210\u529F"),this.$emit("updataList")}).catch(c=>{this.Toast(c)})}}},h={};var E=m(A,I,S,!1,V,"8780da38",null,null);function V(t){for(let a in h)this[a]=h[a]}var F=function(){return E.exports}(),L=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"p-20"},[e("TrainPage",{ref:"TrainPageRef",attrs:{searchConfig:t.searchConfig,tableConfig:t.tableConfig,sendUrl:"get_ac_list",customize:""},scopedSlots:t._u([{key:"author_name",fn:function(i){var n,c=i.record;return[t._v(" "+t._s((c==null||(n=c.author_id)===null||n===void 0?void 0:n.username)||"---")+" ")]}}])}),e("EditAcDialog",{ref:"EditAcDialogRef",attrs:{ac_id:t.ac_id},on:{updataList:t.updataList}}),e("ShareQrCode",{ref:"ShareQrCodeRef",attrs:{ac_id:t.ac_id}})],1)},T=[];const j={components:{ShareQrCode:R,EditAcDialog:F},data(){return{searchConfig:[{label:"\u9875\u9762\u540D\u79F0",type:"input",modelName:"content"}],tableConfig:{isSelection:!1,maxHeightFlag:!1,stripe:!0,filterData:t=>t.map(a=>{let{ac_create_time:e,ac_updata_time:i}=a;return{...a,_ac_create_time:this.klDateFormat(e),_ac_updata_time:this.klDateFormat(i)}}),btns:{children:[{label:"\u65B0\u589E",type:"primary",clickFn:t=>{this.DialogEvent({type:"add"})}}]},columnObj:[{label:"\u9875\u9762\u540D\u79F0",props:"ac_name",clickFn:t=>{this.goTo(u+"ac/"+t.ac_url,{target:"_blank"})}},{label:"\u66F4\u65B0\u65E5\u671F",props:"_ac_updata_time"},{label:"\u521B\u5EFA\u65E5\u671F",props:"_ac_create_time"},{label:"\u64CD\u4F5C",slot:"projectDetail",props:"action",lock:!0,fixed:"right",children:[{label:"\u751F\u6210\u4E8C\u7EF4\u7801",type:"primary",clickFn:t=>{this.showCode(t)}},{label:"\u7F16\u8F91",type:"success",clickFn:t=>{this.DialogEvent({type:"edit",ac_id:t._id})}},{label:"\u5220\u9664",type:"danger",clickFn:t=>{this.delAcPage(t)}},{label:"\u590D\u5236\u94FE\u63A5",type:"info",clickFn:t=>{this.copyLink(t)}}]}]},ac_id:"",list:[]}},methods:{getFullPath(t){return u+"ac/"+t},showCode({_id:t}){this.ac_id=t,this.$refs.ShareQrCodeRef&&(this.$refs.ShareQrCodeRef.dialogVisible=!0,this.$refs.ShareQrCodeRef.init())},copyLink(t){let a=this,{ac_url:e}=t;this.copy({data:this.getFullPath(e),success:()=>{a.$message.success("\u590D\u5236\u6210\u529F")},fail:()=>{a.$message.error("\u590D\u5236\u5931\u8D25")}})},delAcPage({_id:t}){!t||this.$confirm("\u786E\u5B9A\u5220\u9664\u5417?").then(()=>{_.del_ac_page({ac_id:t}).then(()=>{this.$message.success("\u5220\u9664\u6210\u529F"),this.$parent.init()}).catch()}).catch(()=>{this.$message.info("\u53D6\u6D88\u6210\u529F")})},updataList(){this.$refs.TrainPageRef.getAddData()},async DialogEvent({type:t,ac_id:a}){!this.$refs.EditAcDialogRef||(t==="add"&&(this.ac_id="",this.$refs.EditAcDialogRef.title="\u65B0\u589E\u9875\u9762",this.$refs.EditAcDialogRef.dialogVisible=!0),t=="edit"&&(this.ac_id=a,this.$refs.EditAcDialogRef.title="\u7F16\u8F91\u9875\u9762",this.$refs.EditAcDialogRef.dialogVisible=!0,await this.$nextTick(),this.$refs.EditAcDialogRef.init()))}}},p={};var q=m(j,L,T,!1,Q,null,null,null);function Q(t){for(let a in p)this[a]=p[a]}var M=function(){return q.exports}();export{M as default};
