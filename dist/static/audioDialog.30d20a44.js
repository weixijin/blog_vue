import{n as l,_ as n}from"./index.25833e42.js";var r=function(){var e=this,i=e.$createElement,a=e._self._c||i;return a("kl-dialog",{attrs:{width:"300px",center:"",header:!1,footer:!1,dialogVisible:e.visable},on:{"update:dialogVisible":function(t){e.visable=t},"update:dialog-visible":function(t){e.visable=t}}},[a("div",{staticClass:"flex-column-wrap p-20 flex-center-wrap pr p-t-40",on:{click:function(t){return t.stopPropagation(),function(){}.apply(null,arguments)}}},[a("i",{staticClass:"f-20 f-600 c-555 cu el-icon-close p-a el-icon-close-1",on:{click:function(t){return t.stopPropagation(),e.close.apply(null,arguments)}}}),a("e-image",{staticClass:"b-r-50 o-h",attrs:{height:80,lazy:!1,src:"http://139.9.210.43:5000/netdist/kl1718850348458vjab00h8x4d-1718850348280~1~.png"}}),a("div",{staticClass:"m-t-20"},[e._v("\u5F55\u5236\u65F6\u957F"+e._s(e.getAudioTime()))]),a("div",{staticClass:"flex-wrap m-t-20"},[a("el-button",{attrs:{size:"small",type:"info"},on:{click:function(t){return t.stopPropagation(),e.reload.apply(null,arguments)}}},[e._v("\u91CD\u65B0\u5F55\u5236")]),a("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return t.stopPropagation(),e.stop.apply(null,arguments)}}},[e._v("\u505C\u6B62")]),a("el-button",{attrs:{size:"small",type:"success"},on:{click:function(t){return t.stopPropagation(),e.play.apply(null,arguments)}}},[e._v("\u64AD\u653E")]),a("el-button",{attrs:{disabled:e.audioTime==0,size:"small",type:"danger"},on:{click:function(t){return t.stopPropagation(),e.send.apply(null,arguments)}}},[e._v("\u53D1\u9001")])],1)],1),a("audioPlay",{attrs:{url:e.parseResourceUrl(e.filePath)},on:{ended:function(t){e.isShowAudio=!1}},model:{value:e.isShowAudio,callback:function(t){e.isShowAudio=t},expression:"isShowAudio"}})],1)},u=[];const c={components:{audioPlay:()=>n(()=>import("./index.ec291ae7.js"),["static/index.ec291ae7.js","static/index.12e1667e.css","static/index.25833e42.js","static/index.8776284e.css"])},props:{value:{type:Boolean,default:!1}},data(){return{isShowAudio:!1,filePath:"",file:null,mediaRecorder:null,isStart:!1,audioTime:0,timer:null}},computed:{visable:{get(){return this.value},set(){return this.$emit("input",!this.value)}}},watch:{value(e){if(e){this.init();return}}},beforeDestroy(){this.clearTimer(),this.audioTime=0},methods:{close(){this.filePath="",this.mediaRecorder=null,this.file=null,this.visable=!1,this.clearTimer(),this.audioTime=0},getAudioTime(){return(this.audioTime/1e3).toFixed(2)+"s"},reload(){this.filePath="",this.mediaRecorder=null,this.file=null,this.init()},stop(){this.clearTimer(),this.mediaRecorder.stop()},play(){this.filePath||this.stop(),this.isShowAudio=!0},async send(){this.filePath||(this.stop(),await this.sleep()),this.commonUploadFile(this.file,"im",500).then(({url:e=""})=>{this.$emit("pushInfo",{msg_type:"5",content:e,time:this.audioTime}),this.close()}).catch(()=>{})},clearTimer(){clearInterval(this.timer),this.timer=null},init(){if(!this.mediaRecorder){if(!navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){this.$klMessage("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u5F55\u97F3\u529F\u80FD");return}this.clearTimer(),this.audioTime=0,navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{const i=new MediaRecorder(e),a=[];i.ondataavailable=t=>{t.data.size>0&&a.push(t.data)},i.onstop=()=>{const t=new Blob(a,{type:"audio/ogg; codecs=opus"}),o="recordedAudio.ogg";this.file=new File([t],o,{type:"audio/ogg"}),this.filePath=this.getObjectURL(this.file)},i.start(),this.mediaRecorder=i,this.timer=setInterval(()=>{if(this.audioTime>=60*1e3){this.clearTimer();return}this.audioTime+=50},50)}).catch(e=>{console.error("Error accessing the microphone:",e)})}},getObjectURL(e){var i=null;return window.createObjectURL!==void 0?i=window.createObjectURL(e):window.URL!==void 0?i=window.URL.createObjectURL(e):window.webkitURL!==void 0&&(i=window.webkitURL.createObjectURL(e)),i}}},s={};var d=l(c,r,u,!1,h,"2d610714",null,null);function h(e){for(let i in s)this[i]=s[i]}var m=function(){return d.exports}();export{m as default};
