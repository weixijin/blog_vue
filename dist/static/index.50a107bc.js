import{b as l,c as u,d as m}from"./data.d27333a2.js";import{Q as a}from"./qrcode.9e9071ce.js";import{n,b as h}from"./index.25833e42.js";var f=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"login"},[t("div",{staticClass:"right-wrap"},[t("div",{staticClass:"login-wrap common-bg-1"},[t("div",{staticClass:"form pr"},[t("div",{staticClass:"t-box pa c-danger cu",on:{click:e.tLogin}},[e._v("\u6E38\u5BA2\u767B\u5F55")]),t("h3",[e._v("\u767B \u5F55")]),e.isCode?t("div",{staticClass:"code-cover"},[t("div",{ref:"codeRef",attrs:{id:"qrcode"},on:{click:e.createCode}}),t("span",{staticClass:"c-danger"},[e._v(" \u4F7F\u7528\u7F51\u7AD9\u4E13\u5C5Eapp\u626B\u7801\u767B\u5F55 ")])]):t("div",[t("el-col",{staticStyle:{"margin-top":"30px"}},[t("div",{staticClass:"flex-wrap"},[t("span",{staticClass:"input-label"},[e._v("\u90AE\u7BB1")]),t("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1",size:"medium"},model:{value:e.email,callback:function(s){e.email=typeof s=="string"?s.trim():s},expression:"email"}})],1)]),t("el-col",{staticStyle:{"margin-top":"15px"}},[t("div",{staticClass:"flex-wrap"},[t("span",{staticClass:"input-label"},[e._v("\u5BC6\u7801")]),t("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801(5~30)",size:"medium",type:"password"},nativeOn:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.login.apply(null,arguments)}},model:{value:e.password,callback:function(s){e.password=typeof s=="string"?s.trim():s},expression:"password"}})],1)]),t("el-col",{staticStyle:{"margin-top":"30px"}},[t("div",{staticClass:"flex-wrap"},[t("span",{staticClass:"input-label"},[e._v("\u9A8C\u8BC1\u7801")]),t("el-col",{staticClass:"code"},[t("el-input",{attrs:{size:"medium"},nativeOn:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.login.apply(null,arguments)}},model:{value:e.code,callback:function(s){e.code=typeof s=="string"?s.trim():s},expression:"code"}}),e.isTrue?t("p",{staticClass:"handleyzm"},[e._v(e._s(e.isNum)+"\u79D2\u540E\u53EF\u4EE5\u91CD\u65B0\u83B7\u53D6")]):t("p",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"handleyzm",on:{click:e.getEmailCode}},[e._v(" \u83B7\u53D6\u9A8C\u8BC1\u7801 ")])],1)],1)]),t("el-col",{staticStyle:{"margin-top":"30px"}},[t("el-button",{staticClass:"login-btn",attrs:{loading:e.loading},on:{click:e.login}},[e._v(" \u767B \u5F55 ")])],1)],1),t("div",{staticClass:"gologincover"},[t("span",{staticClass:"code-span",on:{click:e.switchCodeType}},[e._v(" "+e._s(e.footerText))]),t("router-link",{staticClass:"gologin",attrs:{to:"/register"}},[e._v("\u524D\u5F80\u6CE8\u518C")]),t("router-link",{staticClass:"findPassword",attrs:{to:"/findPassword"}},[e._v("\u91CD\u7F6E\u5BC6\u7801")])],1)])])])])},p=[];const g={components:{},data(){return{numberCode:0,timer:null,qrcode:"",isCode:!1,isTrue:!1,isNum:60,password:"",email:"",loading:!1,btnText:"\u767B\u5F55",timer:null,code:"",isLoading:!1}},computed:{footerText(){return this.isCode?"\u8D26\u53F7\u767B\u5F55":"\u626B\u7801\u767B\u5F55"},query(){return this.getQuery(location.href)}},created(){this.getUserInfo(),console.log(111,navigator.userAgent)},methods:{async tLogin(){if(!await this.$confirm("\u6E38\u5BA2\u767B\u5F55\u53EF\u80FD\u5BFC\u81F4\u90E8\u5206\u529F\u80FD\u65E0\u6CD5\u4F7F\u7528\uFF0C\u8BF7\u8C28\u614E\u4F7F\u7528\uFF0C\u53EF\u5728\u4E2A\u4EBA\u4E2D\u5FC3\u5B8C\u5584\u4FE1\u606F\uFF0C\u4F7F\u7528\u7F51\u7AD9\u5B8C\u6574\u529F\u80FD"))return;let i=await localforage.getItem("tourist_email");i||(i=this.createId(),localforage.setItem("tourist_email",i)),l({email:i,role:"tourist"}).then(t=>{if(this.$store.commit("setUserData",t.data),this.isPc())return this.backPage()}).catch(()=>{})},getUserInfo(){let e=localStorage.getItem("userInfo");if(e){let{email:i,password:t}=JSON.parse(e);this.email=i,this.password=t}},saveUserData(){let{email:e,password:i}=this;localStorage.setItem("userInfo",JSON.stringify({email:e,password:i}))},backPage(){let{path:e}=this.query;this.updateUrl("path",null),window.location.replace(e?decodeURIComponent(e):"/")},createCode(){this.timer&&(clearInterval(this.timer),this.timer=null),$("#qrcode").html(""),this.$nextTick(()=>{let e=this;const i=this.createId();this.qrcode=new a(this.$refs.codeRef,{text:`http://127.0.0.1:3999?user_code_id=${i}`,width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:a.CorrectLevel.H}),this.timer=setInterval(()=>{u({user_code_id:i}).then(t=>{let{data:s,token:r}=t.data||{};this.$message.success("\u767B\u5F55\u6210\u529F"),clearInterval(e.timer),e.time=null,e.$store.commit("setUserData",{user:s,token:r}),this.backPage(),this.saveUserData()}).catch(()=>{e.numberCode>=20&&(clearInterval(e.timer),e.time=null),this.numberCode+=1})},3e3)})},switchCodeType(){this.isCode=!this.isCode,this.isCode?this.createCode():(clearInterval(this.timer),this.timer=null)},async getEmailCode(){if(this.email=="")return this.$message.error("\u8BF7\u5148\u8F93\u5165\u90AE\u7BB1,\u624D\u80FD\u83B7\u53D6\u9A8C\u8BC1\u7801");var e=/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;if(!e.test(this.email))return this.$message.error("\u8BF7\u68C0\u67E5\u90AE\u7BB1\u662F\u5426\u5408\u6CD5");this.isLoading=!0;let{code:i}=await m({email:this.email});this.isLoading=!1,+i==200&&(this.isTrue=!0,setInterval(()=>{this.isNum>1?this.isNum-=1:(this.isTrue=!1,this.isNum=60)},1e3))},async login(){let{email:e,password:i,code:t}=this;if(!i){this.$message.error("\u8BF7\u8F93\u5165\u5BC6\u7801");return}if(i.length<5||i.length>20)return this.$message.error("\u5BC6\u7801\u957F\u5EA6\u8981\u6C425~20\u4E2A\u5B57\u7B26");if(!t)return this.$message.error("\u6C92\u6709\u586B\u5199\u9A8C\u8BC1\u7801");let s=null;try{s=await l({email:e,password:i,code:t})}catch{this.isTrue=!1,this.isNum=60,clearInterval(this.timer);return}if(this.$message.success(s.msg),this.isTrue=!1,this.isNum=60,clearInterval(this.timer),this.timer=null,this.$store.commit("setUserData",s.data),this.saveUserData(),this.isPc())return this.backPage()}}},o={};var _=n(g,f,p,!1,v,"4969a8d5",null,null);function v(e){for(let i in o)this[i]=o[i]}var C=function(){return _.exports}(),y=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"login",style:e.getStyle()},[t("kl-popup",{staticClass:"login-page",attrs:{filter:"",visible:""}},[t("div",{staticClass:"login-wrap p-t-20 c-f5 p-b-20"},[t("div",{staticClass:"p-l-15 p-r-15"},[t("div",{staticClass:"flex-center f-28 f-550 h-50 m-b-20"},[e._v("\u767B \u5F55")]),e.isCode?t("div",{staticClass:"flex-center flex-column-wrap m-b-10"},[t("div",{ref:"codeRef",staticClass:"flex-center w-200 h-200 m-b-20 bg-fff b-r-4",attrs:{id:"qrcode"},on:{click:e.createCode}}),t("span",{staticClass:"c-warning"},[e._v(" \u4F7F\u7528\u7F51\u7AD9\u4E13\u5C5Eapp\u626B\u7801\u767B\u5F55 ")])]):t("div",[t("div",{staticClass:"flex-wrap m-t-20"},[t("span",{staticClass:"min-w-50 f-14 w-s-n flex-center flex-justify-end h-36 m-r-10"},[e._v("\u90AE\u7BB1")]),t("el-input",{staticClass:"flex-1",attrs:{placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1",size:"medium"},model:{value:e.email,callback:function(s){e.email=typeof s=="string"?s.trim():s},expression:"email"}})],1),t("div",{staticClass:"flex-wrap m-t-20"},[t("span",{staticClass:"min-w-50 f-14 w-s-n flex-center flex-justify-end h-36 m-r-10"},[e._v("\u5BC6\u7801")]),t("el-input",{staticClass:"flex-1",attrs:{placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801(5~30)",size:"medium",type:"password"},nativeOn:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.login.apply(null,arguments)}},model:{value:e.password,callback:function(s){e.password=typeof s=="string"?s.trim():s},expression:"password"}})],1),t("div",{staticClass:"flex-center-wrap m-t-20"},[t("span",{staticClass:"min-w-50 f-14 w-s-n flex-center flex-justify-end h-36 m-r-10"},[e._v("\u9A8C\u8BC1\u7801")]),t("el-col",{staticClass:"flex-center-wrap flex-justify-between"},[t("el-input",{staticClass:"m-r-10 flex-1",attrs:{size:"medium"},nativeOn:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.login.apply(null,arguments)}},model:{value:e.code,callback:function(s){e.code=typeof s=="string"?s.trim():s},expression:"code"}}),e.isTrue?t("p",{staticClass:"w-s-n f-14"},[e._v(e._s(e.isNum)+"\u79D2\u540E\u53EF\u4EE5\u91CD\u65B0\u83B7\u53D6")]):t("p",{staticClass:"w-s-n f-14",on:{click:e.getEmailCode}},[e._v(" \u83B7\u53D6\u9A8C\u8BC1\u7801 ")])],1)],1),t("div",{staticClass:"h-40 flex-center c-fff bg-primary b-r-4 f-14 m-t-20",attrs:{loading:e.loading},on:{click:e.login}},[e._v(" \u767B \u5F55 ")])]),t("div",{staticClass:"flex-center h-50 flex"},[t("span",{staticClass:"c-primary",on:{click:e.switchCodeType}},[e._v(" "+e._s(e.footerText))]),t("router-link",{staticClass:"m-l-15 c-f5",attrs:{to:"/register"}},[e._v("\u524D\u5F80\u6CE8\u518C")]),t("router-link",{staticClass:"m-l-15 c-f5",attrs:{to:"/findPassword"}},[e._v("\u91CD\u7F6E\u5BC6\u7801")])],1)])])])],1)},w=[];const x={components:{},data(){return{numberCode:0,timer:null,qrcode:"",isCode:!1,isTrue:!1,isNum:60,password:"",email:"",loading:!1,btnText:"\u767B\u5F55",timer:null,code:"",bgImg:""}},computed:{footerText(){return this.isCode?"\u8D26\u53F7\u767B\u5F55":"\u626B\u7801\u767B\u5F55"},query(){return this.getQuery(location.href)}},created(){this.getUserInfo()},mounted(){this.winSleep(()=>{try{this.getIndexDBIMJ({bgImg:`${h}netdist/b55dba33e5c476a1d751ca7c4a41a369-1709302423536~1~.jpg`})}catch(e){this.Toast(e)}})},methods:{getStyle(){return{backgroundImage:`url(${this.bgImg})`}},async getUserInfo(){let e=await localforage.getItem("userInfo");if(e){let{email:i,password:t}=JSON.parse(e);this.email=i,this.password=t}},saveUserData(){let{email:e,password:i}=this;localforage.setItem("userInfo",JSON.stringify({email:e,password:i}))},backPage(){let{path:e}=this.query;this.updateUrl("path",null),window.location.replace(e?decodeURIComponent(e):"/")},createCode(){this.timer&&(clearInterval(this.timer),this.timer=null),$("#qrcode").html(""),this.$nextTick(()=>{let e=this;this.user_code_id=this.createId(),this.qrcode=new a(this.$refs.codeRef,{text:`http://127.0.0.1:3999?user_code_id=${this.user_code_id}`,width:180,height:180,colorDark:"#000",colorLight:"#ffffff",correctLevel:a.CorrectLevel.H}),this.timer=setInterval(()=>{u({user_code_id:e.user_code_id}).then(i=>{let{data:t,token:s}=i.data;this.$klMessage("\u767B\u5F55\u6210\u529F"),clearInterval(e.timer),e.time=null,e.$store.commit("setUserData",{user:t,token:s}),this.backPage(),this.saveUserData()}).catch(()=>{e.numberCode>=20&&(clearInterval(e.timer),e.time=null),this.numberCode+=1})},3e3)})},switchCodeType(){this.isCode=!this.isCode,this.isCode?this.createCode():(clearInterval(this.timer),this.timer=null)},async getEmailCode(){if(this.email=="")return this.$klMessage("\u8BF7\u5148\u8F93\u5165\u90AE\u7BB1,\u624D\u80FD\u83B7\u53D6\u9A8C\u8BC1\u7801");var e=/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;if(!e.test(this.email))return this.$klMessage("\u8BF7\u68C0\u67E5\u90AE\u7BB1\u662F\u5426\u5408\u6CD5");let{code:i}=await m({email:this.email});+i==200&&(this.isTrue=!0,setInterval(()=>{this.isNum>1?this.isNum-=1:(this.isTrue=!1,this.isNum=60)},1e3))},async login(){let{email:e,password:i,code:t}=this;if(!i){this.$klMessage("\u8BF7\u8F93\u5165\u5BC6\u7801");return}if(i.length<5||i.length>20)return this.$klMessage("\u5BC6\u7801\u957F\u5EA6\u8981\u6C425~20\u4E2A\u5B57\u7B26");if(!t)return this.$klMessage("\u6C92\u6709\u586B\u5199\u9A8C\u8BC1\u7801");let s=null;try{s=await l({email:e,password:i,code:t})}catch{this.isTrue=!1,this.isNum=60,clearInterval(this.timer);return}s.data,this.$klMessage(s.msg),this.isTrue=!1,this.isNum=60,clearInterval(this.timer),this.timer=null,this.$store.commit("setUserData",s.data),this.saveUserData(),this.backPage()}}},c={};var k=n(x,y,w,!1,b,"1333c679",null,null);function b(e){for(let i in c)this[i]=c[i]}var I=function(){return k.exports}(),T=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"demo"},[e.isPc()?t("pc"):e._e(),e.isPc()?e._e():t("mobile")],1)},U=[];const N={components:{pc:C,mobile:I},data(){return{}},methods:{}},d={};var S=n(N,T,U,!1,D,null,null,null);function D(e){for(let i in d)this[i]=d[i]}var E=function(){return S.exports}();export{E as default};
